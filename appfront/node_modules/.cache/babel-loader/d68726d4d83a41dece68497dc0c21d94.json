{"ast":null,"code":"var setupDefaults = require('./setupDefaults');\n\nvar helperGetDateTime = require('./helperGetDateTime');\n\nvar helperNewDate = require('./helperNewDate');\n\nvar toStringDate = require('./toStringDate');\n\nvar isValidDate = require('./isValidDate');\n/**\r\n  * 返回两个日期之间差距,如果结束日期小于开始日期done为fasle\r\n  *\r\n  * @param {Date} startDate 开始日期\r\n  * @param {Date} endDate 结束日期或当期日期\r\n  * @param {Date} rule 自定义计算规则\r\n  * @return {Object}\r\n  */\n\n\nfunction getDateDiff(startDate, endDate, rules) {\n  var startTime, endTime, item, diffTime, rule, len, index;\n  var result = {\n    done: false,\n    time: 0\n  };\n  startDate = toStringDate(startDate);\n  endDate = endDate ? toStringDate(endDate) : helperNewDate();\n\n  if (isValidDate(startDate) && isValidDate(endDate)) {\n    startTime = helperGetDateTime(startDate);\n    endTime = helperGetDateTime(endDate);\n\n    if (startTime < endTime) {\n      diffTime = result.time = endTime - startTime;\n      rule = rules && rules.length > 0 ? rules : setupDefaults.dateDiffRules;\n      result.done = true;\n\n      for (index = 0, len = rule.length; index < len; index++) {\n        item = rule[index];\n\n        if (diffTime >= item[1]) {\n          if (index === len - 1) {\n            result[item[0]] = diffTime || 0;\n          } else {\n            result[item[0]] = Math.floor(diffTime / item[1]);\n            diffTime -= result[item[0]] * item[1];\n          }\n        } else {\n          result[item[0]] = 0;\n        }\n      }\n    }\n  }\n\n  return result;\n}\n\nmodule.exports = getDateDiff;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/xe-utils/getDateDiff.js"],"names":["setupDefaults","require","helperGetDateTime","helperNewDate","toStringDate","isValidDate","getDateDiff","startDate","endDate","rules","startTime","endTime","item","diffTime","rule","len","index","result","done","time","length","dateDiffRules","Math","floor","module","exports"],"mappings":"AAAA,IAAIA,aAAa,GAAGC,OAAO,CAAC,iBAAD,CAA3B;;AAEA,IAAIC,iBAAiB,GAAGD,OAAO,CAAC,qBAAD,CAA/B;;AACA,IAAIE,aAAa,GAAGF,OAAO,CAAC,iBAAD,CAA3B;;AAEA,IAAIG,YAAY,GAAGH,OAAO,CAAC,gBAAD,CAA1B;;AAEA,IAAII,WAAW,GAAGJ,OAAO,CAAC,eAAD,CAAzB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASK,WAAT,CAAsBC,SAAtB,EAAiCC,OAAjC,EAA0CC,KAA1C,EAAiD;AAC/C,MAAIC,SAAJ,EAAeC,OAAf,EAAwBC,IAAxB,EAA8BC,QAA9B,EAAwCC,IAAxC,EAA8CC,GAA9C,EAAmDC,KAAnD;AACA,MAAIC,MAAM,GAAG;AAAEC,IAAAA,IAAI,EAAE,KAAR;AAAeC,IAAAA,IAAI,EAAE;AAArB,GAAb;AACAZ,EAAAA,SAAS,GAAGH,YAAY,CAACG,SAAD,CAAxB;AACAC,EAAAA,OAAO,GAAGA,OAAO,GAAGJ,YAAY,CAACI,OAAD,CAAf,GAA2BL,aAAa,EAAzD;;AACA,MAAIE,WAAW,CAACE,SAAD,CAAX,IAA0BF,WAAW,CAACG,OAAD,CAAzC,EAAoD;AAClDE,IAAAA,SAAS,GAAGR,iBAAiB,CAACK,SAAD,CAA7B;AACAI,IAAAA,OAAO,GAAGT,iBAAiB,CAACM,OAAD,CAA3B;;AACA,QAAIE,SAAS,GAAGC,OAAhB,EAAyB;AACvBE,MAAAA,QAAQ,GAAGI,MAAM,CAACE,IAAP,GAAcR,OAAO,GAAGD,SAAnC;AACAI,MAAAA,IAAI,GAAGL,KAAK,IAAIA,KAAK,CAACW,MAAN,GAAe,CAAxB,GAA4BX,KAA5B,GAAoCT,aAAa,CAACqB,aAAzD;AACAJ,MAAAA,MAAM,CAACC,IAAP,GAAc,IAAd;;AACA,WAAKF,KAAK,GAAG,CAAR,EAAWD,GAAG,GAAGD,IAAI,CAACM,MAA3B,EAAmCJ,KAAK,GAAGD,GAA3C,EAAgDC,KAAK,EAArD,EAAyD;AACvDJ,QAAAA,IAAI,GAAGE,IAAI,CAACE,KAAD,CAAX;;AACA,YAAIH,QAAQ,IAAID,IAAI,CAAC,CAAD,CAApB,EAAyB;AACvB,cAAII,KAAK,KAAKD,GAAG,GAAG,CAApB,EAAuB;AACrBE,YAAAA,MAAM,CAACL,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkBC,QAAQ,IAAI,CAA9B;AACD,WAFD,MAEO;AACLI,YAAAA,MAAM,CAACL,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkBU,IAAI,CAACC,KAAL,CAAWV,QAAQ,GAAGD,IAAI,CAAC,CAAD,CAA1B,CAAlB;AACAC,YAAAA,QAAQ,IAAII,MAAM,CAACL,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkBA,IAAI,CAAC,CAAD,CAAlC;AACD;AACF,SAPD,MAOO;AACLK,UAAAA,MAAM,CAACL,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB,CAAlB;AACD;AACF;AACF;AACF;;AACD,SAAOK,MAAP;AACD;;AAEDO,MAAM,CAACC,OAAP,GAAiBnB,WAAjB","sourcesContent":["var setupDefaults = require('./setupDefaults')\r\n\r\nvar helperGetDateTime = require('./helperGetDateTime')\r\nvar helperNewDate = require('./helperNewDate')\r\n\r\nvar toStringDate = require('./toStringDate')\r\n\r\nvar isValidDate = require('./isValidDate')\r\n\r\n/**\r\n  * 返回两个日期之间差距,如果结束日期小于开始日期done为fasle\r\n  *\r\n  * @param {Date} startDate 开始日期\r\n  * @param {Date} endDate 结束日期或当期日期\r\n  * @param {Date} rule 自定义计算规则\r\n  * @return {Object}\r\n  */\r\nfunction getDateDiff (startDate, endDate, rules) {\r\n  var startTime, endTime, item, diffTime, rule, len, index\r\n  var result = { done: false, time: 0 }\r\n  startDate = toStringDate(startDate)\r\n  endDate = endDate ? toStringDate(endDate) : helperNewDate()\r\n  if (isValidDate(startDate) && isValidDate(endDate)) {\r\n    startTime = helperGetDateTime(startDate)\r\n    endTime = helperGetDateTime(endDate)\r\n    if (startTime < endTime) {\r\n      diffTime = result.time = endTime - startTime\r\n      rule = rules && rules.length > 0 ? rules : setupDefaults.dateDiffRules\r\n      result.done = true\r\n      for (index = 0, len = rule.length; index < len; index++) {\r\n        item = rule[index]\r\n        if (diffTime >= item[1]) {\r\n          if (index === len - 1) {\r\n            result[item[0]] = diffTime || 0\r\n          } else {\r\n            result[item[0]] = Math.floor(diffTime / item[1])\r\n            diffTime -= result[item[0]] * item[1]\r\n          }\r\n        } else {\r\n          result[item[0]] = 0\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return result\r\n}\r\n\r\nmodule.exports = getDateDiff\r\n"]},"metadata":{},"sourceType":"script"}