{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport RawAsyncValidator from 'async-validator';\nimport { cloneVNode } from 'vue';\nimport { warning } from '../../vc-util/warning';\nimport { setValues } from './valueUtil';\nimport { defaultValidateMessages } from './messages';\nimport { isValidElement } from '../../_util/props-util'; // Remove incorrect original ts define\n\nvar AsyncValidator = RawAsyncValidator;\n/**\n * Replace with template.\n *   `I'm ${name}` + { name: 'bamboo' } = I'm bamboo\n */\n\nfunction replaceMessage(template, kv) {\n  return template.replace(/\\$\\{\\w+\\}/g, function (str) {\n    var key = str.slice(2, -1);\n    return kv[key];\n  });\n}\n\nfunction validateRule(name, value, rule, options, messageVariables) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var cloneRule, subRuleField, validator, messages, result, subResults, kv, fillVariableResult;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            cloneRule = _extends({}, rule); // Bug of `async-validator`\n\n            delete cloneRule.ruleIndex; // We should special handle array validate\n\n            subRuleField = null;\n\n            if (cloneRule && cloneRule.type === 'array' && cloneRule.defaultField) {\n              subRuleField = cloneRule.defaultField;\n              delete cloneRule.defaultField;\n            }\n\n            validator = new AsyncValidator(_defineProperty({}, name, [cloneRule]));\n            messages = setValues({}, defaultValidateMessages, options.validateMessages);\n            validator.messages(messages);\n            result = [];\n            _context.prev = 8;\n            _context.next = 11;\n            return Promise.resolve(validator.validate(_defineProperty({}, name, value), _extends({}, options)));\n\n          case 11:\n            _context.next = 16;\n            break;\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](8);\n\n            if (_context.t0.errors) {\n              result = _context.t0.errors.map(function (_ref, index) {\n                var message = _ref.message;\n                return (// Wrap VueNode with `key`\n                  isValidElement(message) ? cloneVNode(message, {\n                    key: \"error_\".concat(index)\n                  }) : message\n                );\n              });\n            } else {\n              console.error(_context.t0);\n              result = [messages.default()];\n            }\n\n          case 16:\n            if (!(!result.length && subRuleField)) {\n              _context.next = 21;\n              break;\n            }\n\n            _context.next = 19;\n            return Promise.all(value.map(function (subValue, i) {\n              return validateRule(\"\".concat(name, \".\").concat(i), subValue, subRuleField, options, messageVariables);\n            }));\n\n          case 19:\n            subResults = _context.sent;\n            return _context.abrupt(\"return\", subResults.reduce(function (prev, errors) {\n              return [].concat(_toConsumableArray(prev), _toConsumableArray(errors));\n            }, []));\n\n          case 21:\n            // Replace message with variables\n            kv = _extends(_extends(_extends({}, rule), {\n              name: name,\n              enum: (rule.enum || []).join(', ')\n            }), messageVariables);\n            fillVariableResult = result.map(function (error) {\n              if (typeof error === 'string') {\n                return replaceMessage(error, kv);\n              }\n\n              return error;\n            });\n            return _context.abrupt(\"return\", fillVariableResult);\n\n          case 24:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[8, 13]]);\n  }));\n}\n/**\n * We use `async-validator` to validate the value.\n * But only check one value in a time to avoid namePath validate issue.\n */\n\n\nexport function validateRules(namePath, value, rules, options, validateFirst, messageVariables) {\n  var _this = this;\n\n  var name = namePath.join('.'); // Fill rule with context\n\n  var filledRules = rules.map(function (currentRule, ruleIndex) {\n    var originValidatorFunc = currentRule.validator;\n\n    var cloneRule = _extends(_extends({}, currentRule), {\n      ruleIndex: ruleIndex\n    }); // Replace validator if needed\n\n\n    if (originValidatorFunc) {\n      cloneRule.validator = function (rule, val, callback) {\n        var hasPromise = false; // Wrap callback only accept when promise not provided\n\n        var wrappedCallback = function wrappedCallback() {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          } // Wait a tick to make sure return type is a promise\n\n\n          Promise.resolve().then(function () {\n            warning(!hasPromise, 'Your validator function has already return a promise. `callback` will be ignored.');\n\n            if (!hasPromise) {\n              callback.apply(void 0, args);\n            }\n          });\n        }; // Get promise\n\n\n        var promise = originValidatorFunc(rule, val, wrappedCallback);\n        hasPromise = promise && typeof promise.then === 'function' && typeof promise.catch === 'function';\n        /**\n         * 1. Use promise as the first priority.\n         * 2. If promise not exist, use callback with warning instead\n         */\n\n        warning(hasPromise, '`callback` is deprecated. Please return a promise instead.');\n\n        if (hasPromise) {\n          promise.then(function () {\n            callback();\n          }).catch(function (err) {\n            callback(err || ' ');\n          });\n        }\n      };\n    }\n\n    return cloneRule;\n  }).sort(function (_ref2, _ref3) {\n    var w1 = _ref2.warningOnly,\n        i1 = _ref2.ruleIndex;\n    var w2 = _ref3.warningOnly,\n        i2 = _ref3.ruleIndex;\n\n    if (!!w1 === !!w2) {\n      // Let keep origin order\n      return i1 - i2;\n    }\n\n    if (w1) {\n      return 1;\n    }\n\n    return -1;\n  }); // Do validate rules\n\n  var summaryPromise;\n\n  if (validateFirst === true) {\n    // >>>>> Validate by serialization\n    summaryPromise = new Promise(function (resolve, reject) {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var i, rule, errors;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                i = 0;\n\n              case 1:\n                if (!(i < filledRules.length)) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                rule = filledRules[i];\n                _context2.next = 5;\n                return validateRule(name, value, rule, options, messageVariables);\n\n              case 5:\n                errors = _context2.sent;\n\n                if (!errors.length) {\n                  _context2.next = 9;\n                  break;\n                }\n\n                reject([{\n                  errors: errors,\n                  rule: rule\n                }]);\n                return _context2.abrupt(\"return\");\n\n              case 9:\n                i += 1;\n                _context2.next = 1;\n                break;\n\n              case 12:\n                /* eslint-enable */\n                resolve([]);\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    });\n  } else {\n    // >>>>> Validate by parallel\n    var rulePromises = filledRules.map(function (rule) {\n      return validateRule(name, value, rule, options, messageVariables).then(function (errors) {\n        return {\n          errors: errors,\n          rule: rule\n        };\n      });\n    });\n    summaryPromise = (validateFirst ? finishOnFirstFailed(rulePromises) : finishOnAllFailed(rulePromises)).then(function (errors) {\n      // Always change to rejection for Field to catch\n      return Promise.reject(errors);\n    });\n  } // Internal catch error to avoid console error log.\n\n\n  summaryPromise.catch(function (e) {\n    return e;\n  });\n  return summaryPromise;\n}\n\nfunction finishOnAllFailed(rulePromises) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", Promise.all(rulePromises).then(function (errorsList) {\n              var _ref4;\n\n              var errors = (_ref4 = []).concat.apply(_ref4, _toConsumableArray(errorsList));\n\n              return errors;\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n}\n\nfunction finishOnFirstFailed(rulePromises) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var count;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            count = 0;\n            return _context4.abrupt(\"return\", new Promise(function (resolve) {\n              rulePromises.forEach(function (promise) {\n                promise.then(function (ruleError) {\n                  if (ruleError.errors.length) {\n                    resolve([ruleError]);\n                  }\n\n                  count += 1;\n\n                  if (count === rulePromises.length) {\n                    resolve([]);\n                  }\n                });\n              });\n            }));\n\n          case 2:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n}","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/node_modules/ant-design-vue/es/form/utils/validateUtil.js"],"names":["_toConsumableArray","_defineProperty","_extends","_regeneratorRuntime","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","RawAsyncValidator","cloneVNode","warning","setValues","defaultValidateMessages","isValidElement","AsyncValidator","replaceMessage","template","kv","replace","str","key","slice","validateRule","name","rule","options","messageVariables","mark","_callee","cloneRule","subRuleField","validator","messages","subResults","fillVariableResult","wrap","_callee$","_context","prev","ruleIndex","type","defaultField","validateMessages","validate","t0","errors","map","_ref","index","message","concat","console","error","default","length","all","subValue","i","sent","abrupt","reduce","enum","join","stop","validateRules","namePath","rules","validateFirst","_this","filledRules","currentRule","originValidatorFunc","val","callback","hasPromise","wrappedCallback","_len","arguments","args","Array","_key","promise","catch","err","sort","_ref2","_ref3","w1","warningOnly","i1","w2","i2","summaryPromise","_callee2","_callee2$","_context2","rulePromises","finishOnFirstFailed","finishOnAllFailed","_callee3","_callee3$","_context3","errorsList","_ref4","_callee4","count","_callee4$","_context4","forEach","ruleError"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport RawAsyncValidator from 'async-validator';\nimport { cloneVNode } from 'vue';\nimport { warning } from '../../vc-util/warning';\nimport { setValues } from './valueUtil';\nimport { defaultValidateMessages } from './messages';\nimport { isValidElement } from '../../_util/props-util'; // Remove incorrect original ts define\n\nvar AsyncValidator = RawAsyncValidator;\n/**\n * Replace with template.\n *   `I'm ${name}` + { name: 'bamboo' } = I'm bamboo\n */\n\nfunction replaceMessage(template, kv) {\n  return template.replace(/\\$\\{\\w+\\}/g, function (str) {\n    var key = str.slice(2, -1);\n    return kv[key];\n  });\n}\n\nfunction validateRule(name, value, rule, options, messageVariables) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var cloneRule, subRuleField, validator, messages, result, subResults, kv, fillVariableResult;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            cloneRule = _extends({}, rule); // Bug of `async-validator`\n\n            delete cloneRule.ruleIndex; // We should special handle array validate\n\n            subRuleField = null;\n\n            if (cloneRule && cloneRule.type === 'array' && cloneRule.defaultField) {\n              subRuleField = cloneRule.defaultField;\n              delete cloneRule.defaultField;\n            }\n\n            validator = new AsyncValidator(_defineProperty({}, name, [cloneRule]));\n            messages = setValues({}, defaultValidateMessages, options.validateMessages);\n            validator.messages(messages);\n            result = [];\n            _context.prev = 8;\n            _context.next = 11;\n            return Promise.resolve(validator.validate(_defineProperty({}, name, value), _extends({}, options)));\n\n          case 11:\n            _context.next = 16;\n            break;\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](8);\n\n            if (_context.t0.errors) {\n              result = _context.t0.errors.map(function (_ref, index) {\n                var message = _ref.message;\n                return (// Wrap VueNode with `key`\n                  isValidElement(message) ? cloneVNode(message, {\n                    key: \"error_\".concat(index)\n                  }) : message\n                );\n              });\n            } else {\n              console.error(_context.t0);\n              result = [messages.default()];\n            }\n\n          case 16:\n            if (!(!result.length && subRuleField)) {\n              _context.next = 21;\n              break;\n            }\n\n            _context.next = 19;\n            return Promise.all(value.map(function (subValue, i) {\n              return validateRule(\"\".concat(name, \".\").concat(i), subValue, subRuleField, options, messageVariables);\n            }));\n\n          case 19:\n            subResults = _context.sent;\n            return _context.abrupt(\"return\", subResults.reduce(function (prev, errors) {\n              return [].concat(_toConsumableArray(prev), _toConsumableArray(errors));\n            }, []));\n\n          case 21:\n            // Replace message with variables\n            kv = _extends(_extends(_extends({}, rule), {\n              name: name,\n              enum: (rule.enum || []).join(', ')\n            }), messageVariables);\n            fillVariableResult = result.map(function (error) {\n              if (typeof error === 'string') {\n                return replaceMessage(error, kv);\n              }\n\n              return error;\n            });\n            return _context.abrupt(\"return\", fillVariableResult);\n\n          case 24:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[8, 13]]);\n  }));\n}\n/**\n * We use `async-validator` to validate the value.\n * But only check one value in a time to avoid namePath validate issue.\n */\n\n\nexport function validateRules(namePath, value, rules, options, validateFirst, messageVariables) {\n  var _this = this;\n\n  var name = namePath.join('.'); // Fill rule with context\n\n  var filledRules = rules.map(function (currentRule, ruleIndex) {\n    var originValidatorFunc = currentRule.validator;\n\n    var cloneRule = _extends(_extends({}, currentRule), {\n      ruleIndex: ruleIndex\n    }); // Replace validator if needed\n\n\n    if (originValidatorFunc) {\n      cloneRule.validator = function (rule, val, callback) {\n        var hasPromise = false; // Wrap callback only accept when promise not provided\n\n        var wrappedCallback = function wrappedCallback() {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          // Wait a tick to make sure return type is a promise\n          Promise.resolve().then(function () {\n            warning(!hasPromise, 'Your validator function has already return a promise. `callback` will be ignored.');\n\n            if (!hasPromise) {\n              callback.apply(void 0, args);\n            }\n          });\n        }; // Get promise\n\n\n        var promise = originValidatorFunc(rule, val, wrappedCallback);\n        hasPromise = promise && typeof promise.then === 'function' && typeof promise.catch === 'function';\n        /**\n         * 1. Use promise as the first priority.\n         * 2. If promise not exist, use callback with warning instead\n         */\n\n        warning(hasPromise, '`callback` is deprecated. Please return a promise instead.');\n\n        if (hasPromise) {\n          promise.then(function () {\n            callback();\n          }).catch(function (err) {\n            callback(err || ' ');\n          });\n        }\n      };\n    }\n\n    return cloneRule;\n  }).sort(function (_ref2, _ref3) {\n    var w1 = _ref2.warningOnly,\n        i1 = _ref2.ruleIndex;\n    var w2 = _ref3.warningOnly,\n        i2 = _ref3.ruleIndex;\n\n    if (!!w1 === !!w2) {\n      // Let keep origin order\n      return i1 - i2;\n    }\n\n    if (w1) {\n      return 1;\n    }\n\n    return -1;\n  }); // Do validate rules\n\n  var summaryPromise;\n\n  if (validateFirst === true) {\n    // >>>>> Validate by serialization\n    summaryPromise = new Promise(function (resolve, reject) {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var i, rule, errors;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                i = 0;\n\n              case 1:\n                if (!(i < filledRules.length)) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                rule = filledRules[i];\n                _context2.next = 5;\n                return validateRule(name, value, rule, options, messageVariables);\n\n              case 5:\n                errors = _context2.sent;\n\n                if (!errors.length) {\n                  _context2.next = 9;\n                  break;\n                }\n\n                reject([{\n                  errors: errors,\n                  rule: rule\n                }]);\n                return _context2.abrupt(\"return\");\n\n              case 9:\n                i += 1;\n                _context2.next = 1;\n                break;\n\n              case 12:\n                /* eslint-enable */\n                resolve([]);\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    });\n  } else {\n    // >>>>> Validate by parallel\n    var rulePromises = filledRules.map(function (rule) {\n      return validateRule(name, value, rule, options, messageVariables).then(function (errors) {\n        return {\n          errors: errors,\n          rule: rule\n        };\n      });\n    });\n    summaryPromise = (validateFirst ? finishOnFirstFailed(rulePromises) : finishOnAllFailed(rulePromises)).then(function (errors) {\n      // Always change to rejection for Field to catch\n      return Promise.reject(errors);\n    });\n  } // Internal catch error to avoid console error log.\n\n\n  summaryPromise.catch(function (e) {\n    return e;\n  });\n  return summaryPromise;\n}\n\nfunction finishOnAllFailed(rulePromises) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", Promise.all(rulePromises).then(function (errorsList) {\n              var _ref4;\n\n              var errors = (_ref4 = []).concat.apply(_ref4, _toConsumableArray(errorsList));\n\n              return errors;\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n}\n\nfunction finishOnFirstFailed(rulePromises) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var count;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            count = 0;\n            return _context4.abrupt(\"return\", new Promise(function (resolve) {\n              rulePromises.forEach(function (promise) {\n                promise.then(function (ruleError) {\n                  if (ruleError.errors.length) {\n                    resolve([ruleError]);\n                  }\n\n                  count += 1;\n\n                  if (count === rulePromises.length) {\n                    resolve([]);\n                  }\n                });\n              });\n            }));\n\n          case 2:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n}"]},"metadata":{},"sourceType":"module"}