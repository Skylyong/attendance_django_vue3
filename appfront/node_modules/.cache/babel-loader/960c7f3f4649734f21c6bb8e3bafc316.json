{"ast":null,"code":"import { createVNode as _createVNode } from \"vue\";\nimport { ref, watch, nextTick, onUpdated, onMounted, defineComponent } from \"vue\";\nimport { isHidden, truthProp, makeStringProp, makeNumericProp, createNamespace } from \"../utils\";\nimport { useRect, useScrollParent, useEventListener } from \"@vant/use\";\nimport { useExpose } from \"../composables/use-expose\";\nimport { useTabStatus } from \"../composables/use-tab-status\";\nimport { Loading } from \"../loading\";\nconst [name, bem, t] = createNamespace(\"list\");\nconst listProps = {\n  error: Boolean,\n  offset: makeNumericProp(300),\n  loading: Boolean,\n  finished: Boolean,\n  errorText: String,\n  direction: makeStringProp(\"down\"),\n  loadingText: String,\n  finishedText: String,\n  immediateCheck: truthProp\n};\nvar stdin_default = defineComponent({\n  name,\n  props: listProps,\n  emits: [\"load\", \"update:error\", \"update:loading\"],\n\n  setup(props, {\n    emit,\n    slots\n  }) {\n    const loading = ref(false);\n    const root = ref();\n    const placeholder = ref();\n    const tabStatus = useTabStatus();\n    const scrollParent = useScrollParent(root);\n\n    const check = () => {\n      nextTick(() => {\n        if (loading.value || props.finished || props.error || (tabStatus == null ? void 0 : tabStatus.value) === false) {\n          return;\n        }\n\n        const {\n          offset,\n          direction\n        } = props;\n        const scrollParentRect = useRect(scrollParent);\n\n        if (!scrollParentRect.height || isHidden(root)) {\n          return;\n        }\n\n        let isReachEdge = false;\n        const placeholderRect = useRect(placeholder);\n\n        if (direction === \"up\") {\n          isReachEdge = scrollParentRect.top - placeholderRect.top <= offset;\n        } else {\n          isReachEdge = placeholderRect.bottom - scrollParentRect.bottom <= offset;\n        }\n\n        if (isReachEdge) {\n          loading.value = true;\n          emit(\"update:loading\", true);\n          emit(\"load\");\n        }\n      });\n    };\n\n    const renderFinishedText = () => {\n      if (props.finished) {\n        const text = slots.finished ? slots.finished() : props.finishedText;\n\n        if (text) {\n          return _createVNode(\"div\", {\n            \"class\": bem(\"finished-text\")\n          }, [text]);\n        }\n      }\n    };\n\n    const clickErrorText = () => {\n      emit(\"update:error\", false);\n      check();\n    };\n\n    const renderErrorText = () => {\n      if (props.error) {\n        const text = slots.error ? slots.error() : props.errorText;\n\n        if (text) {\n          return _createVNode(\"div\", {\n            \"role\": \"button\",\n            \"class\": bem(\"error-text\"),\n            \"tabindex\": 0,\n            \"onClick\": clickErrorText\n          }, [text]);\n        }\n      }\n    };\n\n    const renderLoading = () => {\n      if (loading.value && !props.finished) {\n        return _createVNode(\"div\", {\n          \"class\": bem(\"loading\")\n        }, [slots.loading ? slots.loading() : _createVNode(Loading, {\n          \"class\": bem(\"loading-icon\")\n        }, {\n          default: () => [props.loadingText || t(\"loading\")]\n        })]);\n      }\n    };\n\n    watch(() => [props.loading, props.finished, props.error], check);\n\n    if (tabStatus) {\n      watch(tabStatus, tabActive => {\n        if (tabActive) {\n          check();\n        }\n      });\n    }\n\n    onUpdated(() => {\n      loading.value = props.loading;\n    });\n    onMounted(() => {\n      if (props.immediateCheck) {\n        check();\n      }\n    });\n    useExpose({\n      check\n    });\n    useEventListener(\"scroll\", check, {\n      target: scrollParent\n    });\n    return () => {\n      var _a;\n\n      const Content = (_a = slots.default) == null ? void 0 : _a.call(slots);\n\n      const Placeholder = _createVNode(\"div\", {\n        \"ref\": placeholder,\n        \"class\": bem(\"placeholder\")\n      }, null);\n\n      return _createVNode(\"div\", {\n        \"ref\": root,\n        \"role\": \"feed\",\n        \"class\": bem(),\n        \"aria-busy\": loading.value\n      }, [props.direction === \"down\" ? Content : Placeholder, renderLoading(), renderFinishedText(), renderErrorText(), props.direction === \"up\" ? Content : Placeholder]);\n    };\n  }\n\n});\nexport { stdin_default as default };","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/vant/es/list/List.js"],"names":["createVNode","_createVNode","ref","watch","nextTick","onUpdated","onMounted","defineComponent","isHidden","truthProp","makeStringProp","makeNumericProp","createNamespace","useRect","useScrollParent","useEventListener","useExpose","useTabStatus","Loading","name","bem","t","listProps","error","Boolean","offset","loading","finished","errorText","String","direction","loadingText","finishedText","immediateCheck","stdin_default","props","emits","setup","emit","slots","root","placeholder","tabStatus","scrollParent","check","value","scrollParentRect","height","isReachEdge","placeholderRect","top","bottom","renderFinishedText","text","clickErrorText","renderErrorText","renderLoading","default","tabActive","target","_a","Content","call","Placeholder"],"mappings":"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","sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport { ref, watch, nextTick, onUpdated, onMounted, defineComponent } from \"vue\";\nimport { isHidden, truthProp, makeStringProp, makeNumericProp, createNamespace } from \"../utils\";\nimport { useRect, useScrollParent, useEventListener } from \"@vant/use\";\nimport { useExpose } from \"../composables/use-expose\";\nimport { useTabStatus } from \"../composables/use-tab-status\";\nimport { Loading } from \"../loading\";\nconst [name, bem, t] = createNamespace(\"list\");\nconst listProps = {\n  error: Boolean,\n  offset: makeNumericProp(300),\n  loading: Boolean,\n  finished: Boolean,\n  errorText: String,\n  direction: makeStringProp(\"down\"),\n  loadingText: String,\n  finishedText: String,\n  immediateCheck: truthProp\n};\nvar stdin_default = defineComponent({\n  name,\n  props: listProps,\n  emits: [\"load\", \"update:error\", \"update:loading\"],\n  setup(props, {\n    emit,\n    slots\n  }) {\n    const loading = ref(false);\n    const root = ref();\n    const placeholder = ref();\n    const tabStatus = useTabStatus();\n    const scrollParent = useScrollParent(root);\n    const check = () => {\n      nextTick(() => {\n        if (loading.value || props.finished || props.error || (tabStatus == null ? void 0 : tabStatus.value) === false) {\n          return;\n        }\n        const {\n          offset,\n          direction\n        } = props;\n        const scrollParentRect = useRect(scrollParent);\n        if (!scrollParentRect.height || isHidden(root)) {\n          return;\n        }\n        let isReachEdge = false;\n        const placeholderRect = useRect(placeholder);\n        if (direction === \"up\") {\n          isReachEdge = scrollParentRect.top - placeholderRect.top <= offset;\n        } else {\n          isReachEdge = placeholderRect.bottom - scrollParentRect.bottom <= offset;\n        }\n        if (isReachEdge) {\n          loading.value = true;\n          emit(\"update:loading\", true);\n          emit(\"load\");\n        }\n      });\n    };\n    const renderFinishedText = () => {\n      if (props.finished) {\n        const text = slots.finished ? slots.finished() : props.finishedText;\n        if (text) {\n          return _createVNode(\"div\", {\n            \"class\": bem(\"finished-text\")\n          }, [text]);\n        }\n      }\n    };\n    const clickErrorText = () => {\n      emit(\"update:error\", false);\n      check();\n    };\n    const renderErrorText = () => {\n      if (props.error) {\n        const text = slots.error ? slots.error() : props.errorText;\n        if (text) {\n          return _createVNode(\"div\", {\n            \"role\": \"button\",\n            \"class\": bem(\"error-text\"),\n            \"tabindex\": 0,\n            \"onClick\": clickErrorText\n          }, [text]);\n        }\n      }\n    };\n    const renderLoading = () => {\n      if (loading.value && !props.finished) {\n        return _createVNode(\"div\", {\n          \"class\": bem(\"loading\")\n        }, [slots.loading ? slots.loading() : _createVNode(Loading, {\n          \"class\": bem(\"loading-icon\")\n        }, {\n          default: () => [props.loadingText || t(\"loading\")]\n        })]);\n      }\n    };\n    watch(() => [props.loading, props.finished, props.error], check);\n    if (tabStatus) {\n      watch(tabStatus, (tabActive) => {\n        if (tabActive) {\n          check();\n        }\n      });\n    }\n    onUpdated(() => {\n      loading.value = props.loading;\n    });\n    onMounted(() => {\n      if (props.immediateCheck) {\n        check();\n      }\n    });\n    useExpose({\n      check\n    });\n    useEventListener(\"scroll\", check, {\n      target: scrollParent\n    });\n    return () => {\n      var _a;\n      const Content = (_a = slots.default) == null ? void 0 : _a.call(slots);\n      const Placeholder = _createVNode(\"div\", {\n        \"ref\": placeholder,\n        \"class\": bem(\"placeholder\")\n      }, null);\n      return _createVNode(\"div\", {\n        \"ref\": root,\n        \"role\": \"feed\",\n        \"class\": bem(),\n        \"aria-busy\": loading.value\n      }, [props.direction === \"down\" ? Content : Placeholder, renderLoading(), renderFinishedText(), renderErrorText(), props.direction === \"up\" ? Content : Placeholder]);\n    };\n  }\n});\nexport {\n  stdin_default as default\n};\n"]},"metadata":{},"sourceType":"module"}