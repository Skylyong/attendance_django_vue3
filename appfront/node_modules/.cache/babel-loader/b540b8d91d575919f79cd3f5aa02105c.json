{"ast":null,"code":"import { withDirectives as _withDirectives, vShow as _vShow, createVNode as _createVNode } from \"vue\";\nimport { ref, watch, computed, nextTick, onMounted, defineComponent } from \"vue\";\nimport { truthProp, windowHeight, makeArrayProp, makeStringProp, makeNumberProp, createNamespace } from \"../utils\";\nimport { useRefs } from \"../composables/use-refs\";\nimport { Tab } from \"../tab\";\nimport { Tabs } from \"../tabs\";\nimport { Field } from \"../field\";\nimport { Button } from \"../button\";\nimport { Coupon } from \"../coupon\";\nimport { useRect } from \"@vant/use\";\nconst [name, bem, t] = createNamespace(\"coupon-list\");\nconst EMPTY_IMAGE = \"https://img.yzcdn.cn/vant/coupon-empty.png\";\nconst couponListProps = {\n  code: makeStringProp(\"\"),\n  coupons: makeArrayProp(),\n  currency: makeStringProp(\"\\xA5\"),\n  showCount: truthProp,\n  emptyImage: makeStringProp(EMPTY_IMAGE),\n  chosenCoupon: makeNumberProp(-1),\n  enabledTitle: String,\n  disabledTitle: String,\n  disabledCoupons: makeArrayProp(),\n  showExchangeBar: truthProp,\n  showCloseButton: truthProp,\n  closeButtonText: String,\n  inputPlaceholder: String,\n  exchangeMinLength: makeNumberProp(1),\n  exchangeButtonText: String,\n  displayedCouponIndex: makeNumberProp(-1),\n  exchangeButtonLoading: Boolean,\n  exchangeButtonDisabled: Boolean\n};\nvar stdin_default = defineComponent({\n  name,\n  props: couponListProps,\n  emits: [\"change\", \"exchange\", \"update:code\"],\n\n  setup(props, {\n    emit,\n    slots\n  }) {\n    const [couponRefs, setCouponRefs] = useRefs();\n    const root = ref();\n    const barRef = ref();\n    const activeTab = ref(0);\n    const listHeight = ref(0);\n    const currentCode = ref(props.code);\n    const buttonDisabled = computed(() => !props.exchangeButtonLoading && (props.exchangeButtonDisabled || !currentCode.value || currentCode.value.length < props.exchangeMinLength));\n\n    const updateListHeight = () => {\n      const TABS_HEIGHT = 44;\n      const rootHeight = useRect(root).height;\n      const headerHeight = useRect(barRef).height + TABS_HEIGHT;\n      listHeight.value = (rootHeight > headerHeight ? rootHeight : windowHeight.value) - headerHeight;\n    };\n\n    const onExchange = () => {\n      emit(\"exchange\", currentCode.value);\n\n      if (!props.code) {\n        currentCode.value = \"\";\n      }\n    };\n\n    const scrollToCoupon = index => {\n      nextTick(() => {\n        var _a;\n\n        return (_a = couponRefs.value[index]) == null ? void 0 : _a.scrollIntoView();\n      });\n    };\n\n    const renderEmpty = () => _createVNode(\"div\", {\n      \"class\": bem(\"empty\")\n    }, [_createVNode(\"img\", {\n      \"src\": props.emptyImage\n    }, null), _createVNode(\"p\", null, [t(\"noCoupon\")])]);\n\n    const renderExchangeBar = () => {\n      if (props.showExchangeBar) {\n        return _createVNode(\"div\", {\n          \"ref\": barRef,\n          \"class\": bem(\"exchange-bar\")\n        }, [_createVNode(Field, {\n          \"modelValue\": currentCode.value,\n          \"onUpdate:modelValue\": $event => currentCode.value = $event,\n          \"clearable\": true,\n          \"border\": false,\n          \"class\": bem(\"field\"),\n          \"placeholder\": props.inputPlaceholder || t(\"placeholder\"),\n          \"maxlength\": \"20\"\n        }, null), _createVNode(Button, {\n          \"plain\": true,\n          \"type\": \"danger\",\n          \"class\": bem(\"exchange\"),\n          \"text\": props.exchangeButtonText || t(\"exchange\"),\n          \"loading\": props.exchangeButtonLoading,\n          \"disabled\": buttonDisabled.value,\n          \"onClick\": onExchange\n        }, null)]);\n      }\n    };\n\n    const renderCouponTab = () => {\n      const {\n        coupons\n      } = props;\n      const count = props.showCount ? ` (${coupons.length})` : \"\";\n      const title = (props.enabledTitle || t(\"enable\")) + count;\n      return _createVNode(Tab, {\n        \"title\": title\n      }, {\n        default: () => {\n          var _a;\n\n          return [_createVNode(\"div\", {\n            \"class\": bem(\"list\", {\n              \"with-bottom\": props.showCloseButton\n            }),\n            \"style\": {\n              height: `${listHeight.value}px`\n            }\n          }, [coupons.map((coupon, index) => _createVNode(Coupon, {\n            \"key\": coupon.id,\n            \"ref\": setCouponRefs(index),\n            \"coupon\": coupon,\n            \"chosen\": index === props.chosenCoupon,\n            \"currency\": props.currency,\n            \"onClick\": () => emit(\"change\", index)\n          }, null)), !coupons.length && renderEmpty(), (_a = slots[\"list-footer\"]) == null ? void 0 : _a.call(slots)])];\n        }\n      });\n    };\n\n    const renderDisabledTab = () => {\n      const {\n        disabledCoupons\n      } = props;\n      const count = props.showCount ? ` (${disabledCoupons.length})` : \"\";\n      const title = (props.disabledTitle || t(\"disabled\")) + count;\n      return _createVNode(Tab, {\n        \"title\": title\n      }, {\n        default: () => {\n          var _a;\n\n          return [_createVNode(\"div\", {\n            \"class\": bem(\"list\", {\n              \"with-bottom\": props.showCloseButton\n            }),\n            \"style\": {\n              height: `${listHeight.value}px`\n            }\n          }, [disabledCoupons.map(coupon => _createVNode(Coupon, {\n            \"disabled\": true,\n            \"key\": coupon.id,\n            \"coupon\": coupon,\n            \"currency\": props.currency\n          }, null)), !disabledCoupons.length && renderEmpty(), (_a = slots[\"disabled-list-footer\"]) == null ? void 0 : _a.call(slots)])];\n        }\n      });\n    };\n\n    watch(() => props.code, value => {\n      currentCode.value = value;\n    });\n    watch(windowHeight, updateListHeight);\n    watch(currentCode, value => emit(\"update:code\", value));\n    watch(() => props.displayedCouponIndex, scrollToCoupon);\n    onMounted(() => {\n      updateListHeight();\n      scrollToCoupon(props.displayedCouponIndex);\n    });\n    return () => _createVNode(\"div\", {\n      \"ref\": root,\n      \"class\": bem()\n    }, [renderExchangeBar(), _createVNode(Tabs, {\n      \"active\": activeTab.value,\n      \"onUpdate:active\": $event => activeTab.value = $event,\n      \"class\": bem(\"tab\")\n    }, {\n      default: () => [renderCouponTab(), renderDisabledTab()]\n    }), _createVNode(\"div\", {\n      \"class\": bem(\"bottom\")\n    }, [_withDirectives(_createVNode(Button, {\n      \"round\": true,\n      \"block\": true,\n      \"type\": \"danger\",\n      \"class\": bem(\"close\"),\n      \"text\": props.closeButtonText || t(\"close\"),\n      \"onClick\": () => emit(\"change\", -1)\n    }, null), [[_vShow, props.showCloseButton]])])]);\n  }\n\n});\nexport { stdin_default as default };","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/vant/es/coupon-list/CouponList.js"],"names":["withDirectives","_withDirectives","vShow","_vShow","createVNode","_createVNode","ref","watch","computed","nextTick","onMounted","defineComponent","truthProp","windowHeight","makeArrayProp","makeStringProp","makeNumberProp","createNamespace","useRefs","Tab","Tabs","Field","Button","Coupon","useRect","name","bem","t","EMPTY_IMAGE","couponListProps","code","coupons","currency","showCount","emptyImage","chosenCoupon","enabledTitle","String","disabledTitle","disabledCoupons","showExchangeBar","showCloseButton","closeButtonText","inputPlaceholder","exchangeMinLength","exchangeButtonText","displayedCouponIndex","exchangeButtonLoading","Boolean","exchangeButtonDisabled","stdin_default","props","emits","setup","emit","slots","couponRefs","setCouponRefs","root","barRef","activeTab","listHeight","currentCode","buttonDisabled","value","length","updateListHeight","TABS_HEIGHT","rootHeight","height","headerHeight","onExchange","scrollToCoupon","index","_a","scrollIntoView","renderEmpty","renderExchangeBar","$event","renderCouponTab","count","title","default","map","coupon","id","call","renderDisabledTab"],"mappings":"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","sourcesContent":["import { withDirectives as _withDirectives, vShow as _vShow, createVNode as _createVNode } from \"vue\";\nimport { ref, watch, computed, nextTick, onMounted, defineComponent } from \"vue\";\nimport { truthProp, windowHeight, makeArrayProp, makeStringProp, makeNumberProp, createNamespace } from \"../utils\";\nimport { useRefs } from \"../composables/use-refs\";\nimport { Tab } from \"../tab\";\nimport { Tabs } from \"../tabs\";\nimport { Field } from \"../field\";\nimport { Button } from \"../button\";\nimport { Coupon } from \"../coupon\";\nimport { useRect } from \"@vant/use\";\nconst [name, bem, t] = createNamespace(\"coupon-list\");\nconst EMPTY_IMAGE = \"https://img.yzcdn.cn/vant/coupon-empty.png\";\nconst couponListProps = {\n  code: makeStringProp(\"\"),\n  coupons: makeArrayProp(),\n  currency: makeStringProp(\"\\xA5\"),\n  showCount: truthProp,\n  emptyImage: makeStringProp(EMPTY_IMAGE),\n  chosenCoupon: makeNumberProp(-1),\n  enabledTitle: String,\n  disabledTitle: String,\n  disabledCoupons: makeArrayProp(),\n  showExchangeBar: truthProp,\n  showCloseButton: truthProp,\n  closeButtonText: String,\n  inputPlaceholder: String,\n  exchangeMinLength: makeNumberProp(1),\n  exchangeButtonText: String,\n  displayedCouponIndex: makeNumberProp(-1),\n  exchangeButtonLoading: Boolean,\n  exchangeButtonDisabled: Boolean\n};\nvar stdin_default = defineComponent({\n  name,\n  props: couponListProps,\n  emits: [\"change\", \"exchange\", \"update:code\"],\n  setup(props, {\n    emit,\n    slots\n  }) {\n    const [couponRefs, setCouponRefs] = useRefs();\n    const root = ref();\n    const barRef = ref();\n    const activeTab = ref(0);\n    const listHeight = ref(0);\n    const currentCode = ref(props.code);\n    const buttonDisabled = computed(() => !props.exchangeButtonLoading && (props.exchangeButtonDisabled || !currentCode.value || currentCode.value.length < props.exchangeMinLength));\n    const updateListHeight = () => {\n      const TABS_HEIGHT = 44;\n      const rootHeight = useRect(root).height;\n      const headerHeight = useRect(barRef).height + TABS_HEIGHT;\n      listHeight.value = (rootHeight > headerHeight ? rootHeight : windowHeight.value) - headerHeight;\n    };\n    const onExchange = () => {\n      emit(\"exchange\", currentCode.value);\n      if (!props.code) {\n        currentCode.value = \"\";\n      }\n    };\n    const scrollToCoupon = (index) => {\n      nextTick(() => {\n        var _a;\n        return (_a = couponRefs.value[index]) == null ? void 0 : _a.scrollIntoView();\n      });\n    };\n    const renderEmpty = () => _createVNode(\"div\", {\n      \"class\": bem(\"empty\")\n    }, [_createVNode(\"img\", {\n      \"src\": props.emptyImage\n    }, null), _createVNode(\"p\", null, [t(\"noCoupon\")])]);\n    const renderExchangeBar = () => {\n      if (props.showExchangeBar) {\n        return _createVNode(\"div\", {\n          \"ref\": barRef,\n          \"class\": bem(\"exchange-bar\")\n        }, [_createVNode(Field, {\n          \"modelValue\": currentCode.value,\n          \"onUpdate:modelValue\": ($event) => currentCode.value = $event,\n          \"clearable\": true,\n          \"border\": false,\n          \"class\": bem(\"field\"),\n          \"placeholder\": props.inputPlaceholder || t(\"placeholder\"),\n          \"maxlength\": \"20\"\n        }, null), _createVNode(Button, {\n          \"plain\": true,\n          \"type\": \"danger\",\n          \"class\": bem(\"exchange\"),\n          \"text\": props.exchangeButtonText || t(\"exchange\"),\n          \"loading\": props.exchangeButtonLoading,\n          \"disabled\": buttonDisabled.value,\n          \"onClick\": onExchange\n        }, null)]);\n      }\n    };\n    const renderCouponTab = () => {\n      const {\n        coupons\n      } = props;\n      const count = props.showCount ? ` (${coupons.length})` : \"\";\n      const title = (props.enabledTitle || t(\"enable\")) + count;\n      return _createVNode(Tab, {\n        \"title\": title\n      }, {\n        default: () => {\n          var _a;\n          return [_createVNode(\"div\", {\n            \"class\": bem(\"list\", {\n              \"with-bottom\": props.showCloseButton\n            }),\n            \"style\": {\n              height: `${listHeight.value}px`\n            }\n          }, [coupons.map((coupon, index) => _createVNode(Coupon, {\n            \"key\": coupon.id,\n            \"ref\": setCouponRefs(index),\n            \"coupon\": coupon,\n            \"chosen\": index === props.chosenCoupon,\n            \"currency\": props.currency,\n            \"onClick\": () => emit(\"change\", index)\n          }, null)), !coupons.length && renderEmpty(), (_a = slots[\"list-footer\"]) == null ? void 0 : _a.call(slots)])];\n        }\n      });\n    };\n    const renderDisabledTab = () => {\n      const {\n        disabledCoupons\n      } = props;\n      const count = props.showCount ? ` (${disabledCoupons.length})` : \"\";\n      const title = (props.disabledTitle || t(\"disabled\")) + count;\n      return _createVNode(Tab, {\n        \"title\": title\n      }, {\n        default: () => {\n          var _a;\n          return [_createVNode(\"div\", {\n            \"class\": bem(\"list\", {\n              \"with-bottom\": props.showCloseButton\n            }),\n            \"style\": {\n              height: `${listHeight.value}px`\n            }\n          }, [disabledCoupons.map((coupon) => _createVNode(Coupon, {\n            \"disabled\": true,\n            \"key\": coupon.id,\n            \"coupon\": coupon,\n            \"currency\": props.currency\n          }, null)), !disabledCoupons.length && renderEmpty(), (_a = slots[\"disabled-list-footer\"]) == null ? void 0 : _a.call(slots)])];\n        }\n      });\n    };\n    watch(() => props.code, (value) => {\n      currentCode.value = value;\n    });\n    watch(windowHeight, updateListHeight);\n    watch(currentCode, (value) => emit(\"update:code\", value));\n    watch(() => props.displayedCouponIndex, scrollToCoupon);\n    onMounted(() => {\n      updateListHeight();\n      scrollToCoupon(props.displayedCouponIndex);\n    });\n    return () => _createVNode(\"div\", {\n      \"ref\": root,\n      \"class\": bem()\n    }, [renderExchangeBar(), _createVNode(Tabs, {\n      \"active\": activeTab.value,\n      \"onUpdate:active\": ($event) => activeTab.value = $event,\n      \"class\": bem(\"tab\")\n    }, {\n      default: () => [renderCouponTab(), renderDisabledTab()]\n    }), _createVNode(\"div\", {\n      \"class\": bem(\"bottom\")\n    }, [_withDirectives(_createVNode(Button, {\n      \"round\": true,\n      \"block\": true,\n      \"type\": \"danger\",\n      \"class\": bem(\"close\"),\n      \"text\": props.closeButtonText || t(\"close\"),\n      \"onClick\": () => emit(\"change\", -1)\n    }, null), [[_vShow, props.showCloseButton]])])]);\n  }\n});\nexport {\n  stdin_default as default\n};\n"]},"metadata":{},"sourceType":"module"}