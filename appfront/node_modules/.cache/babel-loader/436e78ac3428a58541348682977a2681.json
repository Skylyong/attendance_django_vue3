{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { createVNode as _createVNode } from \"vue\";\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport partition from 'lodash-es/partition';\nimport classNames from '../../_util/classNames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\nimport { getSlot } from '../../_util/props-util';\nvar upLoadPropTypes = {\n  componentTag: PropTypes.string,\n  // style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  name: PropTypes.string,\n  // className: PropTypes.string,\n  multiple: PropTypes.looseBool,\n  directory: PropTypes.looseBool,\n  disabled: PropTypes.looseBool,\n  accept: PropTypes.string,\n  // children: PropTypes.any,\n  // onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  // onProgress: PropTypes.func,\n  withCredentials: PropTypes.looseBool,\n  openFileDialogOnClick: PropTypes.looseBool,\n  transformFile: PropTypes.func,\n  method: PropTypes.string\n};\nvar AjaxUploader = {\n  inheritAttrs: false,\n  name: 'ajaxUploader',\n  mixins: [BaseMixin],\n  props: upLoadPropTypes,\n  data: function data() {\n    this.reqs = {};\n    return {\n      uid: getUid()\n    };\n  },\n  mounted: function mounted() {\n    this._isMounted = true;\n  },\n  beforeUnmount: function beforeUnmount() {\n    this._isMounted = false;\n    this.abort();\n  },\n  methods: {\n    onChange: function onChange(e) {\n      var files = e.target.files;\n      this.uploadFiles(files);\n      this.reset();\n    },\n    onClick: function onClick() {\n      var el = this.$refs.fileInputRef;\n\n      if (!el) {\n        return;\n      }\n\n      el.click();\n    },\n    onKeyDown: function onKeyDown(e) {\n      if (e.key === 'Enter') {\n        this.onClick();\n      }\n    },\n    onFileDrop: function onFileDrop(e) {\n      var _this = this;\n\n      var multiple = this.$props.multiple;\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (this.directory) {\n        traverseFileTree(e.dataTransfer.items, this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.accept);\n        });\n      } else {\n        var files = partition(Array.prototype.slice.call(e.dataTransfer.files), function (file) {\n          return attrAccept(file, _this.accept);\n        });\n        var successFiles = files[0];\n        var errorFiles = files[1];\n\n        if (multiple === false) {\n          successFiles = successFiles.slice(0, 1);\n        }\n\n        this.uploadFiles(successFiles);\n\n        if (errorFiles.length) {\n          this.__emit('reject', errorFiles);\n        }\n      }\n    },\n    uploadFiles: function uploadFiles(files) {\n      var _this2 = this;\n\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.map(function (file) {\n        file.uid = getUid();\n        return file;\n      }).forEach(function (file) {\n        _this2.upload(file, postFiles);\n      });\n    },\n    upload: function upload(file, fileList) {\n      var _this3 = this;\n\n      if (!this.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n\n      var before = this.beforeUpload(file, fileList);\n\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this3.post(processedFile);\n          }\n\n          return _this3.post(file);\n        }).catch(function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n    },\n    post: function post(file) {\n      var _this4 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n\n      var props = this.$props;\n      var data = props.data;\n      var _props$transformFile = props.transformFile,\n          transformFile = _props$transformFile === void 0 ? function (originFile) {\n        return originFile;\n      } : _props$transformFile;\n      new Promise(function (resolve) {\n        var action = _this4.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n        var request = _this4.customRequest || defaultRequest;\n        var transform = Promise.resolve(transformFile(file)).catch(function (e) {\n          console.error(e); // eslint-disable-line no-console\n        });\n        transform.then(function (transformedFile) {\n          if (typeof data === 'function') {\n            data = data(file);\n          }\n\n          var requestOption = {\n            action: action,\n            filename: _this4.name,\n            data: data,\n            file: transformedFile,\n            headers: _this4.headers,\n            withCredentials: _this4.withCredentials,\n            method: props.method || 'post',\n            onProgress: function onProgress(e) {\n              _this4.__emit('progress', e, file);\n            },\n            onSuccess: function onSuccess(ret, xhr) {\n              delete _this4.reqs[uid];\n\n              _this4.__emit('success', ret, file, xhr);\n            },\n            onError: function onError(err, ret) {\n              delete _this4.reqs[uid];\n\n              _this4.__emit('error', err, ret, file);\n            }\n          };\n          _this4.reqs[uid] = request(requestOption);\n\n          _this4.__emit('start', file);\n        });\n      });\n    },\n    reset: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    },\n    abort: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (reqs[uid] && reqs[uid].abort) {\n          reqs[uid].abort();\n        }\n\n        delete reqs[uid];\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid] && reqs[uid].abort) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  },\n  render: function render() {\n    var _classNames,\n        _this5 = this;\n\n    var $props = this.$props,\n        $attrs = this.$attrs;\n    var Tag = $props.componentTag,\n        prefixCls = $props.prefixCls,\n        disabled = $props.disabled,\n        multiple = $props.multiple,\n        accept = $props.accept,\n        directory = $props.directory,\n        openFileDialogOnClick = $props.openFileDialogOnClick;\n    var className = $attrs.class,\n        style = $attrs.style,\n        id = $attrs.id;\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, \"\".concat(prefixCls, \"-disabled\"), disabled), _defineProperty(_classNames, className, className), _classNames));\n    var events = disabled ? {} : {\n      onClick: openFileDialogOnClick ? this.onClick : function () {},\n      onKeydown: openFileDialogOnClick ? this.onKeyDown : function () {},\n      onDrop: this.onFileDrop,\n      onDragover: this.onFileDrop\n    };\n\n    var tagProps = _extends(_extends({}, events), {\n      role: 'button',\n      tabindex: disabled ? null : '0',\n      class: cls,\n      style: style\n    });\n\n    return _createVNode(Tag, tagProps, {\n      default: function _default() {\n        return [_createVNode(\"input\", {\n          \"id\": id,\n          \"type\": \"file\",\n          \"ref\": \"fileInputRef\",\n          \"onClick\": function onClick(e) {\n            return e.stopPropagation();\n          },\n          \"key\": _this5.uid,\n          \"style\": {\n            display: 'none'\n          },\n          \"accept\": accept,\n          \"directory\": directory ? 'directory' : null,\n          \"webkitdirectory\": directory ? 'webkitdirectory' : null,\n          \"multiple\": multiple,\n          \"onChange\": _this5.onChange\n        }, null), getSlot(_this5)];\n      }\n    });\n  }\n};\nexport default AjaxUploader;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/ant-design-vue/es/vc-upload/src/AjaxUploader.js"],"names":["_extends","_defineProperty","createVNode","_createVNode","PropTypes","BaseMixin","partition","classNames","defaultRequest","getUid","attrAccept","traverseFileTree","getSlot","upLoadPropTypes","componentTag","string","prefixCls","name","multiple","looseBool","directory","disabled","accept","data","oneOfType","object","func","action","headers","beforeUpload","customRequest","withCredentials","openFileDialogOnClick","transformFile","method","AjaxUploader","inheritAttrs","mixins","props","reqs","uid","mounted","_isMounted","beforeUnmount","abort","methods","onChange","e","files","target","uploadFiles","reset","onClick","el","$refs","fileInputRef","click","onKeyDown","key","onFileDrop","_this","$props","preventDefault","type","dataTransfer","items","_file","Array","prototype","slice","call","file","successFiles","errorFiles","length","__emit","_this2","postFiles","map","forEach","upload","fileList","_this3","setTimeout","post","before","then","processedFile","processedFileType","Object","toString","catch","console","log","_this4","_props$transformFile","originFile","Promise","resolve","request","transform","error","transformedFile","requestOption","filename","onProgress","onSuccess","ret","xhr","onError","err","setState","keys","render","_classNames","_this5","$attrs","Tag","className","class","style","id","cls","concat","events","onKeydown","onDrop","onDragover","tagProps","role","tabindex","default","_default","stopPropagation","display"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { createVNode as _createVNode } from \"vue\";\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport partition from 'lodash-es/partition';\nimport classNames from '../../_util/classNames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\nimport traverseFileTree from './traverseFileTree';\nimport { getSlot } from '../../_util/props-util';\nvar upLoadPropTypes = {\n  componentTag: PropTypes.string,\n  // style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  name: PropTypes.string,\n  // className: PropTypes.string,\n  multiple: PropTypes.looseBool,\n  directory: PropTypes.looseBool,\n  disabled: PropTypes.looseBool,\n  accept: PropTypes.string,\n  // children: PropTypes.any,\n  // onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  // onProgress: PropTypes.func,\n  withCredentials: PropTypes.looseBool,\n  openFileDialogOnClick: PropTypes.looseBool,\n  transformFile: PropTypes.func,\n  method: PropTypes.string\n};\nvar AjaxUploader = {\n  inheritAttrs: false,\n  name: 'ajaxUploader',\n  mixins: [BaseMixin],\n  props: upLoadPropTypes,\n  data: function data() {\n    this.reqs = {};\n    return {\n      uid: getUid()\n    };\n  },\n  mounted: function mounted() {\n    this._isMounted = true;\n  },\n  beforeUnmount: function beforeUnmount() {\n    this._isMounted = false;\n    this.abort();\n  },\n  methods: {\n    onChange: function onChange(e) {\n      var files = e.target.files;\n      this.uploadFiles(files);\n      this.reset();\n    },\n    onClick: function onClick() {\n      var el = this.$refs.fileInputRef;\n\n      if (!el) {\n        return;\n      }\n\n      el.click();\n    },\n    onKeyDown: function onKeyDown(e) {\n      if (e.key === 'Enter') {\n        this.onClick();\n      }\n    },\n    onFileDrop: function onFileDrop(e) {\n      var _this = this;\n\n      var multiple = this.$props.multiple;\n      e.preventDefault();\n\n      if (e.type === 'dragover') {\n        return;\n      }\n\n      if (this.directory) {\n        traverseFileTree(e.dataTransfer.items, this.uploadFiles, function (_file) {\n          return attrAccept(_file, _this.accept);\n        });\n      } else {\n        var files = partition(Array.prototype.slice.call(e.dataTransfer.files), function (file) {\n          return attrAccept(file, _this.accept);\n        });\n        var successFiles = files[0];\n        var errorFiles = files[1];\n\n        if (multiple === false) {\n          successFiles = successFiles.slice(0, 1);\n        }\n\n        this.uploadFiles(successFiles);\n\n        if (errorFiles.length) {\n          this.__emit('reject', errorFiles);\n        }\n      }\n    },\n    uploadFiles: function uploadFiles(files) {\n      var _this2 = this;\n\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.map(function (file) {\n        file.uid = getUid();\n        return file;\n      }).forEach(function (file) {\n        _this2.upload(file, postFiles);\n      });\n    },\n    upload: function upload(file, fileList) {\n      var _this3 = this;\n\n      if (!this.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n\n      var before = this.beforeUpload(file, fileList);\n\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            return _this3.post(processedFile);\n          }\n\n          return _this3.post(file);\n        }).catch(function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n    },\n    post: function post(file) {\n      var _this4 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n\n      var props = this.$props;\n      var data = props.data;\n      var _props$transformFile = props.transformFile,\n          transformFile = _props$transformFile === void 0 ? function (originFile) {\n        return originFile;\n      } : _props$transformFile;\n      new Promise(function (resolve) {\n        var action = _this4.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        var uid = file.uid;\n        var request = _this4.customRequest || defaultRequest;\n        var transform = Promise.resolve(transformFile(file)).catch(function (e) {\n          console.error(e); // eslint-disable-line no-console\n        });\n        transform.then(function (transformedFile) {\n          if (typeof data === 'function') {\n            data = data(file);\n          }\n\n          var requestOption = {\n            action: action,\n            filename: _this4.name,\n            data: data,\n            file: transformedFile,\n            headers: _this4.headers,\n            withCredentials: _this4.withCredentials,\n            method: props.method || 'post',\n            onProgress: function onProgress(e) {\n              _this4.__emit('progress', e, file);\n            },\n            onSuccess: function onSuccess(ret, xhr) {\n              delete _this4.reqs[uid];\n\n              _this4.__emit('success', ret, file, xhr);\n            },\n            onError: function onError(err, ret) {\n              delete _this4.reqs[uid];\n\n              _this4.__emit('error', err, ret, file);\n            }\n          };\n          _this4.reqs[uid] = request(requestOption);\n\n          _this4.__emit('start', file);\n        });\n      });\n    },\n    reset: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    },\n    abort: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (reqs[uid] && reqs[uid].abort) {\n          reqs[uid].abort();\n        }\n\n        delete reqs[uid];\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid] && reqs[uid].abort) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  },\n  render: function render() {\n    var _classNames,\n        _this5 = this;\n\n    var $props = this.$props,\n        $attrs = this.$attrs;\n    var Tag = $props.componentTag,\n        prefixCls = $props.prefixCls,\n        disabled = $props.disabled,\n        multiple = $props.multiple,\n        accept = $props.accept,\n        directory = $props.directory,\n        openFileDialogOnClick = $props.openFileDialogOnClick;\n    var className = $attrs.class,\n        style = $attrs.style,\n        id = $attrs.id;\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, \"\".concat(prefixCls, \"-disabled\"), disabled), _defineProperty(_classNames, className, className), _classNames));\n    var events = disabled ? {} : {\n      onClick: openFileDialogOnClick ? this.onClick : function () {},\n      onKeydown: openFileDialogOnClick ? this.onKeyDown : function () {},\n      onDrop: this.onFileDrop,\n      onDragover: this.onFileDrop\n    };\n\n    var tagProps = _extends(_extends({}, events), {\n      role: 'button',\n      tabindex: disabled ? null : '0',\n      class: cls,\n      style: style\n    });\n\n    return _createVNode(Tag, tagProps, {\n      default: function _default() {\n        return [_createVNode(\"input\", {\n          \"id\": id,\n          \"type\": \"file\",\n          \"ref\": \"fileInputRef\",\n          \"onClick\": function onClick(e) {\n            return e.stopPropagation();\n          },\n          \"key\": _this5.uid,\n          \"style\": {\n            display: 'none'\n          },\n          \"accept\": accept,\n          \"directory\": directory ? 'directory' : null,\n          \"webkitdirectory\": directory ? 'webkitdirectory' : null,\n          \"multiple\": multiple,\n          \"onChange\": _this5.onChange\n        }, null), getSlot(_this5)];\n      }\n    });\n  }\n};\nexport default AjaxUploader;"]},"metadata":{},"sourceType":"module"}