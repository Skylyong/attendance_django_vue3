{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode } from \"vue\";\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport classNames from '../../_util/classNames';\nimport getUid from './uid';\nimport warning from '../../_util/warning';\nimport { getSlot, findDOMNode } from '../../_util/props-util';\nvar IFRAME_STYLE = {\n  position: 'absolute',\n  top: 0,\n  opacity: 0,\n  filter: 'alpha(opacity=0)',\n  left: 0,\n  zIndex: 9999\n}; // diferent from AjaxUpload, can only upload on at one time, serial seriously\n\nvar IframeUploader = {\n  name: 'IframeUploader',\n  mixins: [BaseMixin],\n  props: {\n    componentTag: PropTypes.string,\n    // style: PropTypes.object,\n    disabled: PropTypes.looseBool,\n    prefixCls: PropTypes.string,\n    // className: PropTypes.string,\n    accept: PropTypes.string,\n    // onStart: PropTypes.func,\n    multiple: PropTypes.looseBool,\n    // children: PropTypes.any,\n    data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n    action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    name: PropTypes.string\n  },\n  data: function data() {\n    this.file = {};\n    return {\n      uploading: false\n    };\n  },\n  methods: {\n    onLoad: function onLoad() {\n      if (!this.uploading) {\n        return;\n      }\n\n      var file = this.file;\n      var response;\n\n      try {\n        var doc = this.getIframeDocument();\n        var script = doc.getElementsByTagName('script')[0];\n\n        if (script && script.parentNode === doc.body) {\n          doc.body.removeChild(script);\n        }\n\n        response = doc.body.innerHTML;\n\n        this.__emit('success', response, file);\n      } catch (err) {\n        warning(false, 'cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload');\n        response = 'cross-domain';\n\n        this.__emit('error', err, null, file);\n      }\n\n      this.endUpload();\n    },\n    onChange: function onChange() {\n      var _this = this;\n\n      var target = this.getFormInputNode(); // ie8/9 don't support FileList Object\n      // http://stackoverflow.com/questions/12830058/ie8-input-type-file-get-files\n\n      var file = this.file = {\n        uid: getUid(),\n        name: target.value && target.value.substring(target.value.lastIndexOf('\\\\') + 1, target.value.length)\n      };\n      this.startUpload();\n      var props = this.$props;\n\n      if (!props.beforeUpload) {\n        return this.post(file);\n      }\n\n      var before = props.beforeUpload(file);\n\n      if (before && before.then) {\n        before.then(function () {\n          _this.post(file);\n        }, function () {\n          _this.endUpload();\n        });\n      } else if (before !== false) {\n        this.post(file);\n      } else {\n        this.endUpload();\n      }\n    },\n    getIframeNode: function getIframeNode() {\n      return this.$refs.iframeRef;\n    },\n    getIframeDocument: function getIframeDocument() {\n      return this.getIframeNode().contentDocument;\n    },\n    getFormNode: function getFormNode() {\n      return this.getIframeDocument().getElementById('form');\n    },\n    getFormInputNode: function getFormInputNode() {\n      return this.getIframeDocument().getElementById('input');\n    },\n    getFormDataNode: function getFormDataNode() {\n      return this.getIframeDocument().getElementById('data');\n    },\n    getFileForMultiple: function getFileForMultiple(file) {\n      return this.multiple ? [file] : file;\n    },\n    getIframeHTML: function getIframeHTML(domain) {\n      var domainScript = '';\n      var domainInput = '';\n\n      if (domain) {\n        var script = 'script';\n        domainScript = \"<\".concat(script, \">document.domain=\\\"\").concat(domain, \"\\\";</\").concat(script, \">\");\n        domainInput = \"<input name=\\\"_documentDomain\\\" value=\\\"\".concat(domain, \"\\\" />\");\n      }\n\n      return \"\\n      <!DOCTYPE html>\\n      <html>\\n      <head>\\n      <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge\\\" />\\n      <style>\\n      body,html {padding:0;margin:0;border:0;overflow:hidden;}\\n      </style>\\n      \".concat(domainScript, \"\\n      </head>\\n      <body>\\n      <form method=\\\"post\\\"\\n      encType=\\\"multipart/form-data\\\"\\n      action=\\\"\\\" id=\\\"form\\\"\\n      style=\\\"display:block;height:9999px;position:relative;overflow:hidden;\\\">\\n      <input id=\\\"input\\\" type=\\\"file\\\"\\n       name=\\\"\").concat(this.name, \"\\\"\\n       style=\\\"position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;\\\"/>\\n      \").concat(domainInput, \"\\n      <span id=\\\"data\\\"></span>\\n      </form>\\n      </body>\\n      </html>\\n      \");\n    },\n    initIframeSrc: function initIframeSrc() {\n      if (this.domain) {\n        this.getIframeNode().src = \"javascript:void((function(){\\n          var d = document;\\n          d.open();\\n          d.domain='\".concat(this.domain, \"';\\n          d.write('');\\n          d.close();\\n        })())\");\n      }\n    },\n    initIframe: function initIframe() {\n      var iframeNode = this.getIframeNode();\n      var win = iframeNode.contentWindow;\n      var doc;\n      this.domain = this.domain || '';\n      this.initIframeSrc();\n\n      try {\n        doc = win.document;\n      } catch (e) {\n        this.domain = document.domain;\n        this.initIframeSrc();\n        win = iframeNode.contentWindow;\n        doc = win.document;\n      }\n\n      doc.open('text/html', 'replace');\n      doc.write(this.getIframeHTML(this.domain));\n      doc.close();\n      this.getFormInputNode().onchange = this.onChange;\n    },\n    endUpload: function endUpload() {\n      if (this.uploading) {\n        this.file = {}; // hack avoid batch\n\n        this.uploading = false;\n        this.setState({\n          uploading: false\n        });\n        this.initIframe();\n      }\n    },\n    startUpload: function startUpload() {\n      if (!this.uploading) {\n        this.uploading = true;\n        this.setState({\n          uploading: true\n        });\n      }\n    },\n    updateIframeWH: function updateIframeWH() {\n      var rootNode = findDOMNode(this);\n      var iframeNode = this.getIframeNode();\n      iframeNode.style.height = \"\".concat(rootNode.offsetHeight, \"px\");\n      iframeNode.style.width = \"\".concat(rootNode.offsetWidth, \"px\");\n    },\n    abort: function abort(file) {\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (uid === this.file.uid) {\n          this.endUpload();\n        }\n      } else {\n        this.endUpload();\n      }\n    },\n    post: function post(file) {\n      var _this2 = this;\n\n      var formNode = this.getFormNode();\n      var dataSpan = this.getFormDataNode();\n      var data = this.$props.data;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      var inputs = document.createDocumentFragment();\n\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          var input = document.createElement('input');\n          input.setAttribute('name', key);\n          input.value = data[key];\n          inputs.appendChild(input);\n        }\n      }\n\n      dataSpan.appendChild(inputs);\n      new Promise(function (resolve) {\n        var action = _this2.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        formNode.setAttribute('action', action);\n        formNode.submit();\n        dataSpan.innerHTML = '';\n\n        _this2.__emit('start', file);\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.$nextTick(function () {\n      _this3.updateIframeWH();\n\n      _this3.initIframe();\n    });\n  },\n  updated: function updated() {\n    var _this4 = this;\n\n    this.$nextTick(function () {\n      _this4.updateIframeWH();\n    });\n  },\n  render: function render() {\n    var _classNames,\n        _this5 = this;\n\n    var _this$$props = this.$props,\n        Tag = _this$$props.componentTag,\n        disabled = _this$$props.disabled,\n        prefixCls = _this$$props.prefixCls;\n    var _this$$attrs = this.$attrs,\n        className = _this$$attrs.class,\n        style = _this$$attrs.style;\n\n    var iframeStyle = _extends(_extends({}, IFRAME_STYLE), {\n      display: this.uploading || disabled ? 'none' : ''\n    });\n\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, \"\".concat(prefixCls, \"-disabled\"), disabled), _defineProperty(_classNames, className, className), _classNames));\n    return _createVNode(Tag, {\n      \"class\": cls,\n      \"style\": _extends({\n        position: 'relative',\n        zIndex: 0\n      }, style)\n    }, {\n      default: function _default() {\n        return [_createVNode(\"iframe\", {\n          \"ref\": \"iframeRef\",\n          \"onLoad\": _this5.onLoad,\n          \"style\": iframeStyle\n        }, null), getSlot(_this5)];\n      }\n    });\n  }\n};\nexport default IframeUploader;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/node_modules/ant-design-vue/es/vc-upload/src/IframeUploader.js"],"names":["_defineProperty","_extends","createVNode","_createVNode","PropTypes","BaseMixin","classNames","getUid","warning","getSlot","findDOMNode","IFRAME_STYLE","position","top","opacity","filter","left","zIndex","IframeUploader","name","mixins","props","componentTag","string","disabled","looseBool","prefixCls","accept","multiple","data","oneOfType","object","func","action","file","uploading","methods","onLoad","response","doc","getIframeDocument","script","getElementsByTagName","parentNode","body","removeChild","innerHTML","__emit","err","endUpload","onChange","_this","target","getFormInputNode","uid","value","substring","lastIndexOf","length","startUpload","$props","beforeUpload","post","before","then","getIframeNode","$refs","iframeRef","contentDocument","getFormNode","getElementById","getFormDataNode","getFileForMultiple","getIframeHTML","domain","domainScript","domainInput","concat","initIframeSrc","src","initIframe","iframeNode","win","contentWindow","document","e","open","write","close","onchange","setState","updateIframeWH","rootNode","style","height","offsetHeight","width","offsetWidth","abort","_this2","formNode","dataSpan","inputs","createDocumentFragment","key","hasOwnProperty","input","createElement","setAttribute","appendChild","Promise","resolve","submit","mounted","_this3","$nextTick","updated","_this4","render","_classNames","_this5","_this$$props","Tag","_this$$attrs","$attrs","className","class","iframeStyle","display","cls","default","_default"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode } from \"vue\";\nimport PropTypes from '../../_util/vue-types';\nimport BaseMixin from '../../_util/BaseMixin';\nimport classNames from '../../_util/classNames';\nimport getUid from './uid';\nimport warning from '../../_util/warning';\nimport { getSlot, findDOMNode } from '../../_util/props-util';\nvar IFRAME_STYLE = {\n  position: 'absolute',\n  top: 0,\n  opacity: 0,\n  filter: 'alpha(opacity=0)',\n  left: 0,\n  zIndex: 9999\n}; // diferent from AjaxUpload, can only upload on at one time, serial seriously\n\nvar IframeUploader = {\n  name: 'IframeUploader',\n  mixins: [BaseMixin],\n  props: {\n    componentTag: PropTypes.string,\n    // style: PropTypes.object,\n    disabled: PropTypes.looseBool,\n    prefixCls: PropTypes.string,\n    // className: PropTypes.string,\n    accept: PropTypes.string,\n    // onStart: PropTypes.func,\n    multiple: PropTypes.looseBool,\n    // children: PropTypes.any,\n    data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n    action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    name: PropTypes.string\n  },\n  data: function data() {\n    this.file = {};\n    return {\n      uploading: false\n    };\n  },\n  methods: {\n    onLoad: function onLoad() {\n      if (!this.uploading) {\n        return;\n      }\n\n      var file = this.file;\n      var response;\n\n      try {\n        var doc = this.getIframeDocument();\n        var script = doc.getElementsByTagName('script')[0];\n\n        if (script && script.parentNode === doc.body) {\n          doc.body.removeChild(script);\n        }\n\n        response = doc.body.innerHTML;\n\n        this.__emit('success', response, file);\n      } catch (err) {\n        warning(false, 'cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload');\n        response = 'cross-domain';\n\n        this.__emit('error', err, null, file);\n      }\n\n      this.endUpload();\n    },\n    onChange: function onChange() {\n      var _this = this;\n\n      var target = this.getFormInputNode(); // ie8/9 don't support FileList Object\n      // http://stackoverflow.com/questions/12830058/ie8-input-type-file-get-files\n\n      var file = this.file = {\n        uid: getUid(),\n        name: target.value && target.value.substring(target.value.lastIndexOf('\\\\') + 1, target.value.length)\n      };\n      this.startUpload();\n      var props = this.$props;\n\n      if (!props.beforeUpload) {\n        return this.post(file);\n      }\n\n      var before = props.beforeUpload(file);\n\n      if (before && before.then) {\n        before.then(function () {\n          _this.post(file);\n        }, function () {\n          _this.endUpload();\n        });\n      } else if (before !== false) {\n        this.post(file);\n      } else {\n        this.endUpload();\n      }\n    },\n    getIframeNode: function getIframeNode() {\n      return this.$refs.iframeRef;\n    },\n    getIframeDocument: function getIframeDocument() {\n      return this.getIframeNode().contentDocument;\n    },\n    getFormNode: function getFormNode() {\n      return this.getIframeDocument().getElementById('form');\n    },\n    getFormInputNode: function getFormInputNode() {\n      return this.getIframeDocument().getElementById('input');\n    },\n    getFormDataNode: function getFormDataNode() {\n      return this.getIframeDocument().getElementById('data');\n    },\n    getFileForMultiple: function getFileForMultiple(file) {\n      return this.multiple ? [file] : file;\n    },\n    getIframeHTML: function getIframeHTML(domain) {\n      var domainScript = '';\n      var domainInput = '';\n\n      if (domain) {\n        var script = 'script';\n        domainScript = \"<\".concat(script, \">document.domain=\\\"\").concat(domain, \"\\\";</\").concat(script, \">\");\n        domainInput = \"<input name=\\\"_documentDomain\\\" value=\\\"\".concat(domain, \"\\\" />\");\n      }\n\n      return \"\\n      <!DOCTYPE html>\\n      <html>\\n      <head>\\n      <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge\\\" />\\n      <style>\\n      body,html {padding:0;margin:0;border:0;overflow:hidden;}\\n      </style>\\n      \".concat(domainScript, \"\\n      </head>\\n      <body>\\n      <form method=\\\"post\\\"\\n      encType=\\\"multipart/form-data\\\"\\n      action=\\\"\\\" id=\\\"form\\\"\\n      style=\\\"display:block;height:9999px;position:relative;overflow:hidden;\\\">\\n      <input id=\\\"input\\\" type=\\\"file\\\"\\n       name=\\\"\").concat(this.name, \"\\\"\\n       style=\\\"position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;\\\"/>\\n      \").concat(domainInput, \"\\n      <span id=\\\"data\\\"></span>\\n      </form>\\n      </body>\\n      </html>\\n      \");\n    },\n    initIframeSrc: function initIframeSrc() {\n      if (this.domain) {\n        this.getIframeNode().src = \"javascript:void((function(){\\n          var d = document;\\n          d.open();\\n          d.domain='\".concat(this.domain, \"';\\n          d.write('');\\n          d.close();\\n        })())\");\n      }\n    },\n    initIframe: function initIframe() {\n      var iframeNode = this.getIframeNode();\n      var win = iframeNode.contentWindow;\n      var doc;\n      this.domain = this.domain || '';\n      this.initIframeSrc();\n\n      try {\n        doc = win.document;\n      } catch (e) {\n        this.domain = document.domain;\n        this.initIframeSrc();\n        win = iframeNode.contentWindow;\n        doc = win.document;\n      }\n\n      doc.open('text/html', 'replace');\n      doc.write(this.getIframeHTML(this.domain));\n      doc.close();\n      this.getFormInputNode().onchange = this.onChange;\n    },\n    endUpload: function endUpload() {\n      if (this.uploading) {\n        this.file = {}; // hack avoid batch\n\n        this.uploading = false;\n        this.setState({\n          uploading: false\n        });\n        this.initIframe();\n      }\n    },\n    startUpload: function startUpload() {\n      if (!this.uploading) {\n        this.uploading = true;\n        this.setState({\n          uploading: true\n        });\n      }\n    },\n    updateIframeWH: function updateIframeWH() {\n      var rootNode = findDOMNode(this);\n      var iframeNode = this.getIframeNode();\n      iframeNode.style.height = \"\".concat(rootNode.offsetHeight, \"px\");\n      iframeNode.style.width = \"\".concat(rootNode.offsetWidth, \"px\");\n    },\n    abort: function abort(file) {\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (uid === this.file.uid) {\n          this.endUpload();\n        }\n      } else {\n        this.endUpload();\n      }\n    },\n    post: function post(file) {\n      var _this2 = this;\n\n      var formNode = this.getFormNode();\n      var dataSpan = this.getFormDataNode();\n      var data = this.$props.data;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      var inputs = document.createDocumentFragment();\n\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          var input = document.createElement('input');\n          input.setAttribute('name', key);\n          input.value = data[key];\n          inputs.appendChild(input);\n        }\n      }\n\n      dataSpan.appendChild(inputs);\n      new Promise(function (resolve) {\n        var action = _this2.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        formNode.setAttribute('action', action);\n        formNode.submit();\n        dataSpan.innerHTML = '';\n\n        _this2.__emit('start', file);\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.$nextTick(function () {\n      _this3.updateIframeWH();\n\n      _this3.initIframe();\n    });\n  },\n  updated: function updated() {\n    var _this4 = this;\n\n    this.$nextTick(function () {\n      _this4.updateIframeWH();\n    });\n  },\n  render: function render() {\n    var _classNames,\n        _this5 = this;\n\n    var _this$$props = this.$props,\n        Tag = _this$$props.componentTag,\n        disabled = _this$$props.disabled,\n        prefixCls = _this$$props.prefixCls;\n    var _this$$attrs = this.$attrs,\n        className = _this$$attrs.class,\n        style = _this$$attrs.style;\n\n    var iframeStyle = _extends(_extends({}, IFRAME_STYLE), {\n      display: this.uploading || disabled ? 'none' : ''\n    });\n\n    var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, \"\".concat(prefixCls, \"-disabled\"), disabled), _defineProperty(_classNames, className, className), _classNames));\n    return _createVNode(Tag, {\n      \"class\": cls,\n      \"style\": _extends({\n        position: 'relative',\n        zIndex: 0\n      }, style)\n    }, {\n      default: function _default() {\n        return [_createVNode(\"iframe\", {\n          \"ref\": \"iframeRef\",\n          \"onLoad\": _this5.onLoad,\n          \"style\": iframeStyle\n        }, null), getSlot(_this5)];\n      }\n    });\n  }\n};\nexport default IframeUploader;"]},"metadata":{},"sourceType":"module"}