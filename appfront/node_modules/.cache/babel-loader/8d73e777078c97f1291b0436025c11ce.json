{"ast":null,"code":"import { reactive } from 'vue';\nexport default function useHeights(getKey, onItemAdd, onItemRemove) {\n  var instance = new Map();\n  var heights = reactive({});\n  var heightUpdateId = 0;\n\n  function collectHeight() {\n    heightUpdateId += 1;\n    var currentId = heightUpdateId;\n    Promise.resolve().then(function () {\n      // Only collect when it's latest call\n      if (currentId !== heightUpdateId) return; // let changed = false;\n\n      instance.forEach(function (element, key) {\n        if (element && element.offsetParent) {\n          var offsetHeight = element.offsetHeight;\n\n          if (heights[key] !== offsetHeight) {\n            //changed = true;\n            heights[key] = element.offsetHeight;\n          }\n        }\n      });\n    });\n  }\n\n  function setInstance(item, ins) {\n    var key = getKey(item);\n    var origin = instance.get(key);\n\n    if (ins) {\n      instance.set(key, ins);\n      collectHeight();\n    } else {\n      instance.delete(key);\n    } // Instance changed\n\n\n    if (!origin !== !ins) {\n      if (ins) {\n        onItemAdd === null || onItemAdd === void 0 ? void 0 : onItemAdd(item);\n      } else {\n        onItemRemove === null || onItemRemove === void 0 ? void 0 : onItemRemove(item);\n      }\n    }\n  }\n\n  return [setInstance, collectHeight, heights];\n}","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/node_modules/ant-design-vue/es/vc-virtual-list/hooks/useHeights.js"],"names":["reactive","useHeights","getKey","onItemAdd","onItemRemove","instance","Map","heights","heightUpdateId","collectHeight","currentId","Promise","resolve","then","forEach","element","key","offsetParent","offsetHeight","setInstance","item","ins","origin","get","set","delete"],"mappings":"AAAA,SAASA,QAAT,QAAyB,KAAzB;AACA,eAAe,SAASC,UAAT,CAAoBC,MAApB,EAA4BC,SAA5B,EAAuCC,YAAvC,EAAqD;AAClE,MAAIC,QAAQ,GAAG,IAAIC,GAAJ,EAAf;AACA,MAAIC,OAAO,GAAGP,QAAQ,CAAC,EAAD,CAAtB;AACA,MAAIQ,cAAc,GAAG,CAArB;;AAEA,WAASC,aAAT,GAAyB;AACvBD,IAAAA,cAAc,IAAI,CAAlB;AACA,QAAIE,SAAS,GAAGF,cAAhB;AACAG,IAAAA,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuB,YAAY;AACjC;AACA,UAAIH,SAAS,KAAKF,cAAlB,EAAkC,OAFD,CAES;;AAE1CH,MAAAA,QAAQ,CAACS,OAAT,CAAiB,UAAUC,OAAV,EAAmBC,GAAnB,EAAwB;AACvC,YAAID,OAAO,IAAIA,OAAO,CAACE,YAAvB,EAAqC;AACnC,cAAIC,YAAY,GAAGH,OAAO,CAACG,YAA3B;;AAEA,cAAIX,OAAO,CAACS,GAAD,CAAP,KAAiBE,YAArB,EAAmC;AACjC;AACAX,YAAAA,OAAO,CAACS,GAAD,CAAP,GAAeD,OAAO,CAACG,YAAvB;AACD;AACF;AACF,OATD;AAUD,KAdD;AAeD;;AAED,WAASC,WAAT,CAAqBC,IAArB,EAA2BC,GAA3B,EAAgC;AAC9B,QAAIL,GAAG,GAAGd,MAAM,CAACkB,IAAD,CAAhB;AACA,QAAIE,MAAM,GAAGjB,QAAQ,CAACkB,GAAT,CAAaP,GAAb,CAAb;;AAEA,QAAIK,GAAJ,EAAS;AACPhB,MAAAA,QAAQ,CAACmB,GAAT,CAAaR,GAAb,EAAkBK,GAAlB;AACAZ,MAAAA,aAAa;AACd,KAHD,MAGO;AACLJ,MAAAA,QAAQ,CAACoB,MAAT,CAAgBT,GAAhB;AACD,KAT6B,CAS5B;;;AAGF,QAAI,CAACM,MAAD,KAAY,CAACD,GAAjB,EAAsB;AACpB,UAAIA,GAAJ,EAAS;AACPlB,QAAAA,SAAS,KAAK,IAAd,IAAsBA,SAAS,KAAK,KAAK,CAAzC,GAA6C,KAAK,CAAlD,GAAsDA,SAAS,CAACiB,IAAD,CAA/D;AACD,OAFD,MAEO;AACLhB,QAAAA,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAK,CAA/C,GAAmD,KAAK,CAAxD,GAA4DA,YAAY,CAACgB,IAAD,CAAxE;AACD;AACF;AACF;;AAED,SAAO,CAACD,WAAD,EAAcV,aAAd,EAA6BF,OAA7B,CAAP;AACD","sourcesContent":["import { reactive } from 'vue';\nexport default function useHeights(getKey, onItemAdd, onItemRemove) {\n  var instance = new Map();\n  var heights = reactive({});\n  var heightUpdateId = 0;\n\n  function collectHeight() {\n    heightUpdateId += 1;\n    var currentId = heightUpdateId;\n    Promise.resolve().then(function () {\n      // Only collect when it's latest call\n      if (currentId !== heightUpdateId) return; // let changed = false;\n\n      instance.forEach(function (element, key) {\n        if (element && element.offsetParent) {\n          var offsetHeight = element.offsetHeight;\n\n          if (heights[key] !== offsetHeight) {\n            //changed = true;\n            heights[key] = element.offsetHeight;\n          }\n        }\n      });\n    });\n  }\n\n  function setInstance(item, ins) {\n    var key = getKey(item);\n    var origin = instance.get(key);\n\n    if (ins) {\n      instance.set(key, ins);\n      collectHeight();\n    } else {\n      instance.delete(key);\n    } // Instance changed\n\n\n    if (!origin !== !ins) {\n      if (ins) {\n        onItemAdd === null || onItemAdd === void 0 ? void 0 : onItemAdd(item);\n      } else {\n        onItemRemove === null || onItemRemove === void 0 ? void 0 : onItemRemove(item);\n      }\n    }\n  }\n\n  return [setInstance, collectHeight, heights];\n}"]},"metadata":{},"sourceType":"module"}