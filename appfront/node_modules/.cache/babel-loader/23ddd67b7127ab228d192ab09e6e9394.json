{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { createCommentVNode, defineComponent, h, ref, inject, nextTick, watch, onMounted, onUnmounted } from 'vue';\nimport XEUtils from 'xe-utils';\nimport { convertToRows } from './util';\nimport { getColMinWidth } from '../../table/src/util';\nimport { hasClass, getOffsetPos, addClass, removeClass } from '../../tools/dom';\nvar renderType = 'header';\nexport default defineComponent({\n  name: 'VxeTableHeader',\n  props: {\n    tableData: Array,\n    tableColumn: Array,\n    tableGroupColumn: Array,\n    fixedColumn: Array,\n    fixedType: {\n      type: String,\n      default: null\n    }\n  },\n  setup: function (props) {\n    var $xetable = inject('$xetable', {});\n    var xID = $xetable.xID,\n        tableProps = $xetable.props,\n        tableReactData = $xetable.reactData,\n        tableInternalData = $xetable.internalData;\n\n    var _a = $xetable.getRefMaps(),\n        tableRefElem = _a.refElem,\n        refTableBody = _a.refTableBody,\n        refLeftContainer = _a.refLeftContainer,\n        refRightContainer = _a.refRightContainer,\n        refCellResizeBar = _a.refCellResizeBar;\n\n    var computeColumnOpts = $xetable.getComputeMaps().computeColumnOpts;\n    var headerColumn = ref([]);\n    var refElem = ref();\n    var refHeaderTable = ref();\n    var refHeaderColgroup = ref();\n    var refHeaderTHead = ref();\n    var refHeaderXSpace = ref();\n    var refHeaderBorderRepair = ref();\n\n    var uploadColumn = function () {\n      var isGroup = tableReactData.isGroup;\n      headerColumn.value = isGroup ? convertToRows(props.tableGroupColumn) : [];\n    };\n\n    var resizeMousedown = function (evnt, params) {\n      var column = params.column;\n      var fixedType = props.fixedType;\n      var tableBody = refTableBody.value;\n      var leftContainerElem = refLeftContainer.value;\n      var rightContainerElem = refRightContainer.value;\n      var resizeBarElem = refCellResizeBar.value;\n      var dragClientX = evnt.clientX;\n      var wrapperElem = refElem.value;\n      var dragBtnElem = evnt.target;\n      var cell = params.cell = dragBtnElem.parentNode;\n      var dragLeft = 0;\n      var tableBodyElem = tableBody.$el;\n      var pos = getOffsetPos(dragBtnElem, wrapperElem);\n      var dragBtnWidth = dragBtnElem.clientWidth;\n      var dragBtnOffsetWidth = Math.floor(dragBtnWidth / 2);\n      var minInterval = getColMinWidth(params) - dragBtnOffsetWidth; // 列之间的最小间距\n\n      var dragMinLeft = pos.left - cell.clientWidth + dragBtnWidth + minInterval;\n      var dragPosLeft = pos.left + dragBtnOffsetWidth;\n      var domMousemove = document.onmousemove;\n      var domMouseup = document.onmouseup;\n      var isLeftFixed = fixedType === 'left';\n      var isRightFixed = fixedType === 'right';\n      var tableEl = tableRefElem.value; // 计算左右侧固定列偏移量\n\n      var fixedOffsetWidth = 0;\n\n      if (isLeftFixed || isRightFixed) {\n        var siblingProp = isLeftFixed ? 'nextElementSibling' : 'previousElementSibling';\n        var tempCellElem = cell[siblingProp];\n\n        while (tempCellElem) {\n          if (hasClass(tempCellElem, 'fixed--hidden')) {\n            break;\n          } else if (!hasClass(tempCellElem, 'col--group')) {\n            fixedOffsetWidth += tempCellElem.offsetWidth;\n          }\n\n          tempCellElem = tempCellElem[siblingProp];\n        }\n\n        if (isRightFixed && rightContainerElem) {\n          dragPosLeft = rightContainerElem.offsetLeft + fixedOffsetWidth;\n        }\n      } // 处理拖动事件\n\n\n      var updateEvent = function (evnt) {\n        evnt.stopPropagation();\n        evnt.preventDefault();\n        var offsetX = evnt.clientX - dragClientX;\n        var left = dragPosLeft + offsetX;\n        var scrollLeft = fixedType ? 0 : tableBodyElem.scrollLeft;\n\n        if (isLeftFixed) {\n          // 左固定列（不允许超过右侧固定列、不允许超过右边距）\n          left = Math.min(left, (rightContainerElem ? rightContainerElem.offsetLeft : tableBodyElem.clientWidth) - fixedOffsetWidth - minInterval);\n        } else if (isRightFixed) {\n          // 右侧固定列（不允许超过左侧固定列、不允许超过左边距）\n          dragMinLeft = (leftContainerElem ? leftContainerElem.clientWidth : 0) + fixedOffsetWidth + minInterval;\n          left = Math.min(left, dragPosLeft + cell.clientWidth - minInterval);\n        } else {\n          dragMinLeft = Math.max(tableBodyElem.scrollLeft, dragMinLeft); // left = Math.min(left, tableBodyElem.clientWidth + tableBodyElem.scrollLeft - 40)\n        }\n\n        dragLeft = Math.max(left, dragMinLeft);\n        resizeBarElem.style.left = dragLeft - scrollLeft + \"px\";\n      };\n\n      tableInternalData._isResize = true;\n      addClass(tableEl, 'drag--resize');\n      resizeBarElem.style.display = 'block';\n      document.onmousemove = updateEvent;\n\n      document.onmouseup = function (evnt) {\n        document.onmousemove = domMousemove;\n        document.onmouseup = domMouseup;\n        column.resizeWidth = column.renderWidth + (isRightFixed ? dragPosLeft - dragLeft : dragLeft - dragPosLeft);\n        resizeBarElem.style.display = 'none';\n        tableInternalData._isResize = false;\n        tableInternalData._lastResizeTime = Date.now();\n        $xetable.analyColumnWidth();\n        $xetable.recalculate(true).then(function () {\n          $xetable.saveCustomResizable();\n          $xetable.updateCellAreas();\n          $xetable.dispatchEvent('resizable-change', params, evnt);\n        });\n        removeClass(tableEl, 'drag--resize');\n      };\n\n      updateEvent(evnt);\n\n      if ($xetable.closeMenu) {\n        $xetable.closeMenu();\n      }\n    };\n\n    watch(function () {\n      return props.tableColumn;\n    }, uploadColumn);\n    onMounted(function () {\n      nextTick(function () {\n        var fixedType = props.fixedType;\n        var internalData = $xetable.internalData;\n        var elemStore = internalData.elemStore;\n        var prefix = (fixedType || 'main') + \"-header-\";\n        elemStore[prefix + \"wrapper\"] = refElem.value;\n        elemStore[prefix + \"table\"] = refHeaderTable.value;\n        elemStore[prefix + \"colgroup\"] = refHeaderColgroup.value;\n        elemStore[prefix + \"list\"] = refHeaderTHead.value;\n        elemStore[prefix + \"xSpace\"] = refHeaderXSpace.value;\n        elemStore[prefix + \"repair\"] = refHeaderBorderRepair.value;\n        uploadColumn();\n      });\n    });\n    onUnmounted(function () {\n      var fixedType = props.fixedType;\n      var internalData = $xetable.internalData;\n      var elemStore = internalData.elemStore;\n      var prefix = (fixedType || 'main') + \"-header-\";\n      elemStore[prefix + \"wrapper\"] = null;\n      elemStore[prefix + \"table\"] = null;\n      elemStore[prefix + \"colgroup\"] = null;\n      elemStore[prefix + \"list\"] = null;\n      elemStore[prefix + \"xSpace\"] = null;\n      elemStore[prefix + \"repair\"] = null;\n    });\n\n    var renderVN = function () {\n      var fixedType = props.fixedType,\n          fixedColumn = props.fixedColumn,\n          tableColumn = props.tableColumn;\n      var resizable = tableProps.resizable,\n          border = tableProps.border,\n          columnKey = tableProps.columnKey,\n          headerRowClassName = tableProps.headerRowClassName,\n          headerCellClassName = tableProps.headerCellClassName,\n          headerRowStyle = tableProps.headerRowStyle,\n          headerCellStyle = tableProps.headerCellStyle,\n          allColumnHeaderOverflow = tableProps.showHeaderOverflow,\n          allHeaderAlign = tableProps.headerAlign,\n          allAlign = tableProps.align,\n          mouseConfig = tableProps.mouseConfig;\n      var isGroup = tableReactData.isGroup,\n          currentColumn = tableReactData.currentColumn,\n          scrollXLoad = tableReactData.scrollXLoad,\n          overflowX = tableReactData.overflowX,\n          scrollbarWidth = tableReactData.scrollbarWidth;\n      var columnOpts = computeColumnOpts.value;\n      var headerGroups = headerColumn.value; // 如果是使用优化模式\n\n      if (!isGroup) {\n        if (fixedType) {\n          if (scrollXLoad || allColumnHeaderOverflow) {\n            tableColumn = fixedColumn;\n          }\n        }\n\n        headerGroups = [tableColumn];\n      }\n\n      return h('div', {\n        ref: refElem,\n        class: ['vxe-table--header-wrapper', fixedType ? \"fixed-\" + fixedType + \"--wrapper\" : 'body--wrapper'],\n        xid: xID\n      }, [fixedType ? createCommentVNode() : h('div', {\n        ref: refHeaderXSpace,\n        class: 'vxe-body--x-space'\n      }), h('table', {\n        ref: refHeaderTable,\n        class: 'vxe-table--header',\n        xid: xID,\n        cellspacing: 0,\n        cellpadding: 0,\n        border: 0\n      }, [\n      /**\n       * 列宽\n       */\n      h('colgroup', {\n        ref: refHeaderColgroup\n      }, tableColumn.map(function (column, $columnIndex) {\n        return h('col', {\n          name: column.id,\n          key: $columnIndex\n        });\n      }).concat(scrollbarWidth ? [h('col', {\n        name: 'col_gutter'\n      })] : [])),\n      /**\n       * 头部\n       */\n      h('thead', {\n        ref: refHeaderTHead\n      }, headerGroups.map(function (cols, $rowIndex) {\n        return h('tr', {\n          class: ['vxe-header--row', headerRowClassName ? XEUtils.isFunction(headerRowClassName) ? headerRowClassName({\n            $table: $xetable,\n            $rowIndex: $rowIndex,\n            fixed: fixedType,\n            type: renderType\n          }) : headerRowClassName : ''],\n          style: headerRowStyle ? XEUtils.isFunction(headerRowStyle) ? headerRowStyle({\n            $table: $xetable,\n            $rowIndex: $rowIndex,\n            fixed: fixedType,\n            type: renderType\n          }) : headerRowStyle : null\n        }, cols.map(function (column, $columnIndex) {\n          var _a;\n\n          var type = column.type,\n              showHeaderOverflow = column.showHeaderOverflow,\n              headerAlign = column.headerAlign,\n              align = column.align,\n              headerClassName = column.headerClassName;\n          var isColGroup = column.children && column.children.length;\n          var fixedHiddenColumn = fixedType ? column.fixed !== fixedType && !isColGroup : !!column.fixed && overflowX;\n          var headOverflow = XEUtils.isUndefined(showHeaderOverflow) || XEUtils.isNull(showHeaderOverflow) ? allColumnHeaderOverflow : showHeaderOverflow;\n          var headAlign = headerAlign || align || allHeaderAlign || allAlign;\n          var showEllipsis = headOverflow === 'ellipsis';\n          var showTitle = headOverflow === 'title';\n          var showTooltip = headOverflow === true || headOverflow === 'tooltip';\n          var hasEllipsis = showTitle || showTooltip || showEllipsis;\n          var hasFilter = column.filters && column.filters.some(function (item) {\n            return item.checked;\n          });\n          var columnIndex = $xetable.getColumnIndex(column);\n\n          var _columnIndex = $xetable.getVTColumnIndex(column);\n\n          var params = {\n            $table: $xetable,\n            $rowIndex: $rowIndex,\n            column: column,\n            columnIndex: columnIndex,\n            $columnIndex: $columnIndex,\n            _columnIndex: _columnIndex,\n            fixed: fixedType,\n            type: renderType,\n            isHidden: fixedHiddenColumn,\n            hasFilter: hasFilter\n          };\n          var thOns = {\n            onClick: function (evnt) {\n              return $xetable.triggerHeaderCellClickEvent(evnt, params);\n            },\n            onDblclick: function (evnt) {\n              return $xetable.triggerHeaderCellDblclickEvent(evnt, params);\n            }\n          }; // 横向虚拟滚动不支持动态行高\n\n          if (scrollXLoad && !hasEllipsis) {\n            showEllipsis = hasEllipsis = true;\n          } // 按下事件处理\n\n\n          if (mouseConfig) {\n            thOns.onMousedown = function (evnt) {\n              return $xetable.triggerHeaderCellMousedownEvent(evnt, params);\n            };\n          }\n\n          return h('th', __assign(__assign({\n            class: ['vxe-header--column', column.id, (_a = {}, _a[\"col--\" + headAlign] = headAlign, _a[\"col--\" + type] = type, _a['col--last'] = $columnIndex === cols.length - 1, _a['col--fixed'] = column.fixed, _a['col--group'] = isColGroup, _a['col--ellipsis'] = hasEllipsis, _a['fixed--hidden'] = fixedHiddenColumn, _a['is--sortable'] = column.sortable, _a['col--filter'] = !!column.filters, _a['is--filter-active'] = hasFilter, _a['col--current'] = currentColumn === column, _a), headerClassName ? XEUtils.isFunction(headerClassName) ? headerClassName(params) : headerClassName : '', headerCellClassName ? XEUtils.isFunction(headerCellClassName) ? headerCellClassName(params) : headerCellClassName : ''],\n            colid: column.id,\n            colspan: column.colSpan > 1 ? column.colSpan : null,\n            rowspan: column.rowSpan > 1 ? column.rowSpan : null,\n            style: headerCellStyle ? XEUtils.isFunction(headerCellStyle) ? headerCellStyle(params) : headerCellStyle : null\n          }, thOns), {\n            key: columnKey || columnOpts.useKey || isColGroup ? column.id : $columnIndex\n          }), [h('div', {\n            class: ['vxe-cell', {\n              'c--title': showTitle,\n              'c--tooltip': showTooltip,\n              'c--ellipsis': showEllipsis\n            }]\n          }, column.renderHeader(params)),\n          /**\n           * 列宽拖动\n           */\n          !fixedHiddenColumn && !isColGroup && (XEUtils.isBoolean(column.resizable) ? column.resizable : columnOpts.resizable || resizable) ? h('div', {\n            class: ['vxe-resizable', {\n              'is--line': !border || border === 'none'\n            }],\n            onMousedown: function (evnt) {\n              return resizeMousedown(evnt, params);\n            }\n          }) : null]);\n        }).concat(scrollbarWidth ? [h('th', {\n          class: 'vxe-header--gutter col--gutter'\n        })] : []));\n      }))]),\n      /**\n       * 其他\n       */\n      h('div', {\n        ref: refHeaderBorderRepair,\n        class: 'vxe-table--header-border-line'\n      })]);\n    };\n\n    return renderVN;\n  }\n});","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/vxe-table/es/header/src/header.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","createCommentVNode","defineComponent","h","ref","inject","nextTick","watch","onMounted","onUnmounted","XEUtils","convertToRows","getColMinWidth","hasClass","getOffsetPos","addClass","removeClass","renderType","name","props","tableData","Array","tableColumn","tableGroupColumn","fixedColumn","fixedType","type","String","default","setup","$xetable","xID","tableProps","tableReactData","reactData","tableInternalData","internalData","_a","getRefMaps","tableRefElem","refElem","refTableBody","refLeftContainer","refRightContainer","refCellResizeBar","computeColumnOpts","getComputeMaps","headerColumn","refHeaderTable","refHeaderColgroup","refHeaderTHead","refHeaderXSpace","refHeaderBorderRepair","uploadColumn","isGroup","value","resizeMousedown","evnt","params","column","tableBody","leftContainerElem","rightContainerElem","resizeBarElem","dragClientX","clientX","wrapperElem","dragBtnElem","target","cell","parentNode","dragLeft","tableBodyElem","$el","pos","dragBtnWidth","clientWidth","dragBtnOffsetWidth","Math","floor","minInterval","dragMinLeft","left","dragPosLeft","domMousemove","document","onmousemove","domMouseup","onmouseup","isLeftFixed","isRightFixed","tableEl","fixedOffsetWidth","siblingProp","tempCellElem","offsetWidth","offsetLeft","updateEvent","stopPropagation","preventDefault","offsetX","scrollLeft","min","max","style","_isResize","display","resizeWidth","renderWidth","_lastResizeTime","Date","now","analyColumnWidth","recalculate","then","saveCustomResizable","updateCellAreas","dispatchEvent","closeMenu","elemStore","prefix","renderVN","resizable","border","columnKey","headerRowClassName","headerCellClassName","headerRowStyle","headerCellStyle","allColumnHeaderOverflow","showHeaderOverflow","allHeaderAlign","headerAlign","allAlign","align","mouseConfig","currentColumn","scrollXLoad","overflowX","scrollbarWidth","columnOpts","headerGroups","class","xid","cellspacing","cellpadding","map","$columnIndex","id","key","concat","cols","$rowIndex","isFunction","$table","fixed","headerClassName","isColGroup","children","fixedHiddenColumn","headOverflow","isUndefined","isNull","headAlign","showEllipsis","showTitle","showTooltip","hasEllipsis","hasFilter","filters","some","item","checked","columnIndex","getColumnIndex","_columnIndex","getVTColumnIndex","isHidden","thOns","onClick","triggerHeaderCellClickEvent","onDblclick","triggerHeaderCellDblclickEvent","onMousedown","triggerHeaderCellMousedownEvent","sortable","colid","colspan","colSpan","rowspan","rowSpan","useKey","renderHeader","isBoolean"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { createCommentVNode, defineComponent, h, ref, inject, nextTick, watch, onMounted, onUnmounted } from 'vue';\nimport XEUtils from 'xe-utils';\nimport { convertToRows } from './util';\nimport { getColMinWidth } from '../../table/src/util';\nimport { hasClass, getOffsetPos, addClass, removeClass } from '../../tools/dom';\nvar renderType = 'header';\nexport default defineComponent({\n    name: 'VxeTableHeader',\n    props: {\n        tableData: Array,\n        tableColumn: Array,\n        tableGroupColumn: Array,\n        fixedColumn: Array,\n        fixedType: { type: String, default: null }\n    },\n    setup: function (props) {\n        var $xetable = inject('$xetable', {});\n        var xID = $xetable.xID, tableProps = $xetable.props, tableReactData = $xetable.reactData, tableInternalData = $xetable.internalData;\n        var _a = $xetable.getRefMaps(), tableRefElem = _a.refElem, refTableBody = _a.refTableBody, refLeftContainer = _a.refLeftContainer, refRightContainer = _a.refRightContainer, refCellResizeBar = _a.refCellResizeBar;\n        var computeColumnOpts = $xetable.getComputeMaps().computeColumnOpts;\n        var headerColumn = ref([]);\n        var refElem = ref();\n        var refHeaderTable = ref();\n        var refHeaderColgroup = ref();\n        var refHeaderTHead = ref();\n        var refHeaderXSpace = ref();\n        var refHeaderBorderRepair = ref();\n        var uploadColumn = function () {\n            var isGroup = tableReactData.isGroup;\n            headerColumn.value = isGroup ? convertToRows(props.tableGroupColumn) : [];\n        };\n        var resizeMousedown = function (evnt, params) {\n            var column = params.column;\n            var fixedType = props.fixedType;\n            var tableBody = refTableBody.value;\n            var leftContainerElem = refLeftContainer.value;\n            var rightContainerElem = refRightContainer.value;\n            var resizeBarElem = refCellResizeBar.value;\n            var dragClientX = evnt.clientX;\n            var wrapperElem = refElem.value;\n            var dragBtnElem = evnt.target;\n            var cell = params.cell = dragBtnElem.parentNode;\n            var dragLeft = 0;\n            var tableBodyElem = tableBody.$el;\n            var pos = getOffsetPos(dragBtnElem, wrapperElem);\n            var dragBtnWidth = dragBtnElem.clientWidth;\n            var dragBtnOffsetWidth = Math.floor(dragBtnWidth / 2);\n            var minInterval = getColMinWidth(params) - dragBtnOffsetWidth; // 列之间的最小间距\n            var dragMinLeft = pos.left - cell.clientWidth + dragBtnWidth + minInterval;\n            var dragPosLeft = pos.left + dragBtnOffsetWidth;\n            var domMousemove = document.onmousemove;\n            var domMouseup = document.onmouseup;\n            var isLeftFixed = fixedType === 'left';\n            var isRightFixed = fixedType === 'right';\n            var tableEl = tableRefElem.value;\n            // 计算左右侧固定列偏移量\n            var fixedOffsetWidth = 0;\n            if (isLeftFixed || isRightFixed) {\n                var siblingProp = isLeftFixed ? 'nextElementSibling' : 'previousElementSibling';\n                var tempCellElem = cell[siblingProp];\n                while (tempCellElem) {\n                    if (hasClass(tempCellElem, 'fixed--hidden')) {\n                        break;\n                    }\n                    else if (!hasClass(tempCellElem, 'col--group')) {\n                        fixedOffsetWidth += tempCellElem.offsetWidth;\n                    }\n                    tempCellElem = tempCellElem[siblingProp];\n                }\n                if (isRightFixed && rightContainerElem) {\n                    dragPosLeft = rightContainerElem.offsetLeft + fixedOffsetWidth;\n                }\n            }\n            // 处理拖动事件\n            var updateEvent = function (evnt) {\n                evnt.stopPropagation();\n                evnt.preventDefault();\n                var offsetX = evnt.clientX - dragClientX;\n                var left = dragPosLeft + offsetX;\n                var scrollLeft = fixedType ? 0 : tableBodyElem.scrollLeft;\n                if (isLeftFixed) {\n                    // 左固定列（不允许超过右侧固定列、不允许超过右边距）\n                    left = Math.min(left, (rightContainerElem ? rightContainerElem.offsetLeft : tableBodyElem.clientWidth) - fixedOffsetWidth - minInterval);\n                }\n                else if (isRightFixed) {\n                    // 右侧固定列（不允许超过左侧固定列、不允许超过左边距）\n                    dragMinLeft = (leftContainerElem ? leftContainerElem.clientWidth : 0) + fixedOffsetWidth + minInterval;\n                    left = Math.min(left, dragPosLeft + cell.clientWidth - minInterval);\n                }\n                else {\n                    dragMinLeft = Math.max(tableBodyElem.scrollLeft, dragMinLeft);\n                    // left = Math.min(left, tableBodyElem.clientWidth + tableBodyElem.scrollLeft - 40)\n                }\n                dragLeft = Math.max(left, dragMinLeft);\n                resizeBarElem.style.left = dragLeft - scrollLeft + \"px\";\n            };\n            tableInternalData._isResize = true;\n            addClass(tableEl, 'drag--resize');\n            resizeBarElem.style.display = 'block';\n            document.onmousemove = updateEvent;\n            document.onmouseup = function (evnt) {\n                document.onmousemove = domMousemove;\n                document.onmouseup = domMouseup;\n                column.resizeWidth = column.renderWidth + (isRightFixed ? dragPosLeft - dragLeft : dragLeft - dragPosLeft);\n                resizeBarElem.style.display = 'none';\n                tableInternalData._isResize = false;\n                tableInternalData._lastResizeTime = Date.now();\n                $xetable.analyColumnWidth();\n                $xetable.recalculate(true).then(function () {\n                    $xetable.saveCustomResizable();\n                    $xetable.updateCellAreas();\n                    $xetable.dispatchEvent('resizable-change', params, evnt);\n                });\n                removeClass(tableEl, 'drag--resize');\n            };\n            updateEvent(evnt);\n            if ($xetable.closeMenu) {\n                $xetable.closeMenu();\n            }\n        };\n        watch(function () { return props.tableColumn; }, uploadColumn);\n        onMounted(function () {\n            nextTick(function () {\n                var fixedType = props.fixedType;\n                var internalData = $xetable.internalData;\n                var elemStore = internalData.elemStore;\n                var prefix = (fixedType || 'main') + \"-header-\";\n                elemStore[prefix + \"wrapper\"] = refElem.value;\n                elemStore[prefix + \"table\"] = refHeaderTable.value;\n                elemStore[prefix + \"colgroup\"] = refHeaderColgroup.value;\n                elemStore[prefix + \"list\"] = refHeaderTHead.value;\n                elemStore[prefix + \"xSpace\"] = refHeaderXSpace.value;\n                elemStore[prefix + \"repair\"] = refHeaderBorderRepair.value;\n                uploadColumn();\n            });\n        });\n        onUnmounted(function () {\n            var fixedType = props.fixedType;\n            var internalData = $xetable.internalData;\n            var elemStore = internalData.elemStore;\n            var prefix = (fixedType || 'main') + \"-header-\";\n            elemStore[prefix + \"wrapper\"] = null;\n            elemStore[prefix + \"table\"] = null;\n            elemStore[prefix + \"colgroup\"] = null;\n            elemStore[prefix + \"list\"] = null;\n            elemStore[prefix + \"xSpace\"] = null;\n            elemStore[prefix + \"repair\"] = null;\n        });\n        var renderVN = function () {\n            var fixedType = props.fixedType, fixedColumn = props.fixedColumn, tableColumn = props.tableColumn;\n            var resizable = tableProps.resizable, border = tableProps.border, columnKey = tableProps.columnKey, headerRowClassName = tableProps.headerRowClassName, headerCellClassName = tableProps.headerCellClassName, headerRowStyle = tableProps.headerRowStyle, headerCellStyle = tableProps.headerCellStyle, allColumnHeaderOverflow = tableProps.showHeaderOverflow, allHeaderAlign = tableProps.headerAlign, allAlign = tableProps.align, mouseConfig = tableProps.mouseConfig;\n            var isGroup = tableReactData.isGroup, currentColumn = tableReactData.currentColumn, scrollXLoad = tableReactData.scrollXLoad, overflowX = tableReactData.overflowX, scrollbarWidth = tableReactData.scrollbarWidth;\n            var columnOpts = computeColumnOpts.value;\n            var headerGroups = headerColumn.value;\n            // 如果是使用优化模式\n            if (!isGroup) {\n                if (fixedType) {\n                    if (scrollXLoad || allColumnHeaderOverflow) {\n                        tableColumn = fixedColumn;\n                    }\n                }\n                headerGroups = [tableColumn];\n            }\n            return h('div', {\n                ref: refElem,\n                class: ['vxe-table--header-wrapper', fixedType ? \"fixed-\" + fixedType + \"--wrapper\" : 'body--wrapper'],\n                xid: xID\n            }, [\n                fixedType ? createCommentVNode() : h('div', {\n                    ref: refHeaderXSpace,\n                    class: 'vxe-body--x-space'\n                }),\n                h('table', {\n                    ref: refHeaderTable,\n                    class: 'vxe-table--header',\n                    xid: xID,\n                    cellspacing: 0,\n                    cellpadding: 0,\n                    border: 0\n                }, [\n                    /**\n                     * 列宽\n                     */\n                    h('colgroup', {\n                        ref: refHeaderColgroup\n                    }, tableColumn.map(function (column, $columnIndex) {\n                        return h('col', {\n                            name: column.id,\n                            key: $columnIndex\n                        });\n                    }).concat(scrollbarWidth ? [\n                        h('col', {\n                            name: 'col_gutter'\n                        })\n                    ] : [])),\n                    /**\n                     * 头部\n                     */\n                    h('thead', {\n                        ref: refHeaderTHead\n                    }, headerGroups.map(function (cols, $rowIndex) {\n                        return h('tr', {\n                            class: ['vxe-header--row', headerRowClassName ? (XEUtils.isFunction(headerRowClassName) ? headerRowClassName({ $table: $xetable, $rowIndex: $rowIndex, fixed: fixedType, type: renderType }) : headerRowClassName) : ''],\n                            style: headerRowStyle ? (XEUtils.isFunction(headerRowStyle) ? headerRowStyle({ $table: $xetable, $rowIndex: $rowIndex, fixed: fixedType, type: renderType }) : headerRowStyle) : null\n                        }, cols.map(function (column, $columnIndex) {\n                            var _a;\n                            var type = column.type, showHeaderOverflow = column.showHeaderOverflow, headerAlign = column.headerAlign, align = column.align, headerClassName = column.headerClassName;\n                            var isColGroup = column.children && column.children.length;\n                            var fixedHiddenColumn = fixedType ? (column.fixed !== fixedType && !isColGroup) : !!column.fixed && overflowX;\n                            var headOverflow = XEUtils.isUndefined(showHeaderOverflow) || XEUtils.isNull(showHeaderOverflow) ? allColumnHeaderOverflow : showHeaderOverflow;\n                            var headAlign = headerAlign || align || allHeaderAlign || allAlign;\n                            var showEllipsis = headOverflow === 'ellipsis';\n                            var showTitle = headOverflow === 'title';\n                            var showTooltip = headOverflow === true || headOverflow === 'tooltip';\n                            var hasEllipsis = showTitle || showTooltip || showEllipsis;\n                            var hasFilter = column.filters && column.filters.some(function (item) { return item.checked; });\n                            var columnIndex = $xetable.getColumnIndex(column);\n                            var _columnIndex = $xetable.getVTColumnIndex(column);\n                            var params = { $table: $xetable, $rowIndex: $rowIndex, column: column, columnIndex: columnIndex, $columnIndex: $columnIndex, _columnIndex: _columnIndex, fixed: fixedType, type: renderType, isHidden: fixedHiddenColumn, hasFilter: hasFilter };\n                            var thOns = {\n                                onClick: function (evnt) { return $xetable.triggerHeaderCellClickEvent(evnt, params); },\n                                onDblclick: function (evnt) { return $xetable.triggerHeaderCellDblclickEvent(evnt, params); }\n                            };\n                            // 横向虚拟滚动不支持动态行高\n                            if (scrollXLoad && !hasEllipsis) {\n                                showEllipsis = hasEllipsis = true;\n                            }\n                            // 按下事件处理\n                            if (mouseConfig) {\n                                thOns.onMousedown = function (evnt) { return $xetable.triggerHeaderCellMousedownEvent(evnt, params); };\n                            }\n                            return h('th', __assign(__assign({ class: ['vxe-header--column', column.id, (_a = {},\n                                        _a[\"col--\" + headAlign] = headAlign,\n                                        _a[\"col--\" + type] = type,\n                                        _a['col--last'] = $columnIndex === cols.length - 1,\n                                        _a['col--fixed'] = column.fixed,\n                                        _a['col--group'] = isColGroup,\n                                        _a['col--ellipsis'] = hasEllipsis,\n                                        _a['fixed--hidden'] = fixedHiddenColumn,\n                                        _a['is--sortable'] = column.sortable,\n                                        _a['col--filter'] = !!column.filters,\n                                        _a['is--filter-active'] = hasFilter,\n                                        _a['col--current'] = currentColumn === column,\n                                        _a), headerClassName ? (XEUtils.isFunction(headerClassName) ? headerClassName(params) : headerClassName) : '',\n                                    headerCellClassName ? (XEUtils.isFunction(headerCellClassName) ? headerCellClassName(params) : headerCellClassName) : ''], colid: column.id, colspan: column.colSpan > 1 ? column.colSpan : null, rowspan: column.rowSpan > 1 ? column.rowSpan : null, style: headerCellStyle ? (XEUtils.isFunction(headerCellStyle) ? headerCellStyle(params) : headerCellStyle) : null }, thOns), { key: columnKey || columnOpts.useKey || isColGroup ? column.id : $columnIndex }), [\n                                h('div', {\n                                    class: ['vxe-cell', {\n                                            'c--title': showTitle,\n                                            'c--tooltip': showTooltip,\n                                            'c--ellipsis': showEllipsis\n                                        }]\n                                }, column.renderHeader(params)),\n                                /**\n                                 * 列宽拖动\n                                 */\n                                !fixedHiddenColumn && !isColGroup && (XEUtils.isBoolean(column.resizable) ? column.resizable : (columnOpts.resizable || resizable)) ? h('div', {\n                                    class: ['vxe-resizable', {\n                                            'is--line': !border || border === 'none'\n                                        }],\n                                    onMousedown: function (evnt) { return resizeMousedown(evnt, params); }\n                                }) : null\n                            ]);\n                        }).concat(scrollbarWidth ? [\n                            h('th', {\n                                class: 'vxe-header--gutter col--gutter'\n                            })\n                        ] : []));\n                    }))\n                ]),\n                /**\n                 * 其他\n                 */\n                h('div', {\n                    ref: refHeaderBorderRepair,\n                    class: 'vxe-table--header-border-line'\n                })\n            ]);\n        };\n        return renderVN;\n    }\n});\n"]},"metadata":{},"sourceType":"module"}