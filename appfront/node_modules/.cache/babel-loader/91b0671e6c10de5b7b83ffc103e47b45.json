{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { createVNode as _createVNode } from \"vue\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { ref, defineComponent, watchEffect, computed, nextTick, onBeforeUnmount, reactive, watch } from 'vue';\nimport Filler from './Filler';\nimport Item from './Item';\nimport ScrollBar from './ScrollBar';\nimport useHeights from './hooks/useHeights';\nimport useScrollTo from './hooks/useScrollTo';\nimport useFrameWheel from './hooks/useFrameWheel';\nimport useMobileTouchMove from './hooks/useMobileTouchMove';\nimport useOriginScroll from './hooks/useOriginScroll';\nimport PropTypes from '../_util/vue-types';\nimport classNames from '../_util/classNames';\nimport supportsPassive from '../_util/supportsPassive';\nvar EMPTY_DATA = [];\nvar ScrollStyle = {\n  overflowY: 'auto',\n  overflowAnchor: 'none'\n};\n\nfunction renderChildren(list, startIndex, endIndex, setNodeRef, renderFunc, _ref) {\n  var getKey = _ref.getKey;\n  return list.slice(startIndex, endIndex + 1).map(function (item, index) {\n    var eleIndex = startIndex + index;\n    var node = renderFunc(item, eleIndex, {// style: status === 'MEASURE_START' ? { visibility: 'hidden' } : {},\n    });\n    var key = getKey(item);\n    return _createVNode(Item, {\n      \"key\": key,\n      \"setRef\": function setRef(ele) {\n        return setNodeRef(item, ele);\n      }\n    }, {\n      default: function _default() {\n        return [node];\n      }\n    });\n  });\n}\n\nvar List = defineComponent({\n  name: 'List',\n  inheritAttrs: false,\n  props: {\n    prefixCls: PropTypes.string,\n    data: PropTypes.array,\n    height: PropTypes.number,\n    itemHeight: PropTypes.number,\n\n    /** If not match virtual scroll condition, Set List still use height of container. */\n    fullHeight: PropTypes.looseBool,\n    itemKey: {\n      type: [String, Number, Function],\n      required: true\n    },\n    component: {\n      type: [String, Object]\n    },\n\n    /** Set `false` will always use real scroll instead of virtual one */\n    virtual: PropTypes.looseBool,\n    children: PropTypes.func,\n    onScroll: PropTypes.func,\n    onMousedown: PropTypes.func,\n    onMouseenter: PropTypes.func\n  },\n  setup: function setup(props) {\n    // ================================= MISC =================================\n    var useVirtual = computed(function () {\n      var height = props.height,\n          itemHeight = props.itemHeight,\n          virtual = props.virtual;\n      return !!(virtual !== false && height && itemHeight);\n    });\n    var inVirtual = computed(function () {\n      var height = props.height,\n          itemHeight = props.itemHeight,\n          data = props.data;\n      return useVirtual.value && data && itemHeight * data.length > height;\n    });\n    var state = reactive({\n      scrollTop: 0,\n      scrollMoving: false\n    });\n    var mergedData = computed(function () {\n      return props.data || EMPTY_DATA;\n    });\n    var componentRef = ref();\n    var fillerInnerRef = ref();\n    var scrollBarRef = ref(); // Hack on scrollbar to enable flash call\n    // =============================== Item Key ===============================\n\n    var getKey = function getKey(item) {\n      if (typeof props.itemKey === 'function') {\n        return props.itemKey(item);\n      }\n\n      return item === null || item === void 0 ? void 0 : item[props.itemKey];\n    };\n\n    var sharedConfig = {\n      getKey: getKey\n    }; // ================================ Scroll ================================\n\n    function syncScrollTop(newTop) {\n      var value;\n\n      if (typeof newTop === 'function') {\n        value = newTop(state.scrollTop);\n      } else {\n        value = newTop;\n      }\n\n      var alignedTop = keepInRange(value);\n\n      if (componentRef.value) {\n        componentRef.value.scrollTop = alignedTop;\n      }\n\n      state.scrollTop = alignedTop;\n    } // ================================ Height ================================\n\n\n    var _useHeights = useHeights(getKey, null, null),\n        _useHeights2 = _slicedToArray(_useHeights, 3),\n        setInstance = _useHeights2[0],\n        collectHeight = _useHeights2[1],\n        heights = _useHeights2[2];\n\n    var calRes = ref({});\n    watch([inVirtual, useVirtual, function () {\n      return state.scrollTop;\n    }, mergedData, heights, function () {\n      return props.height;\n    }], function () {\n      nextTick(function () {\n        var _a;\n\n        if (!useVirtual.value) {\n          calRes.value = {\n            scrollHeight: undefined,\n            start: 0,\n            end: mergedData.value.length - 1,\n            offset: undefined\n          };\n          return;\n        } // Always use virtual scroll bar in avoid shaking\n\n\n        if (!inVirtual.value) {\n          calRes.value = {\n            scrollHeight: ((_a = fillerInnerRef.value) === null || _a === void 0 ? void 0 : _a.offsetHeight) || 0,\n            start: 0,\n            end: mergedData.value.length - 1,\n            offset: undefined\n          };\n          return;\n        }\n\n        var itemTop = 0;\n        var startIndex;\n        var startOffset;\n        var endIndex;\n        var dataLen = mergedData.value.length;\n        var data = mergedData.value;\n\n        for (var i = 0; i < dataLen; i += 1) {\n          var item = data[i];\n          var key = getKey(item);\n          var cacheHeight = heights[key];\n          var currentItemBottom = itemTop + (cacheHeight === undefined ? props.itemHeight : cacheHeight);\n\n          if (currentItemBottom >= state.scrollTop && startIndex === undefined) {\n            startIndex = i;\n            startOffset = itemTop;\n          } // Check item bottom in the range. We will render additional one item for motion usage\n\n\n          if (currentItemBottom > state.scrollTop + props.height && endIndex === undefined) {\n            endIndex = i;\n          }\n\n          itemTop = currentItemBottom;\n        } // Fallback to normal if not match. This code should never reach\n\n        /* istanbul ignore next */\n\n\n        if (startIndex === undefined) {\n          startIndex = 0;\n          startOffset = 0;\n        }\n\n        if (endIndex === undefined) {\n          endIndex = dataLen - 1;\n        } // Give cache to improve scroll experience\n\n\n        endIndex = Math.min(endIndex + 1, dataLen);\n        calRes.value = {\n          scrollHeight: itemTop,\n          start: startIndex,\n          end: endIndex,\n          offset: startOffset\n        };\n      });\n    }, {\n      immediate: true,\n      flush: 'post'\n    }); // =============================== In Range ===============================\n\n    var maxScrollHeight = computed(function () {\n      return calRes.value.scrollHeight - props.height;\n    });\n\n    function keepInRange(newScrollTop) {\n      var newTop = newScrollTop;\n\n      if (!Number.isNaN(maxScrollHeight.value)) {\n        newTop = Math.min(newTop, maxScrollHeight.value);\n      }\n\n      newTop = Math.max(newTop, 0);\n      return newTop;\n    }\n\n    var isScrollAtTop = computed(function () {\n      return state.scrollTop <= 0;\n    });\n    var isScrollAtBottom = computed(function () {\n      return state.scrollTop >= maxScrollHeight.value;\n    });\n    var originScroll = useOriginScroll(isScrollAtTop, isScrollAtBottom); // ================================ Scroll ================================\n\n    function onScrollBar(newScrollTop) {\n      var newTop = newScrollTop;\n      syncScrollTop(newTop);\n    } // When data size reduce. It may trigger native scroll event back to fit scroll position\n\n\n    function onFallbackScroll(e) {\n      var _a;\n\n      var newScrollTop = e.currentTarget.scrollTop;\n\n      if (Math.abs(newScrollTop - state.scrollTop) >= 1) {\n        syncScrollTop(newScrollTop);\n      } // Trigger origin onScroll\n\n\n      (_a = props.onScroll) === null || _a === void 0 ? void 0 : _a.call(props, e);\n    } // Since this added in global,should use ref to keep update\n\n\n    var _useFrameWheel = useFrameWheel(useVirtual, isScrollAtTop, isScrollAtBottom, function (offsetY) {\n      syncScrollTop(function (top) {\n        var newTop = top + offsetY;\n        return newTop;\n      });\n    }),\n        _useFrameWheel2 = _slicedToArray(_useFrameWheel, 2),\n        onRawWheel = _useFrameWheel2[0],\n        onFireFoxScroll = _useFrameWheel2[1]; // Mobile touch move\n\n\n    useMobileTouchMove(useVirtual, componentRef, function (deltaY, smoothOffset) {\n      if (originScroll(deltaY, smoothOffset)) {\n        return false;\n      }\n\n      onRawWheel({\n        preventDefault: function preventDefault() {},\n        deltaY: deltaY\n      });\n      return true;\n    }); // Firefox only\n\n    function onMozMousePixelScroll(e) {\n      if (useVirtual.value) {\n        e.preventDefault();\n      }\n    }\n\n    var removeEventListener = function removeEventListener() {\n      if (componentRef.value) {\n        componentRef.value.removeEventListener('wheel', onRawWheel, supportsPassive ? {\n          passive: false\n        } : false);\n        componentRef.value.removeEventListener('DOMMouseScroll', onFireFoxScroll);\n        componentRef.value.removeEventListener('MozMousePixelScroll', onMozMousePixelScroll);\n      }\n    };\n\n    watchEffect(function () {\n      nextTick(function () {\n        if (componentRef.value) {\n          removeEventListener();\n          componentRef.value.addEventListener('wheel', onRawWheel, supportsPassive ? {\n            passive: false\n          } : false);\n          componentRef.value.addEventListener('DOMMouseScroll', onFireFoxScroll);\n          componentRef.value.addEventListener('MozMousePixelScroll', onMozMousePixelScroll);\n        }\n      });\n    });\n    onBeforeUnmount(function () {\n      removeEventListener();\n    }); // ================================= Ref ==================================\n\n    var scrollTo = useScrollTo(componentRef, mergedData, heights, props, getKey, collectHeight, syncScrollTop, function () {\n      var _a;\n\n      (_a = scrollBarRef.value) === null || _a === void 0 ? void 0 : _a.delayHidden();\n    });\n    var componentStyle = computed(function () {\n      var cs = null;\n\n      if (props.height) {\n        cs = _extends(_defineProperty({}, props.fullHeight ? 'height' : 'maxHeight', props.height + 'px'), ScrollStyle);\n\n        if (useVirtual.value) {\n          cs.overflowY = 'hidden';\n\n          if (state.scrollMoving) {\n            cs.pointerEvents = 'none';\n          }\n        }\n      }\n\n      return cs;\n    });\n    return {\n      state: state,\n      mergedData: mergedData,\n      componentStyle: componentStyle,\n      scrollTo: scrollTo,\n      onFallbackScroll: onFallbackScroll,\n      onScrollBar: onScrollBar,\n      componentRef: componentRef,\n      useVirtual: useVirtual,\n      calRes: calRes,\n      collectHeight: collectHeight,\n      setInstance: setInstance,\n      sharedConfig: sharedConfig,\n      scrollBarRef: scrollBarRef,\n      fillerInnerRef: fillerInnerRef\n    };\n  },\n  render: function render() {\n    var _this = this;\n\n    var _a = _extends(_extends({}, this.$props), this.$attrs),\n        _a$prefixCls = _a.prefixCls,\n        prefixCls = _a$prefixCls === void 0 ? 'rc-virtual-list' : _a$prefixCls,\n        height = _a.height,\n        itemHeight = _a.itemHeight,\n        fullHeight = _a.fullHeight,\n        data = _a.data,\n        itemKey = _a.itemKey,\n        virtual = _a.virtual,\n        _a$component = _a.component,\n        Component = _a$component === void 0 ? 'div' : _a$component,\n        onScroll = _a.onScroll,\n        children = _a.children,\n        style = _a.style,\n        className = _a.class,\n        restProps = __rest(_a, [\"prefixCls\", \"height\", \"itemHeight\", \"fullHeight\", \"data\", \"itemKey\", \"virtual\", \"component\", \"onScroll\", \"children\", \"style\", \"class\"]);\n\n    var mergedClassName = classNames(prefixCls, className);\n    var scrollTop = this.state.scrollTop;\n    var _this$calRes = this.calRes,\n        scrollHeight = _this$calRes.scrollHeight,\n        offset = _this$calRes.offset,\n        start = _this$calRes.start,\n        end = _this$calRes.end;\n    var componentStyle = this.componentStyle,\n        onFallbackScroll = this.onFallbackScroll,\n        onScrollBar = this.onScrollBar,\n        useVirtual = this.useVirtual,\n        collectHeight = this.collectHeight,\n        sharedConfig = this.sharedConfig,\n        setInstance = this.setInstance,\n        mergedData = this.mergedData;\n    var listChildren = renderChildren(mergedData, start, end, setInstance, children, sharedConfig);\n    return _createVNode(\"div\", _objectSpread({\n      \"style\": _extends(_extends({}, style), {\n        position: 'relative'\n      }),\n      \"class\": mergedClassName\n    }, restProps), [_createVNode(Component, {\n      \"class\": \"\".concat(prefixCls, \"-holder\"),\n      \"style\": componentStyle,\n      \"ref\": \"componentRef\",\n      \"onScroll\": onFallbackScroll\n    }, {\n      default: function _default() {\n        return [_createVNode(Filler, {\n          \"prefixCls\": prefixCls,\n          \"height\": scrollHeight,\n          \"offset\": offset,\n          \"onInnerResize\": collectHeight,\n          \"ref\": \"fillerInnerRef\"\n        }, {\n          default: function _default() {\n            return [listChildren];\n          }\n        })];\n      }\n    }), useVirtual && _createVNode(ScrollBar, {\n      \"ref\": \"scrollBarRef\",\n      \"prefixCls\": prefixCls,\n      \"scrollTop\": scrollTop,\n      \"height\": height,\n      \"scrollHeight\": scrollHeight,\n      \"count\": mergedData.length,\n      \"onScroll\": onScrollBar,\n      \"onStartMove\": function onStartMove() {\n        _this.state.scrollMoving = true;\n      },\n      \"onStopMove\": function onStopMove() {\n        _this.state.scrollMoving = false;\n      }\n    }, null)]);\n  }\n});\nexport default List;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/node_modules/ant-design-vue/es/vc-virtual-list/List.js"],"names":["_objectSpread","_defineProperty","_extends","_slicedToArray","createVNode","_createVNode","__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","ref","defineComponent","watchEffect","computed","nextTick","onBeforeUnmount","reactive","watch","Filler","Item","ScrollBar","useHeights","useScrollTo","useFrameWheel","useMobileTouchMove","useOriginScroll","PropTypes","classNames","supportsPassive","EMPTY_DATA","ScrollStyle","overflowY","overflowAnchor","renderChildren","list","startIndex","endIndex","setNodeRef","renderFunc","_ref","getKey","slice","map","item","index","eleIndex","node","key","setRef","ele","default","_default","List","name","inheritAttrs","props","prefixCls","string","data","array","height","number","itemHeight","fullHeight","looseBool","itemKey","type","String","Number","Function","required","component","virtual","children","func","onScroll","onMousedown","onMouseenter","setup","useVirtual","inVirtual","value","state","scrollTop","scrollMoving","mergedData","componentRef","fillerInnerRef","scrollBarRef","sharedConfig","syncScrollTop","newTop","alignedTop","keepInRange","_useHeights","_useHeights2","setInstance","collectHeight","heights","calRes","_a","scrollHeight","undefined","start","end","offset","offsetHeight","itemTop","startOffset","dataLen","cacheHeight","currentItemBottom","Math","min","immediate","flush","maxScrollHeight","newScrollTop","isNaN","max","isScrollAtTop","isScrollAtBottom","originScroll","onScrollBar","onFallbackScroll","currentTarget","abs","_useFrameWheel","offsetY","top","_useFrameWheel2","onRawWheel","onFireFoxScroll","deltaY","smoothOffset","preventDefault","onMozMousePixelScroll","removeEventListener","passive","addEventListener","scrollTo","delayHidden","componentStyle","cs","pointerEvents","render","_this","$props","$attrs","_a$prefixCls","_a$component","Component","style","className","class","restProps","mergedClassName","_this$calRes","listChildren","position","concat","onStartMove","onStopMove"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { createVNode as _createVNode } from \"vue\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { ref, defineComponent, watchEffect, computed, nextTick, onBeforeUnmount, reactive, watch } from 'vue';\nimport Filler from './Filler';\nimport Item from './Item';\nimport ScrollBar from './ScrollBar';\nimport useHeights from './hooks/useHeights';\nimport useScrollTo from './hooks/useScrollTo';\nimport useFrameWheel from './hooks/useFrameWheel';\nimport useMobileTouchMove from './hooks/useMobileTouchMove';\nimport useOriginScroll from './hooks/useOriginScroll';\nimport PropTypes from '../_util/vue-types';\nimport classNames from '../_util/classNames';\nimport supportsPassive from '../_util/supportsPassive';\nvar EMPTY_DATA = [];\nvar ScrollStyle = {\n  overflowY: 'auto',\n  overflowAnchor: 'none'\n};\n\nfunction renderChildren(list, startIndex, endIndex, setNodeRef, renderFunc, _ref) {\n  var getKey = _ref.getKey;\n  return list.slice(startIndex, endIndex + 1).map(function (item, index) {\n    var eleIndex = startIndex + index;\n    var node = renderFunc(item, eleIndex, {// style: status === 'MEASURE_START' ? { visibility: 'hidden' } : {},\n    });\n    var key = getKey(item);\n    return _createVNode(Item, {\n      \"key\": key,\n      \"setRef\": function setRef(ele) {\n        return setNodeRef(item, ele);\n      }\n    }, {\n      default: function _default() {\n        return [node];\n      }\n    });\n  });\n}\n\nvar List = defineComponent({\n  name: 'List',\n  inheritAttrs: false,\n  props: {\n    prefixCls: PropTypes.string,\n    data: PropTypes.array,\n    height: PropTypes.number,\n    itemHeight: PropTypes.number,\n\n    /** If not match virtual scroll condition, Set List still use height of container. */\n    fullHeight: PropTypes.looseBool,\n    itemKey: {\n      type: [String, Number, Function],\n      required: true\n    },\n    component: {\n      type: [String, Object]\n    },\n\n    /** Set `false` will always use real scroll instead of virtual one */\n    virtual: PropTypes.looseBool,\n    children: PropTypes.func,\n    onScroll: PropTypes.func,\n    onMousedown: PropTypes.func,\n    onMouseenter: PropTypes.func\n  },\n  setup: function setup(props) {\n    // ================================= MISC =================================\n    var useVirtual = computed(function () {\n      var height = props.height,\n          itemHeight = props.itemHeight,\n          virtual = props.virtual;\n      return !!(virtual !== false && height && itemHeight);\n    });\n    var inVirtual = computed(function () {\n      var height = props.height,\n          itemHeight = props.itemHeight,\n          data = props.data;\n      return useVirtual.value && data && itemHeight * data.length > height;\n    });\n    var state = reactive({\n      scrollTop: 0,\n      scrollMoving: false\n    });\n    var mergedData = computed(function () {\n      return props.data || EMPTY_DATA;\n    });\n    var componentRef = ref();\n    var fillerInnerRef = ref();\n    var scrollBarRef = ref(); // Hack on scrollbar to enable flash call\n    // =============================== Item Key ===============================\n\n    var getKey = function getKey(item) {\n      if (typeof props.itemKey === 'function') {\n        return props.itemKey(item);\n      }\n\n      return item === null || item === void 0 ? void 0 : item[props.itemKey];\n    };\n\n    var sharedConfig = {\n      getKey: getKey\n    }; // ================================ Scroll ================================\n\n    function syncScrollTop(newTop) {\n      var value;\n\n      if (typeof newTop === 'function') {\n        value = newTop(state.scrollTop);\n      } else {\n        value = newTop;\n      }\n\n      var alignedTop = keepInRange(value);\n\n      if (componentRef.value) {\n        componentRef.value.scrollTop = alignedTop;\n      }\n\n      state.scrollTop = alignedTop;\n    } // ================================ Height ================================\n\n\n    var _useHeights = useHeights(getKey, null, null),\n        _useHeights2 = _slicedToArray(_useHeights, 3),\n        setInstance = _useHeights2[0],\n        collectHeight = _useHeights2[1],\n        heights = _useHeights2[2];\n\n    var calRes = ref({});\n    watch([inVirtual, useVirtual, function () {\n      return state.scrollTop;\n    }, mergedData, heights, function () {\n      return props.height;\n    }], function () {\n      nextTick(function () {\n        var _a;\n\n        if (!useVirtual.value) {\n          calRes.value = {\n            scrollHeight: undefined,\n            start: 0,\n            end: mergedData.value.length - 1,\n            offset: undefined\n          };\n          return;\n        } // Always use virtual scroll bar in avoid shaking\n\n\n        if (!inVirtual.value) {\n          calRes.value = {\n            scrollHeight: ((_a = fillerInnerRef.value) === null || _a === void 0 ? void 0 : _a.offsetHeight) || 0,\n            start: 0,\n            end: mergedData.value.length - 1,\n            offset: undefined\n          };\n          return;\n        }\n\n        var itemTop = 0;\n        var startIndex;\n        var startOffset;\n        var endIndex;\n        var dataLen = mergedData.value.length;\n        var data = mergedData.value;\n\n        for (var i = 0; i < dataLen; i += 1) {\n          var item = data[i];\n          var key = getKey(item);\n          var cacheHeight = heights[key];\n          var currentItemBottom = itemTop + (cacheHeight === undefined ? props.itemHeight : cacheHeight);\n\n          if (currentItemBottom >= state.scrollTop && startIndex === undefined) {\n            startIndex = i;\n            startOffset = itemTop;\n          } // Check item bottom in the range. We will render additional one item for motion usage\n\n\n          if (currentItemBottom > state.scrollTop + props.height && endIndex === undefined) {\n            endIndex = i;\n          }\n\n          itemTop = currentItemBottom;\n        } // Fallback to normal if not match. This code should never reach\n\n        /* istanbul ignore next */\n\n\n        if (startIndex === undefined) {\n          startIndex = 0;\n          startOffset = 0;\n        }\n\n        if (endIndex === undefined) {\n          endIndex = dataLen - 1;\n        } // Give cache to improve scroll experience\n\n\n        endIndex = Math.min(endIndex + 1, dataLen);\n        calRes.value = {\n          scrollHeight: itemTop,\n          start: startIndex,\n          end: endIndex,\n          offset: startOffset\n        };\n      });\n    }, {\n      immediate: true,\n      flush: 'post'\n    }); // =============================== In Range ===============================\n\n    var maxScrollHeight = computed(function () {\n      return calRes.value.scrollHeight - props.height;\n    });\n\n    function keepInRange(newScrollTop) {\n      var newTop = newScrollTop;\n\n      if (!Number.isNaN(maxScrollHeight.value)) {\n        newTop = Math.min(newTop, maxScrollHeight.value);\n      }\n\n      newTop = Math.max(newTop, 0);\n      return newTop;\n    }\n\n    var isScrollAtTop = computed(function () {\n      return state.scrollTop <= 0;\n    });\n    var isScrollAtBottom = computed(function () {\n      return state.scrollTop >= maxScrollHeight.value;\n    });\n    var originScroll = useOriginScroll(isScrollAtTop, isScrollAtBottom); // ================================ Scroll ================================\n\n    function onScrollBar(newScrollTop) {\n      var newTop = newScrollTop;\n      syncScrollTop(newTop);\n    } // When data size reduce. It may trigger native scroll event back to fit scroll position\n\n\n    function onFallbackScroll(e) {\n      var _a;\n\n      var newScrollTop = e.currentTarget.scrollTop;\n\n      if (Math.abs(newScrollTop - state.scrollTop) >= 1) {\n        syncScrollTop(newScrollTop);\n      } // Trigger origin onScroll\n\n\n      (_a = props.onScroll) === null || _a === void 0 ? void 0 : _a.call(props, e);\n    } // Since this added in global,should use ref to keep update\n\n\n    var _useFrameWheel = useFrameWheel(useVirtual, isScrollAtTop, isScrollAtBottom, function (offsetY) {\n      syncScrollTop(function (top) {\n        var newTop = top + offsetY;\n        return newTop;\n      });\n    }),\n        _useFrameWheel2 = _slicedToArray(_useFrameWheel, 2),\n        onRawWheel = _useFrameWheel2[0],\n        onFireFoxScroll = _useFrameWheel2[1]; // Mobile touch move\n\n\n    useMobileTouchMove(useVirtual, componentRef, function (deltaY, smoothOffset) {\n      if (originScroll(deltaY, smoothOffset)) {\n        return false;\n      }\n\n      onRawWheel({\n        preventDefault: function preventDefault() {},\n        deltaY: deltaY\n      });\n      return true;\n    }); // Firefox only\n\n    function onMozMousePixelScroll(e) {\n      if (useVirtual.value) {\n        e.preventDefault();\n      }\n    }\n\n    var removeEventListener = function removeEventListener() {\n      if (componentRef.value) {\n        componentRef.value.removeEventListener('wheel', onRawWheel, supportsPassive ? {\n          passive: false\n        } : false);\n        componentRef.value.removeEventListener('DOMMouseScroll', onFireFoxScroll);\n        componentRef.value.removeEventListener('MozMousePixelScroll', onMozMousePixelScroll);\n      }\n    };\n\n    watchEffect(function () {\n      nextTick(function () {\n        if (componentRef.value) {\n          removeEventListener();\n          componentRef.value.addEventListener('wheel', onRawWheel, supportsPassive ? {\n            passive: false\n          } : false);\n          componentRef.value.addEventListener('DOMMouseScroll', onFireFoxScroll);\n          componentRef.value.addEventListener('MozMousePixelScroll', onMozMousePixelScroll);\n        }\n      });\n    });\n    onBeforeUnmount(function () {\n      removeEventListener();\n    }); // ================================= Ref ==================================\n\n    var scrollTo = useScrollTo(componentRef, mergedData, heights, props, getKey, collectHeight, syncScrollTop, function () {\n      var _a;\n\n      (_a = scrollBarRef.value) === null || _a === void 0 ? void 0 : _a.delayHidden();\n    });\n    var componentStyle = computed(function () {\n      var cs = null;\n\n      if (props.height) {\n        cs = _extends(_defineProperty({}, props.fullHeight ? 'height' : 'maxHeight', props.height + 'px'), ScrollStyle);\n\n        if (useVirtual.value) {\n          cs.overflowY = 'hidden';\n\n          if (state.scrollMoving) {\n            cs.pointerEvents = 'none';\n          }\n        }\n      }\n\n      return cs;\n    });\n    return {\n      state: state,\n      mergedData: mergedData,\n      componentStyle: componentStyle,\n      scrollTo: scrollTo,\n      onFallbackScroll: onFallbackScroll,\n      onScrollBar: onScrollBar,\n      componentRef: componentRef,\n      useVirtual: useVirtual,\n      calRes: calRes,\n      collectHeight: collectHeight,\n      setInstance: setInstance,\n      sharedConfig: sharedConfig,\n      scrollBarRef: scrollBarRef,\n      fillerInnerRef: fillerInnerRef\n    };\n  },\n  render: function render() {\n    var _this = this;\n\n    var _a = _extends(_extends({}, this.$props), this.$attrs),\n        _a$prefixCls = _a.prefixCls,\n        prefixCls = _a$prefixCls === void 0 ? 'rc-virtual-list' : _a$prefixCls,\n        height = _a.height,\n        itemHeight = _a.itemHeight,\n        fullHeight = _a.fullHeight,\n        data = _a.data,\n        itemKey = _a.itemKey,\n        virtual = _a.virtual,\n        _a$component = _a.component,\n        Component = _a$component === void 0 ? 'div' : _a$component,\n        onScroll = _a.onScroll,\n        children = _a.children,\n        style = _a.style,\n        className = _a.class,\n        restProps = __rest(_a, [\"prefixCls\", \"height\", \"itemHeight\", \"fullHeight\", \"data\", \"itemKey\", \"virtual\", \"component\", \"onScroll\", \"children\", \"style\", \"class\"]);\n\n    var mergedClassName = classNames(prefixCls, className);\n    var scrollTop = this.state.scrollTop;\n    var _this$calRes = this.calRes,\n        scrollHeight = _this$calRes.scrollHeight,\n        offset = _this$calRes.offset,\n        start = _this$calRes.start,\n        end = _this$calRes.end;\n    var componentStyle = this.componentStyle,\n        onFallbackScroll = this.onFallbackScroll,\n        onScrollBar = this.onScrollBar,\n        useVirtual = this.useVirtual,\n        collectHeight = this.collectHeight,\n        sharedConfig = this.sharedConfig,\n        setInstance = this.setInstance,\n        mergedData = this.mergedData;\n    var listChildren = renderChildren(mergedData, start, end, setInstance, children, sharedConfig);\n    return _createVNode(\"div\", _objectSpread({\n      \"style\": _extends(_extends({}, style), {\n        position: 'relative'\n      }),\n      \"class\": mergedClassName\n    }, restProps), [_createVNode(Component, {\n      \"class\": \"\".concat(prefixCls, \"-holder\"),\n      \"style\": componentStyle,\n      \"ref\": \"componentRef\",\n      \"onScroll\": onFallbackScroll\n    }, {\n      default: function _default() {\n        return [_createVNode(Filler, {\n          \"prefixCls\": prefixCls,\n          \"height\": scrollHeight,\n          \"offset\": offset,\n          \"onInnerResize\": collectHeight,\n          \"ref\": \"fillerInnerRef\"\n        }, {\n          default: function _default() {\n            return [listChildren];\n          }\n        })];\n      }\n    }), useVirtual && _createVNode(ScrollBar, {\n      \"ref\": \"scrollBarRef\",\n      \"prefixCls\": prefixCls,\n      \"scrollTop\": scrollTop,\n      \"height\": height,\n      \"scrollHeight\": scrollHeight,\n      \"count\": mergedData.length,\n      \"onScroll\": onScrollBar,\n      \"onStartMove\": function onStartMove() {\n        _this.state.scrollMoving = true;\n      },\n      \"onStopMove\": function onStopMove() {\n        _this.state.scrollMoving = false;\n      }\n    }, null)]);\n  }\n});\nexport default List;"]},"metadata":{},"sourceType":"module"}