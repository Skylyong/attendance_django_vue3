{"ast":null,"code":"import { createVNode as _createVNode } from \"vue\";\nimport { ref, watch, reactive, defineComponent } from \"vue\";\nimport { deepClone } from \"../utils/deep-clone\";\nimport { clamp, isObject, unknownProp, numericProp, makeArrayProp, makeNumberProp, preventDefault, createNamespace, makeRequiredProp } from \"../utils\";\nimport { useParent } from \"@vant/use\";\nimport { useTouch } from \"../composables/use-touch\";\nimport { useExpose } from \"../composables/use-expose\";\nconst DEFAULT_DURATION = 200;\nconst MOMENTUM_LIMIT_TIME = 300;\nconst MOMENTUM_LIMIT_DISTANCE = 15;\nconst [name, bem] = createNamespace(\"picker-column\");\n\nfunction getElementTranslateY(element) {\n  const {\n    transform\n  } = window.getComputedStyle(element);\n  const translateY = transform.slice(7, transform.length - 1).split(\", \")[5];\n  return Number(translateY);\n}\n\nconst PICKER_KEY = Symbol(name);\n\nconst isOptionDisabled = option => isObject(option) && option.disabled;\n\nvar stdin_default = defineComponent({\n  name,\n  props: {\n    textKey: makeRequiredProp(String),\n    readonly: Boolean,\n    allowHtml: Boolean,\n    className: unknownProp,\n    itemHeight: makeRequiredProp(Number),\n    defaultIndex: makeNumberProp(0),\n    swipeDuration: makeRequiredProp(numericProp),\n    initialOptions: makeArrayProp(),\n    visibleItemCount: makeRequiredProp(numericProp)\n  },\n  emits: [\"change\"],\n\n  setup(props, {\n    emit,\n    slots\n  }) {\n    let moving;\n    let startOffset;\n    let touchStartTime;\n    let momentumOffset;\n    let transitionEndTrigger;\n    const wrapper = ref();\n    const state = reactive({\n      index: props.defaultIndex,\n      offset: 0,\n      duration: 0,\n      options: deepClone(props.initialOptions)\n    });\n    const touch = useTouch();\n\n    const count = () => state.options.length;\n\n    const baseOffset = () => props.itemHeight * (+props.visibleItemCount - 1) / 2;\n\n    const adjustIndex = index => {\n      index = clamp(index, 0, count());\n\n      for (let i = index; i < count(); i++) {\n        if (!isOptionDisabled(state.options[i])) return i;\n      }\n\n      for (let i = index - 1; i >= 0; i--) {\n        if (!isOptionDisabled(state.options[i])) return i;\n      }\n    };\n\n    const setIndex = (index, emitChange) => {\n      index = adjustIndex(index) || 0;\n      const offset = -index * props.itemHeight;\n\n      const trigger = () => {\n        if (index !== state.index) {\n          state.index = index;\n\n          if (emitChange) {\n            emit(\"change\", index);\n          }\n        }\n      };\n\n      if (moving && offset !== state.offset) {\n        transitionEndTrigger = trigger;\n      } else {\n        trigger();\n      }\n\n      state.offset = offset;\n    };\n\n    const setOptions = options => {\n      if (JSON.stringify(options) !== JSON.stringify(state.options)) {\n        state.options = deepClone(options);\n        setIndex(props.defaultIndex);\n      }\n    };\n\n    const onClickItem = index => {\n      if (moving || props.readonly) {\n        return;\n      }\n\n      transitionEndTrigger = null;\n      state.duration = DEFAULT_DURATION;\n      setIndex(index, true);\n    };\n\n    const getOptionText = option => {\n      if (isObject(option) && props.textKey in option) {\n        return option[props.textKey];\n      }\n\n      return option;\n    };\n\n    const getIndexByOffset = offset => clamp(Math.round(-offset / props.itemHeight), 0, count() - 1);\n\n    const momentum = (distance, duration) => {\n      const speed = Math.abs(distance / duration);\n      distance = state.offset + speed / 3e-3 * (distance < 0 ? -1 : 1);\n      const index = getIndexByOffset(distance);\n      state.duration = +props.swipeDuration;\n      setIndex(index, true);\n    };\n\n    const stopMomentum = () => {\n      moving = false;\n      state.duration = 0;\n\n      if (transitionEndTrigger) {\n        transitionEndTrigger();\n        transitionEndTrigger = null;\n      }\n    };\n\n    const onTouchStart = event => {\n      if (props.readonly) {\n        return;\n      }\n\n      touch.start(event);\n\n      if (moving) {\n        const translateY = getElementTranslateY(wrapper.value);\n        state.offset = Math.min(0, translateY - baseOffset());\n        startOffset = state.offset;\n      } else {\n        startOffset = state.offset;\n      }\n\n      state.duration = 0;\n      touchStartTime = Date.now();\n      momentumOffset = startOffset;\n      transitionEndTrigger = null;\n    };\n\n    const onTouchMove = event => {\n      if (props.readonly) {\n        return;\n      }\n\n      touch.move(event);\n\n      if (touch.isVertical()) {\n        moving = true;\n        preventDefault(event, true);\n      }\n\n      state.offset = clamp(startOffset + touch.deltaY.value, -(count() * props.itemHeight), props.itemHeight);\n      const now = Date.now();\n\n      if (now - touchStartTime > MOMENTUM_LIMIT_TIME) {\n        touchStartTime = now;\n        momentumOffset = state.offset;\n      }\n    };\n\n    const onTouchEnd = () => {\n      if (props.readonly) {\n        return;\n      }\n\n      const distance = state.offset - momentumOffset;\n      const duration = Date.now() - touchStartTime;\n      const allowMomentum = duration < MOMENTUM_LIMIT_TIME && Math.abs(distance) > MOMENTUM_LIMIT_DISTANCE;\n\n      if (allowMomentum) {\n        momentum(distance, duration);\n        return;\n      }\n\n      const index = getIndexByOffset(state.offset);\n      state.duration = DEFAULT_DURATION;\n      setIndex(index, true);\n      setTimeout(() => {\n        moving = false;\n      }, 0);\n    };\n\n    const renderOptions = () => {\n      const optionStyle = {\n        height: `${props.itemHeight}px`\n      };\n      return state.options.map((option, index) => {\n        const text = getOptionText(option);\n        const disabled = isOptionDisabled(option);\n        const data = {\n          role: \"button\",\n          style: optionStyle,\n          tabindex: disabled ? -1 : 0,\n          class: bem(\"item\", {\n            disabled,\n            selected: index === state.index\n          }),\n          onClick: () => onClickItem(index)\n        };\n        const childData = {\n          class: \"van-ellipsis\",\n          [props.allowHtml ? \"innerHTML\" : \"textContent\"]: text\n        };\n        return _createVNode(\"li\", data, [slots.option ? slots.option(option) : _createVNode(\"div\", childData, null)]);\n      });\n    };\n\n    const setValue = value => {\n      const {\n        options\n      } = state;\n\n      for (let i = 0; i < options.length; i++) {\n        if (getOptionText(options[i]) === value) {\n          return setIndex(i);\n        }\n      }\n    };\n\n    const getValue = () => state.options[state.index];\n\n    setIndex(state.index);\n    useParent(PICKER_KEY);\n    useExpose({\n      state,\n      setIndex,\n      getValue,\n      setValue,\n      setOptions,\n      stopMomentum\n    });\n    watch(() => props.initialOptions, setOptions);\n    watch(() => props.defaultIndex, value => setIndex(value));\n    return () => _createVNode(\"div\", {\n      \"class\": [bem(), props.className],\n      \"onTouchstart\": onTouchStart,\n      \"onTouchmove\": onTouchMove,\n      \"onTouchend\": onTouchEnd,\n      \"onTouchcancel\": onTouchEnd\n    }, [_createVNode(\"ul\", {\n      \"ref\": wrapper,\n      \"style\": {\n        transform: `translate3d(0, ${state.offset + baseOffset()}px, 0)`,\n        transitionDuration: `${state.duration}ms`,\n        transitionProperty: state.duration ? \"all\" : \"none\"\n      },\n      \"class\": bem(\"wrapper\"),\n      \"onTransitionend\": stopMomentum\n    }, [renderOptions()])]);\n  }\n\n});\nexport { PICKER_KEY, stdin_default as default };","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/vant/es/picker/PickerColumn.js"],"names":["createVNode","_createVNode","ref","watch","reactive","defineComponent","deepClone","clamp","isObject","unknownProp","numericProp","makeArrayProp","makeNumberProp","preventDefault","createNamespace","makeRequiredProp","useParent","useTouch","useExpose","DEFAULT_DURATION","MOMENTUM_LIMIT_TIME","MOMENTUM_LIMIT_DISTANCE","name","bem","getElementTranslateY","element","transform","window","getComputedStyle","translateY","slice","length","split","Number","PICKER_KEY","Symbol","isOptionDisabled","option","disabled","stdin_default","props","textKey","String","readonly","Boolean","allowHtml","className","itemHeight","defaultIndex","swipeDuration","initialOptions","visibleItemCount","emits","setup","emit","slots","moving","startOffset","touchStartTime","momentumOffset","transitionEndTrigger","wrapper","state","index","offset","duration","options","touch","count","baseOffset","adjustIndex","i","setIndex","emitChange","trigger","setOptions","JSON","stringify","onClickItem","getOptionText","getIndexByOffset","Math","round","momentum","distance","speed","abs","stopMomentum","onTouchStart","event","start","value","min","Date","now","onTouchMove","move","isVertical","deltaY","onTouchEnd","allowMomentum","setTimeout","renderOptions","optionStyle","height","map","text","data","role","style","tabindex","class","selected","onClick","childData","setValue","getValue","transitionDuration","transitionProperty","default"],"mappings":"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","sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport { ref, watch, reactive, defineComponent } from \"vue\";\nimport { deepClone } from \"../utils/deep-clone\";\nimport { clamp, isObject, unknownProp, numericProp, makeArrayProp, makeNumberProp, preventDefault, createNamespace, makeRequiredProp } from \"../utils\";\nimport { useParent } from \"@vant/use\";\nimport { useTouch } from \"../composables/use-touch\";\nimport { useExpose } from \"../composables/use-expose\";\nconst DEFAULT_DURATION = 200;\nconst MOMENTUM_LIMIT_TIME = 300;\nconst MOMENTUM_LIMIT_DISTANCE = 15;\nconst [name, bem] = createNamespace(\"picker-column\");\nfunction getElementTranslateY(element) {\n  const {\n    transform\n  } = window.getComputedStyle(element);\n  const translateY = transform.slice(7, transform.length - 1).split(\", \")[5];\n  return Number(translateY);\n}\nconst PICKER_KEY = Symbol(name);\nconst isOptionDisabled = (option) => isObject(option) && option.disabled;\nvar stdin_default = defineComponent({\n  name,\n  props: {\n    textKey: makeRequiredProp(String),\n    readonly: Boolean,\n    allowHtml: Boolean,\n    className: unknownProp,\n    itemHeight: makeRequiredProp(Number),\n    defaultIndex: makeNumberProp(0),\n    swipeDuration: makeRequiredProp(numericProp),\n    initialOptions: makeArrayProp(),\n    visibleItemCount: makeRequiredProp(numericProp)\n  },\n  emits: [\"change\"],\n  setup(props, {\n    emit,\n    slots\n  }) {\n    let moving;\n    let startOffset;\n    let touchStartTime;\n    let momentumOffset;\n    let transitionEndTrigger;\n    const wrapper = ref();\n    const state = reactive({\n      index: props.defaultIndex,\n      offset: 0,\n      duration: 0,\n      options: deepClone(props.initialOptions)\n    });\n    const touch = useTouch();\n    const count = () => state.options.length;\n    const baseOffset = () => props.itemHeight * (+props.visibleItemCount - 1) / 2;\n    const adjustIndex = (index) => {\n      index = clamp(index, 0, count());\n      for (let i = index; i < count(); i++) {\n        if (!isOptionDisabled(state.options[i]))\n          return i;\n      }\n      for (let i = index - 1; i >= 0; i--) {\n        if (!isOptionDisabled(state.options[i]))\n          return i;\n      }\n    };\n    const setIndex = (index, emitChange) => {\n      index = adjustIndex(index) || 0;\n      const offset = -index * props.itemHeight;\n      const trigger = () => {\n        if (index !== state.index) {\n          state.index = index;\n          if (emitChange) {\n            emit(\"change\", index);\n          }\n        }\n      };\n      if (moving && offset !== state.offset) {\n        transitionEndTrigger = trigger;\n      } else {\n        trigger();\n      }\n      state.offset = offset;\n    };\n    const setOptions = (options) => {\n      if (JSON.stringify(options) !== JSON.stringify(state.options)) {\n        state.options = deepClone(options);\n        setIndex(props.defaultIndex);\n      }\n    };\n    const onClickItem = (index) => {\n      if (moving || props.readonly) {\n        return;\n      }\n      transitionEndTrigger = null;\n      state.duration = DEFAULT_DURATION;\n      setIndex(index, true);\n    };\n    const getOptionText = (option) => {\n      if (isObject(option) && props.textKey in option) {\n        return option[props.textKey];\n      }\n      return option;\n    };\n    const getIndexByOffset = (offset) => clamp(Math.round(-offset / props.itemHeight), 0, count() - 1);\n    const momentum = (distance, duration) => {\n      const speed = Math.abs(distance / duration);\n      distance = state.offset + speed / 3e-3 * (distance < 0 ? -1 : 1);\n      const index = getIndexByOffset(distance);\n      state.duration = +props.swipeDuration;\n      setIndex(index, true);\n    };\n    const stopMomentum = () => {\n      moving = false;\n      state.duration = 0;\n      if (transitionEndTrigger) {\n        transitionEndTrigger();\n        transitionEndTrigger = null;\n      }\n    };\n    const onTouchStart = (event) => {\n      if (props.readonly) {\n        return;\n      }\n      touch.start(event);\n      if (moving) {\n        const translateY = getElementTranslateY(wrapper.value);\n        state.offset = Math.min(0, translateY - baseOffset());\n        startOffset = state.offset;\n      } else {\n        startOffset = state.offset;\n      }\n      state.duration = 0;\n      touchStartTime = Date.now();\n      momentumOffset = startOffset;\n      transitionEndTrigger = null;\n    };\n    const onTouchMove = (event) => {\n      if (props.readonly) {\n        return;\n      }\n      touch.move(event);\n      if (touch.isVertical()) {\n        moving = true;\n        preventDefault(event, true);\n      }\n      state.offset = clamp(startOffset + touch.deltaY.value, -(count() * props.itemHeight), props.itemHeight);\n      const now = Date.now();\n      if (now - touchStartTime > MOMENTUM_LIMIT_TIME) {\n        touchStartTime = now;\n        momentumOffset = state.offset;\n      }\n    };\n    const onTouchEnd = () => {\n      if (props.readonly) {\n        return;\n      }\n      const distance = state.offset - momentumOffset;\n      const duration = Date.now() - touchStartTime;\n      const allowMomentum = duration < MOMENTUM_LIMIT_TIME && Math.abs(distance) > MOMENTUM_LIMIT_DISTANCE;\n      if (allowMomentum) {\n        momentum(distance, duration);\n        return;\n      }\n      const index = getIndexByOffset(state.offset);\n      state.duration = DEFAULT_DURATION;\n      setIndex(index, true);\n      setTimeout(() => {\n        moving = false;\n      }, 0);\n    };\n    const renderOptions = () => {\n      const optionStyle = {\n        height: `${props.itemHeight}px`\n      };\n      return state.options.map((option, index) => {\n        const text = getOptionText(option);\n        const disabled = isOptionDisabled(option);\n        const data = {\n          role: \"button\",\n          style: optionStyle,\n          tabindex: disabled ? -1 : 0,\n          class: bem(\"item\", {\n            disabled,\n            selected: index === state.index\n          }),\n          onClick: () => onClickItem(index)\n        };\n        const childData = {\n          class: \"van-ellipsis\",\n          [props.allowHtml ? \"innerHTML\" : \"textContent\"]: text\n        };\n        return _createVNode(\"li\", data, [slots.option ? slots.option(option) : _createVNode(\"div\", childData, null)]);\n      });\n    };\n    const setValue = (value) => {\n      const {\n        options\n      } = state;\n      for (let i = 0; i < options.length; i++) {\n        if (getOptionText(options[i]) === value) {\n          return setIndex(i);\n        }\n      }\n    };\n    const getValue = () => state.options[state.index];\n    setIndex(state.index);\n    useParent(PICKER_KEY);\n    useExpose({\n      state,\n      setIndex,\n      getValue,\n      setValue,\n      setOptions,\n      stopMomentum\n    });\n    watch(() => props.initialOptions, setOptions);\n    watch(() => props.defaultIndex, (value) => setIndex(value));\n    return () => _createVNode(\"div\", {\n      \"class\": [bem(), props.className],\n      \"onTouchstart\": onTouchStart,\n      \"onTouchmove\": onTouchMove,\n      \"onTouchend\": onTouchEnd,\n      \"onTouchcancel\": onTouchEnd\n    }, [_createVNode(\"ul\", {\n      \"ref\": wrapper,\n      \"style\": {\n        transform: `translate3d(0, ${state.offset + baseOffset()}px, 0)`,\n        transitionDuration: `${state.duration}ms`,\n        transitionProperty: state.duration ? \"all\" : \"none\"\n      },\n      \"class\": bem(\"wrapper\"),\n      \"onTransitionend\": stopMomentum\n    }, [renderOptions()])]);\n  }\n});\nexport {\n  PICKER_KEY,\n  stdin_default as default\n};\n"]},"metadata":{},"sourceType":"module"}