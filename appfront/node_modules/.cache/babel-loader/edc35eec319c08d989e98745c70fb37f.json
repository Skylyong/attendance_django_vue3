{"ast":null,"code":"import { withDirectives as _withDirectives, mergeProps as _mergeProps, resolveDirective as _resolveDirective, createVNode as _createVNode } from \"vue\";\nimport { ref, watch, computed, nextTick, onBeforeUnmount, defineComponent, getCurrentInstance } from \"vue\";\nimport { isDef, addUnit, inBrowser, truthProp, numericProp, makeStringProp, createNamespace } from \"../utils\";\nimport { Icon } from \"../icon\";\nconst [name, bem] = createNamespace(\"image\");\nconst imageProps = {\n  src: String,\n  alt: String,\n  fit: String,\n  position: String,\n  round: Boolean,\n  width: numericProp,\n  height: numericProp,\n  radius: numericProp,\n  lazyLoad: Boolean,\n  iconSize: numericProp,\n  showError: truthProp,\n  errorIcon: makeStringProp(\"photo-fail\"),\n  iconPrefix: String,\n  showLoading: truthProp,\n  loadingIcon: makeStringProp(\"photo\")\n};\nvar stdin_default = defineComponent({\n  name,\n  props: imageProps,\n  emits: [\"load\", \"error\"],\n\n  setup(props, {\n    emit,\n    slots\n  }) {\n    const error = ref(false);\n    const loading = ref(true);\n    const imageRef = ref();\n    const {\n      $Lazyload\n    } = getCurrentInstance().proxy;\n    const style = computed(() => {\n      const style2 = {\n        width: addUnit(props.width),\n        height: addUnit(props.height)\n      };\n\n      if (isDef(props.radius)) {\n        style2.overflow = \"hidden\";\n        style2.borderRadius = addUnit(props.radius);\n      }\n\n      return style2;\n    });\n    watch(() => props.src, () => {\n      error.value = false;\n      loading.value = true;\n    });\n\n    const onLoad = event => {\n      loading.value = false;\n      emit(\"load\", event);\n    };\n\n    const onError = event => {\n      error.value = true;\n      loading.value = false;\n      emit(\"error\", event);\n    };\n\n    const renderIcon = (name2, className, slot) => {\n      if (slot) {\n        return slot();\n      }\n\n      return _createVNode(Icon, {\n        \"name\": name2,\n        \"size\": props.iconSize,\n        \"class\": className,\n        \"classPrefix\": props.iconPrefix\n      }, null);\n    };\n\n    const renderPlaceholder = () => {\n      if (loading.value && props.showLoading) {\n        return _createVNode(\"div\", {\n          \"class\": bem(\"loading\")\n        }, [renderIcon(props.loadingIcon, bem(\"loading-icon\"), slots.loading)]);\n      }\n\n      if (error.value && props.showError) {\n        return _createVNode(\"div\", {\n          \"class\": bem(\"error\")\n        }, [renderIcon(props.errorIcon, bem(\"error-icon\"), slots.error)]);\n      }\n    };\n\n    const renderImage = () => {\n      if (error.value || !props.src) {\n        return;\n      }\n\n      const attrs = {\n        alt: props.alt,\n        class: bem(\"img\"),\n        style: {\n          objectFit: props.fit,\n          objectPosition: props.position\n        }\n      };\n\n      if (props.lazyLoad) {\n        return _withDirectives(_createVNode(\"img\", _mergeProps({\n          \"ref\": imageRef\n        }, attrs), null), [[_resolveDirective(\"lazy\"), props.src]]);\n      }\n\n      return _createVNode(\"img\", _mergeProps({\n        \"src\": props.src,\n        \"onLoad\": onLoad,\n        \"onError\": onError\n      }, attrs), null);\n    };\n\n    const onLazyLoaded = ({\n      el\n    }) => {\n      const check = () => {\n        if (el === imageRef.value && loading.value) {\n          onLoad();\n        }\n      };\n\n      if (imageRef.value) {\n        check();\n      } else {\n        nextTick(check);\n      }\n    };\n\n    const onLazyLoadError = ({\n      el\n    }) => {\n      if (el === imageRef.value && !error.value) {\n        onError();\n      }\n    };\n\n    if ($Lazyload && inBrowser) {\n      $Lazyload.$on(\"loaded\", onLazyLoaded);\n      $Lazyload.$on(\"error\", onLazyLoadError);\n      onBeforeUnmount(() => {\n        $Lazyload.$off(\"loaded\", onLazyLoaded);\n        $Lazyload.$off(\"error\", onLazyLoadError);\n      });\n    }\n\n    return () => {\n      var _a;\n\n      return _createVNode(\"div\", {\n        \"class\": bem({\n          round: props.round\n        }),\n        \"style\": style.value\n      }, [renderImage(), renderPlaceholder(), (_a = slots.default) == null ? void 0 : _a.call(slots)]);\n    };\n  }\n\n});\nexport { stdin_default as default };","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/vant/es/image/Image.js"],"names":["withDirectives","_withDirectives","mergeProps","_mergeProps","resolveDirective","_resolveDirective","createVNode","_createVNode","ref","watch","computed","nextTick","onBeforeUnmount","defineComponent","getCurrentInstance","isDef","addUnit","inBrowser","truthProp","numericProp","makeStringProp","createNamespace","Icon","name","bem","imageProps","src","String","alt","fit","position","round","Boolean","width","height","radius","lazyLoad","iconSize","showError","errorIcon","iconPrefix","showLoading","loadingIcon","stdin_default","props","emits","setup","emit","slots","error","loading","imageRef","$Lazyload","proxy","style","style2","overflow","borderRadius","value","onLoad","event","onError","renderIcon","name2","className","slot","renderPlaceholder","renderImage","attrs","class","objectFit","objectPosition","onLazyLoaded","el","check","onLazyLoadError","$on","$off","_a","default","call"],"mappings":"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","sourcesContent":["import { withDirectives as _withDirectives, mergeProps as _mergeProps, resolveDirective as _resolveDirective, createVNode as _createVNode } from \"vue\";\nimport { ref, watch, computed, nextTick, onBeforeUnmount, defineComponent, getCurrentInstance } from \"vue\";\nimport { isDef, addUnit, inBrowser, truthProp, numericProp, makeStringProp, createNamespace } from \"../utils\";\nimport { Icon } from \"../icon\";\nconst [name, bem] = createNamespace(\"image\");\nconst imageProps = {\n  src: String,\n  alt: String,\n  fit: String,\n  position: String,\n  round: Boolean,\n  width: numericProp,\n  height: numericProp,\n  radius: numericProp,\n  lazyLoad: Boolean,\n  iconSize: numericProp,\n  showError: truthProp,\n  errorIcon: makeStringProp(\"photo-fail\"),\n  iconPrefix: String,\n  showLoading: truthProp,\n  loadingIcon: makeStringProp(\"photo\")\n};\nvar stdin_default = defineComponent({\n  name,\n  props: imageProps,\n  emits: [\"load\", \"error\"],\n  setup(props, {\n    emit,\n    slots\n  }) {\n    const error = ref(false);\n    const loading = ref(true);\n    const imageRef = ref();\n    const {\n      $Lazyload\n    } = getCurrentInstance().proxy;\n    const style = computed(() => {\n      const style2 = {\n        width: addUnit(props.width),\n        height: addUnit(props.height)\n      };\n      if (isDef(props.radius)) {\n        style2.overflow = \"hidden\";\n        style2.borderRadius = addUnit(props.radius);\n      }\n      return style2;\n    });\n    watch(() => props.src, () => {\n      error.value = false;\n      loading.value = true;\n    });\n    const onLoad = (event) => {\n      loading.value = false;\n      emit(\"load\", event);\n    };\n    const onError = (event) => {\n      error.value = true;\n      loading.value = false;\n      emit(\"error\", event);\n    };\n    const renderIcon = (name2, className, slot) => {\n      if (slot) {\n        return slot();\n      }\n      return _createVNode(Icon, {\n        \"name\": name2,\n        \"size\": props.iconSize,\n        \"class\": className,\n        \"classPrefix\": props.iconPrefix\n      }, null);\n    };\n    const renderPlaceholder = () => {\n      if (loading.value && props.showLoading) {\n        return _createVNode(\"div\", {\n          \"class\": bem(\"loading\")\n        }, [renderIcon(props.loadingIcon, bem(\"loading-icon\"), slots.loading)]);\n      }\n      if (error.value && props.showError) {\n        return _createVNode(\"div\", {\n          \"class\": bem(\"error\")\n        }, [renderIcon(props.errorIcon, bem(\"error-icon\"), slots.error)]);\n      }\n    };\n    const renderImage = () => {\n      if (error.value || !props.src) {\n        return;\n      }\n      const attrs = {\n        alt: props.alt,\n        class: bem(\"img\"),\n        style: {\n          objectFit: props.fit,\n          objectPosition: props.position\n        }\n      };\n      if (props.lazyLoad) {\n        return _withDirectives(_createVNode(\"img\", _mergeProps({\n          \"ref\": imageRef\n        }, attrs), null), [[_resolveDirective(\"lazy\"), props.src]]);\n      }\n      return _createVNode(\"img\", _mergeProps({\n        \"src\": props.src,\n        \"onLoad\": onLoad,\n        \"onError\": onError\n      }, attrs), null);\n    };\n    const onLazyLoaded = ({\n      el\n    }) => {\n      const check = () => {\n        if (el === imageRef.value && loading.value) {\n          onLoad();\n        }\n      };\n      if (imageRef.value) {\n        check();\n      } else {\n        nextTick(check);\n      }\n    };\n    const onLazyLoadError = ({\n      el\n    }) => {\n      if (el === imageRef.value && !error.value) {\n        onError();\n      }\n    };\n    if ($Lazyload && inBrowser) {\n      $Lazyload.$on(\"loaded\", onLazyLoaded);\n      $Lazyload.$on(\"error\", onLazyLoadError);\n      onBeforeUnmount(() => {\n        $Lazyload.$off(\"loaded\", onLazyLoaded);\n        $Lazyload.$off(\"error\", onLazyLoadError);\n      });\n    }\n    return () => {\n      var _a;\n      return _createVNode(\"div\", {\n        \"class\": bem({\n          round: props.round\n        }),\n        \"style\": style.value\n      }, [renderImage(), renderPlaceholder(), (_a = slots.default) == null ? void 0 : _a.call(slots)]);\n    };\n  }\n});\nexport {\n  stdin_default as default\n};\n"]},"metadata":{},"sourceType":"module"}