{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode } from \"vue\";\nimport { computed, defineComponent, onMounted, onUnmounted, reactive, ref, watch } from 'vue';\nimport RotateLeftOutlined from '@ant-design/icons-vue/RotateLeftOutlined';\nimport RotateRightOutlined from '@ant-design/icons-vue/RotateRightOutlined';\nimport ZoomInOutlined from '@ant-design/icons-vue/ZoomInOutlined';\nimport ZoomOutOutlined from '@ant-design/icons-vue/ZoomOutOutlined';\nimport CloseOutlined from '@ant-design/icons-vue/CloseOutlined';\nimport LeftOutlined from '@ant-design/icons-vue/LeftOutlined';\nimport RightOutlined from '@ant-design/icons-vue/RightOutlined';\nimport classnames from '../../_util/classNames';\nimport PropTypes from '../../_util/vue-types';\nimport Dialog from '../../vc-dialog';\nimport getIDialogPropTypes from '../../vc-dialog/IDialogPropTypes';\nimport { getOffset } from '../../vc-util/Dom/css';\nimport addEventListener from '../../vc-util/Dom/addEventListener';\nimport { warning } from '../../vc-util/warning';\nimport useFrameSetState from './hooks/useFrameSetState';\nimport getFixScaleEleTransPosition from './getFixScaleEleTransPosition';\nimport { context } from './PreviewGroup';\nvar IDialogPropTypes = getIDialogPropTypes();\nvar initialPosition = {\n  x: 0,\n  y: 0\n};\n\nvar PreviewType = _extends({\n  src: PropTypes.string,\n  alt: PropTypes.string\n}, IDialogPropTypes);\n\nvar Preview = defineComponent({\n  name: 'Preview',\n  inheritAttrs: false,\n  props: PreviewType,\n  emits: ['close', 'afterClose'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit,\n        attrs = _ref.attrs;\n    var scale = ref(1);\n    var rotate = ref(0);\n\n    var _useFrameSetState = useFrameSetState(initialPosition),\n        _useFrameSetState2 = _slicedToArray(_useFrameSetState, 2),\n        position = _useFrameSetState2[0],\n        setPosition = _useFrameSetState2[1];\n\n    var onClose = function onClose() {\n      return emit('close');\n    };\n\n    var imgRef = ref();\n    var originPositionRef = reactive({\n      originX: 0,\n      originY: 0,\n      deltaX: 0,\n      deltaY: 0\n    });\n    var isMoving = ref(false);\n    var groupContext = context.inject();\n    var previewUrls = groupContext.previewUrls,\n        current = groupContext.current,\n        isPreviewGroup = groupContext.isPreviewGroup,\n        setCurrent = groupContext.setCurrent;\n    var previewGroupCount = computed(function () {\n      return Object.keys(previewUrls).length;\n    });\n    var previewUrlsKeys = computed(function () {\n      return Object.keys(previewUrls);\n    });\n    var currentPreviewIndex = computed(function () {\n      return previewUrlsKeys.value.indexOf(String(current.value));\n    });\n    var combinationSrc = computed(function () {\n      return isPreviewGroup.value ? previewUrls[current.value] : props.src;\n    });\n    var showLeftOrRightSwitches = computed(function () {\n      return isPreviewGroup.value && previewGroupCount.value > 1;\n    });\n\n    var onAfterClose = function onAfterClose() {\n      scale.value = 1;\n      rotate.value = 0;\n      setPosition(initialPosition);\n    };\n\n    var onZoomIn = function onZoomIn() {\n      scale.value++;\n      setPosition(initialPosition);\n    };\n\n    var onZoomOut = function onZoomOut() {\n      if (scale.value > 1) {\n        scale.value--;\n      }\n\n      setPosition(initialPosition);\n    };\n\n    var onRotateRight = function onRotateRight() {\n      rotate.value += 90;\n    };\n\n    var onRotateLeft = function onRotateLeft() {\n      rotate.value -= 90;\n    };\n\n    var onSwitchLeft = function onSwitchLeft(event) {\n      event.preventDefault(); // Without this mask close will abnormal\n\n      event.stopPropagation();\n\n      if (currentPreviewIndex.value > 0) {\n        setCurrent(previewUrlsKeys.value[String(currentPreviewIndex.value - 1)]);\n      }\n    };\n\n    var onSwitchRight = function onSwitchRight(event) {\n      event.preventDefault(); // Without this mask close will abnormal\n\n      event.stopPropagation();\n\n      if (currentPreviewIndex.value < previewGroupCount.value - 1) {\n        setCurrent(previewUrlsKeys.value[String(currentPreviewIndex.value + 1)]);\n      }\n    };\n\n    var wrapClassName = classnames(_defineProperty({}, \"\".concat(props.prefixCls, \"-moving\"), isMoving.value));\n    var toolClassName = \"\".concat(props.prefixCls, \"-operations-operation\");\n    var iconClassName = \"\".concat(props.prefixCls, \"-operations-icon\");\n    var tools = [{\n      icon: CloseOutlined,\n      onClick: onClose,\n      type: 'close'\n    }, {\n      icon: ZoomInOutlined,\n      onClick: onZoomIn,\n      type: 'zoomIn'\n    }, {\n      icon: ZoomOutOutlined,\n      onClick: onZoomOut,\n      type: 'zoomOut',\n      disabled: computed(function () {\n        return scale.value === 1;\n      })\n    }, {\n      icon: RotateRightOutlined,\n      onClick: onRotateRight,\n      type: 'rotateRight'\n    }, {\n      icon: RotateLeftOutlined,\n      onClick: onRotateLeft,\n      type: 'rotateLeft'\n    }];\n\n    var onMouseUp = function onMouseUp() {\n      if (props.visible && isMoving.value) {\n        var width = imgRef.value.offsetWidth * scale.value;\n        var height = imgRef.value.offsetHeight * scale.value;\n\n        var _getOffset = getOffset(imgRef.value),\n            left = _getOffset.left,\n            top = _getOffset.top;\n\n        var isRotate = rotate.value % 180 !== 0;\n        isMoving.value = false;\n        var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n\n        if (fixState) {\n          setPosition(_extends({}, fixState));\n        }\n      }\n    };\n\n    var onMouseDown = function onMouseDown(event) {\n      event.preventDefault(); // Without this mask close will abnormal\n\n      event.stopPropagation();\n      originPositionRef.deltaX = event.pageX - position.x;\n      originPositionRef.deltaY = event.pageY - position.y;\n      originPositionRef.originX = position.x;\n      originPositionRef.originY = position.y;\n      isMoving.value = true;\n    };\n\n    var onMouseMove = function onMouseMove(event) {\n      if (props.visible && isMoving.value) {\n        setPosition({\n          x: event.pageX - originPositionRef.deltaX,\n          y: event.pageY - originPositionRef.deltaY\n        });\n      }\n    };\n\n    var removeListeners = function removeListeners() {};\n\n    onMounted(function () {\n      watch([function () {\n        return props.visible;\n      }, isMoving], function () {\n        removeListeners();\n        var onTopMouseUpListener;\n        var onTopMouseMoveListener;\n        var onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n        var onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n\n        try {\n          // Resolve if in iframe lost event\n\n          /* istanbul ignore next */\n          if (window.top !== window.self) {\n            onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n            onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n          }\n        } catch (error) {\n          /* istanbul ignore next */\n          warning(false, \"[vc-image] \".concat(error));\n        }\n\n        removeListeners = function removeListeners() {\n          onMouseUpListener.remove();\n          onMouseMoveListener.remove();\n          /* istanbul ignore next */\n\n          if (onTopMouseUpListener) onTopMouseUpListener.remove();\n          /* istanbul ignore next */\n\n          if (onTopMouseMoveListener) onTopMouseMoveListener.remove();\n        };\n      }, {\n        flush: 'post',\n        immediate: true\n      });\n    });\n    onUnmounted(function () {\n      removeListeners();\n    });\n    return function () {\n      return _createVNode(Dialog, _objectSpread(_objectSpread({}, attrs), {}, {\n        \"transitionName\": \"zoom\",\n        \"maskTransitionName\": \"fade\",\n        \"closable\": false,\n        \"keyboard\": true,\n        \"prefixCls\": props.prefixCls,\n        \"onClose\": onClose,\n        \"afterClose\": onAfterClose,\n        \"visible\": props.visible,\n        \"wrapClassName\": wrapClassName,\n        \"getContainer\": props.getContainer\n      }), {\n        default: function _default() {\n          return [_createVNode(\"ul\", {\n            \"class\": \"\".concat(props.prefixCls, \"-operations\")\n          }, [tools.map(function (_ref2) {\n            var IconType = _ref2.icon,\n                onClick = _ref2.onClick,\n                type = _ref2.type,\n                disabled = _ref2.disabled;\n            return _createVNode(\"li\", {\n              \"class\": classnames(toolClassName, _defineProperty({}, \"\".concat(props.prefixCls, \"-operations-operation-disabled\"), disabled && (disabled === null || disabled === void 0 ? void 0 : disabled.value))),\n              \"onClick\": onClick,\n              \"key\": type\n            }, [_createVNode(IconType, {\n              \"class\": iconClassName\n            }, null)]);\n          })]), _createVNode(\"div\", {\n            \"class\": \"\".concat(props.prefixCls, \"-img-wrapper\"),\n            \"style\": {\n              transform: \"translate3d(\".concat(position.x, \"px, \").concat(position.y, \"px, 0)\")\n            }\n          }, [_createVNode(\"img\", {\n            \"onMousedown\": onMouseDown,\n            \"ref\": imgRef,\n            \"class\": \"\".concat(props.prefixCls, \"-img\"),\n            \"src\": combinationSrc.value,\n            \"alt\": props.alt,\n            \"style\": {\n              transform: \"scale3d(\".concat(scale.value, \", \").concat(scale.value, \", 1) rotate(\").concat(rotate.value, \"deg)\")\n            }\n          }, null)]), showLeftOrRightSwitches.value && _createVNode(\"div\", {\n            \"class\": classnames(\"\".concat(props.prefixCls, \"-switch-left\"), _defineProperty({}, \"\".concat(props.prefixCls, \"-switch-left-disabled\"), currentPreviewIndex.value <= 0)),\n            \"onClick\": onSwitchLeft\n          }, [_createVNode(LeftOutlined, null, null)]), showLeftOrRightSwitches.value && _createVNode(\"div\", {\n            \"class\": classnames(\"\".concat(props.prefixCls, \"-switch-right\"), _defineProperty({}, \"\".concat(props.prefixCls, \"-switch-right-disabled\"), currentPreviewIndex.value >= previewGroupCount.value - 1)),\n            \"onClick\": onSwitchRight\n          }, [_createVNode(RightOutlined, null, null)])];\n        }\n      });\n    };\n  }\n});\nexport default Preview;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/ant-design-vue/es/vc-image/src/Preview.js"],"names":["_objectSpread","_defineProperty","_slicedToArray","_extends","createVNode","_createVNode","computed","defineComponent","onMounted","onUnmounted","reactive","ref","watch","RotateLeftOutlined","RotateRightOutlined","ZoomInOutlined","ZoomOutOutlined","CloseOutlined","LeftOutlined","RightOutlined","classnames","PropTypes","Dialog","getIDialogPropTypes","getOffset","addEventListener","warning","useFrameSetState","getFixScaleEleTransPosition","context","IDialogPropTypes","initialPosition","x","y","PreviewType","src","string","alt","Preview","name","inheritAttrs","props","emits","setup","_ref","emit","attrs","scale","rotate","_useFrameSetState","_useFrameSetState2","position","setPosition","onClose","imgRef","originPositionRef","originX","originY","deltaX","deltaY","isMoving","groupContext","inject","previewUrls","current","isPreviewGroup","setCurrent","previewGroupCount","Object","keys","length","previewUrlsKeys","currentPreviewIndex","value","indexOf","String","combinationSrc","showLeftOrRightSwitches","onAfterClose","onZoomIn","onZoomOut","onRotateRight","onRotateLeft","onSwitchLeft","event","preventDefault","stopPropagation","onSwitchRight","wrapClassName","concat","prefixCls","toolClassName","iconClassName","tools","icon","onClick","type","disabled","onMouseUp","visible","width","offsetWidth","height","offsetHeight","_getOffset","left","top","isRotate","fixState","onMouseDown","pageX","pageY","onMouseMove","removeListeners","onTopMouseUpListener","onTopMouseMoveListener","onMouseUpListener","window","onMouseMoveListener","self","error","remove","flush","immediate","getContainer","default","_default","map","_ref2","IconType","transform"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode } from \"vue\";\nimport { computed, defineComponent, onMounted, onUnmounted, reactive, ref, watch } from 'vue';\nimport RotateLeftOutlined from '@ant-design/icons-vue/RotateLeftOutlined';\nimport RotateRightOutlined from '@ant-design/icons-vue/RotateRightOutlined';\nimport ZoomInOutlined from '@ant-design/icons-vue/ZoomInOutlined';\nimport ZoomOutOutlined from '@ant-design/icons-vue/ZoomOutOutlined';\nimport CloseOutlined from '@ant-design/icons-vue/CloseOutlined';\nimport LeftOutlined from '@ant-design/icons-vue/LeftOutlined';\nimport RightOutlined from '@ant-design/icons-vue/RightOutlined';\nimport classnames from '../../_util/classNames';\nimport PropTypes from '../../_util/vue-types';\nimport Dialog from '../../vc-dialog';\nimport getIDialogPropTypes from '../../vc-dialog/IDialogPropTypes';\nimport { getOffset } from '../../vc-util/Dom/css';\nimport addEventListener from '../../vc-util/Dom/addEventListener';\nimport { warning } from '../../vc-util/warning';\nimport useFrameSetState from './hooks/useFrameSetState';\nimport getFixScaleEleTransPosition from './getFixScaleEleTransPosition';\nimport { context } from './PreviewGroup';\nvar IDialogPropTypes = getIDialogPropTypes();\nvar initialPosition = {\n  x: 0,\n  y: 0\n};\n\nvar PreviewType = _extends({\n  src: PropTypes.string,\n  alt: PropTypes.string\n}, IDialogPropTypes);\n\nvar Preview = defineComponent({\n  name: 'Preview',\n  inheritAttrs: false,\n  props: PreviewType,\n  emits: ['close', 'afterClose'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit,\n        attrs = _ref.attrs;\n    var scale = ref(1);\n    var rotate = ref(0);\n\n    var _useFrameSetState = useFrameSetState(initialPosition),\n        _useFrameSetState2 = _slicedToArray(_useFrameSetState, 2),\n        position = _useFrameSetState2[0],\n        setPosition = _useFrameSetState2[1];\n\n    var onClose = function onClose() {\n      return emit('close');\n    };\n\n    var imgRef = ref();\n    var originPositionRef = reactive({\n      originX: 0,\n      originY: 0,\n      deltaX: 0,\n      deltaY: 0\n    });\n    var isMoving = ref(false);\n    var groupContext = context.inject();\n    var previewUrls = groupContext.previewUrls,\n        current = groupContext.current,\n        isPreviewGroup = groupContext.isPreviewGroup,\n        setCurrent = groupContext.setCurrent;\n    var previewGroupCount = computed(function () {\n      return Object.keys(previewUrls).length;\n    });\n    var previewUrlsKeys = computed(function () {\n      return Object.keys(previewUrls);\n    });\n    var currentPreviewIndex = computed(function () {\n      return previewUrlsKeys.value.indexOf(String(current.value));\n    });\n    var combinationSrc = computed(function () {\n      return isPreviewGroup.value ? previewUrls[current.value] : props.src;\n    });\n    var showLeftOrRightSwitches = computed(function () {\n      return isPreviewGroup.value && previewGroupCount.value > 1;\n    });\n\n    var onAfterClose = function onAfterClose() {\n      scale.value = 1;\n      rotate.value = 0;\n      setPosition(initialPosition);\n    };\n\n    var onZoomIn = function onZoomIn() {\n      scale.value++;\n      setPosition(initialPosition);\n    };\n\n    var onZoomOut = function onZoomOut() {\n      if (scale.value > 1) {\n        scale.value--;\n      }\n\n      setPosition(initialPosition);\n    };\n\n    var onRotateRight = function onRotateRight() {\n      rotate.value += 90;\n    };\n\n    var onRotateLeft = function onRotateLeft() {\n      rotate.value -= 90;\n    };\n\n    var onSwitchLeft = function onSwitchLeft(event) {\n      event.preventDefault(); // Without this mask close will abnormal\n\n      event.stopPropagation();\n\n      if (currentPreviewIndex.value > 0) {\n        setCurrent(previewUrlsKeys.value[String(currentPreviewIndex.value - 1)]);\n      }\n    };\n\n    var onSwitchRight = function onSwitchRight(event) {\n      event.preventDefault(); // Without this mask close will abnormal\n\n      event.stopPropagation();\n\n      if (currentPreviewIndex.value < previewGroupCount.value - 1) {\n        setCurrent(previewUrlsKeys.value[String(currentPreviewIndex.value + 1)]);\n      }\n    };\n\n    var wrapClassName = classnames(_defineProperty({}, \"\".concat(props.prefixCls, \"-moving\"), isMoving.value));\n    var toolClassName = \"\".concat(props.prefixCls, \"-operations-operation\");\n    var iconClassName = \"\".concat(props.prefixCls, \"-operations-icon\");\n    var tools = [{\n      icon: CloseOutlined,\n      onClick: onClose,\n      type: 'close'\n    }, {\n      icon: ZoomInOutlined,\n      onClick: onZoomIn,\n      type: 'zoomIn'\n    }, {\n      icon: ZoomOutOutlined,\n      onClick: onZoomOut,\n      type: 'zoomOut',\n      disabled: computed(function () {\n        return scale.value === 1;\n      })\n    }, {\n      icon: RotateRightOutlined,\n      onClick: onRotateRight,\n      type: 'rotateRight'\n    }, {\n      icon: RotateLeftOutlined,\n      onClick: onRotateLeft,\n      type: 'rotateLeft'\n    }];\n\n    var onMouseUp = function onMouseUp() {\n      if (props.visible && isMoving.value) {\n        var width = imgRef.value.offsetWidth * scale.value;\n        var height = imgRef.value.offsetHeight * scale.value;\n\n        var _getOffset = getOffset(imgRef.value),\n            left = _getOffset.left,\n            top = _getOffset.top;\n\n        var isRotate = rotate.value % 180 !== 0;\n        isMoving.value = false;\n        var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n\n        if (fixState) {\n          setPosition(_extends({}, fixState));\n        }\n      }\n    };\n\n    var onMouseDown = function onMouseDown(event) {\n      event.preventDefault(); // Without this mask close will abnormal\n\n      event.stopPropagation();\n      originPositionRef.deltaX = event.pageX - position.x;\n      originPositionRef.deltaY = event.pageY - position.y;\n      originPositionRef.originX = position.x;\n      originPositionRef.originY = position.y;\n      isMoving.value = true;\n    };\n\n    var onMouseMove = function onMouseMove(event) {\n      if (props.visible && isMoving.value) {\n        setPosition({\n          x: event.pageX - originPositionRef.deltaX,\n          y: event.pageY - originPositionRef.deltaY\n        });\n      }\n    };\n\n    var removeListeners = function removeListeners() {};\n\n    onMounted(function () {\n      watch([function () {\n        return props.visible;\n      }, isMoving], function () {\n        removeListeners();\n        var onTopMouseUpListener;\n        var onTopMouseMoveListener;\n        var onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n        var onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n\n        try {\n          // Resolve if in iframe lost event\n\n          /* istanbul ignore next */\n          if (window.top !== window.self) {\n            onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n            onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n          }\n        } catch (error) {\n          /* istanbul ignore next */\n          warning(false, \"[vc-image] \".concat(error));\n        }\n\n        removeListeners = function removeListeners() {\n          onMouseUpListener.remove();\n          onMouseMoveListener.remove();\n          /* istanbul ignore next */\n\n          if (onTopMouseUpListener) onTopMouseUpListener.remove();\n          /* istanbul ignore next */\n\n          if (onTopMouseMoveListener) onTopMouseMoveListener.remove();\n        };\n      }, {\n        flush: 'post',\n        immediate: true\n      });\n    });\n    onUnmounted(function () {\n      removeListeners();\n    });\n    return function () {\n      return _createVNode(Dialog, _objectSpread(_objectSpread({}, attrs), {}, {\n        \"transitionName\": \"zoom\",\n        \"maskTransitionName\": \"fade\",\n        \"closable\": false,\n        \"keyboard\": true,\n        \"prefixCls\": props.prefixCls,\n        \"onClose\": onClose,\n        \"afterClose\": onAfterClose,\n        \"visible\": props.visible,\n        \"wrapClassName\": wrapClassName,\n        \"getContainer\": props.getContainer\n      }), {\n        default: function _default() {\n          return [_createVNode(\"ul\", {\n            \"class\": \"\".concat(props.prefixCls, \"-operations\")\n          }, [tools.map(function (_ref2) {\n            var IconType = _ref2.icon,\n                onClick = _ref2.onClick,\n                type = _ref2.type,\n                disabled = _ref2.disabled;\n            return _createVNode(\"li\", {\n              \"class\": classnames(toolClassName, _defineProperty({}, \"\".concat(props.prefixCls, \"-operations-operation-disabled\"), disabled && (disabled === null || disabled === void 0 ? void 0 : disabled.value))),\n              \"onClick\": onClick,\n              \"key\": type\n            }, [_createVNode(IconType, {\n              \"class\": iconClassName\n            }, null)]);\n          })]), _createVNode(\"div\", {\n            \"class\": \"\".concat(props.prefixCls, \"-img-wrapper\"),\n            \"style\": {\n              transform: \"translate3d(\".concat(position.x, \"px, \").concat(position.y, \"px, 0)\")\n            }\n          }, [_createVNode(\"img\", {\n            \"onMousedown\": onMouseDown,\n            \"ref\": imgRef,\n            \"class\": \"\".concat(props.prefixCls, \"-img\"),\n            \"src\": combinationSrc.value,\n            \"alt\": props.alt,\n            \"style\": {\n              transform: \"scale3d(\".concat(scale.value, \", \").concat(scale.value, \", 1) rotate(\").concat(rotate.value, \"deg)\")\n            }\n          }, null)]), showLeftOrRightSwitches.value && _createVNode(\"div\", {\n            \"class\": classnames(\"\".concat(props.prefixCls, \"-switch-left\"), _defineProperty({}, \"\".concat(props.prefixCls, \"-switch-left-disabled\"), currentPreviewIndex.value <= 0)),\n            \"onClick\": onSwitchLeft\n          }, [_createVNode(LeftOutlined, null, null)]), showLeftOrRightSwitches.value && _createVNode(\"div\", {\n            \"class\": classnames(\"\".concat(props.prefixCls, \"-switch-right\"), _defineProperty({}, \"\".concat(props.prefixCls, \"-switch-right-disabled\"), currentPreviewIndex.value >= previewGroupCount.value - 1)),\n            \"onClick\": onSwitchRight\n          }, [_createVNode(RightOutlined, null, null)])];\n        }\n      });\n    };\n  }\n});\nexport default Preview;"]},"metadata":{},"sourceType":"module"}