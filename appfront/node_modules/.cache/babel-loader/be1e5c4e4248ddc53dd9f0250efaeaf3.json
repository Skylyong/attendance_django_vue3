{"ast":null,"code":"var staticParseInt = require('./staticParseInt');\n\nvar helperGetHGSKeys = require('./helperGetHGSKeys');\n\nvar hasOwnProp = require('./hasOwnProp');\n\nvar sKeyRE = /(.+)?\\[(\\d+)\\]$/;\n\nfunction setDeepProps(obj, key, isEnd, nextKey, value) {\n  if (obj[key]) {\n    if (isEnd) {\n      obj[key] = value;\n    }\n  } else {\n    var index;\n    var rest;\n    var currMatchs = key ? key.match(sKeyRE) : null;\n\n    if (isEnd) {\n      rest = value;\n    } else {\n      var nextMatchs = nextKey ? nextKey.match(sKeyRE) : null;\n\n      if (nextMatchs && !nextMatchs[1]) {\n        // 如果下一个属性为数组类型\n        rest = new Array(staticParseInt(nextMatchs[2]) + 1);\n      } else {\n        rest = {};\n      }\n    }\n\n    if (currMatchs) {\n      if (currMatchs[1]) {\n        // 如果为对象中数组\n        index = staticParseInt(currMatchs[2]);\n\n        if (obj[currMatchs[1]]) {\n          if (isEnd) {\n            obj[currMatchs[1]][index] = rest;\n          } else {\n            if (obj[currMatchs[1]][index]) {\n              rest = obj[currMatchs[1]][index];\n            } else {\n              obj[currMatchs[1]][index] = rest;\n            }\n          }\n        } else {\n          obj[currMatchs[1]] = new Array(index + 1);\n          obj[currMatchs[1]][index] = rest;\n        }\n      } else {\n        // 如果为数组\n        obj[currMatchs[2]] = rest;\n      }\n    } else {\n      // 如果为对象\n      obj[key] = rest;\n    }\n\n    return rest;\n  }\n\n  return obj[key];\n}\n/**\r\n * 设置对象属性上的值。如果属性不存在则创建它\r\n * @param {Object/Array} obj 对象\r\n * @param {String/Function} property 键、路径\r\n * @param {Object} value 值\r\n */\n\n\nfunction set(obj, property, value) {\n  if (obj) {\n    if ((obj[property] || hasOwnProp(obj, property)) && !isPrototypePolluted(property)) {\n      obj[property] = value;\n    } else {\n      var rest = obj;\n      var props = helperGetHGSKeys(property);\n      var len = props.length;\n\n      for (var index = 0; index < len; index++) {\n        if (isPrototypePolluted(props[index])) {\n          continue;\n        }\n\n        var isEnd = index === len - 1;\n        rest = setDeepProps(rest, props[index], isEnd, isEnd ? null : props[index + 1], value);\n      }\n    }\n  }\n\n  return obj;\n}\n/**\r\n * Blacklist certain keys to prevent Prototype Pollution\r\n * @param {string} key\r\n */\n\n\nfunction isPrototypePolluted(key) {\n  return key === '__proto__' || key === 'constructor' || key === 'prototype';\n}\n\nmodule.exports = set;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/appfront/node_modules/xe-utils/set.js"],"names":["staticParseInt","require","helperGetHGSKeys","hasOwnProp","sKeyRE","setDeepProps","obj","key","isEnd","nextKey","value","index","rest","currMatchs","match","nextMatchs","Array","set","property","isPrototypePolluted","props","len","length","module","exports"],"mappings":"AAAA,IAAIA,cAAc,GAAGC,OAAO,CAAC,kBAAD,CAA5B;;AAEA,IAAIC,gBAAgB,GAAGD,OAAO,CAAC,oBAAD,CAA9B;;AAEA,IAAIE,UAAU,GAAGF,OAAO,CAAC,cAAD,CAAxB;;AAEA,IAAIG,MAAM,GAAG,iBAAb;;AAEA,SAASC,YAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiCC,KAAjC,EAAwCC,OAAxC,EAAiDC,KAAjD,EAAwD;AACtD,MAAIJ,GAAG,CAACC,GAAD,CAAP,EAAc;AACZ,QAAIC,KAAJ,EAAW;AACTF,MAAAA,GAAG,CAACC,GAAD,CAAH,GAAWG,KAAX;AACD;AACF,GAJD,MAIO;AACL,QAAIC,KAAJ;AACA,QAAIC,IAAJ;AACA,QAAIC,UAAU,GAAGN,GAAG,GAAGA,GAAG,CAACO,KAAJ,CAAUV,MAAV,CAAH,GAAuB,IAA3C;;AACA,QAAII,KAAJ,EAAW;AACTI,MAAAA,IAAI,GAAGF,KAAP;AACD,KAFD,MAEO;AACL,UAAIK,UAAU,GAAGN,OAAO,GAAGA,OAAO,CAACK,KAAR,CAAcV,MAAd,CAAH,GAA2B,IAAnD;;AACA,UAAIW,UAAU,IAAI,CAACA,UAAU,CAAC,CAAD,CAA7B,EAAkC;AAChC;AACAH,QAAAA,IAAI,GAAG,IAAII,KAAJ,CAAUhB,cAAc,CAACe,UAAU,CAAC,CAAD,CAAX,CAAd,GAAgC,CAA1C,CAAP;AACD,OAHD,MAGO;AACLH,QAAAA,IAAI,GAAG,EAAP;AACD;AACF;;AACD,QAAIC,UAAJ,EAAgB;AACd,UAAIA,UAAU,CAAC,CAAD,CAAd,EAAmB;AACjB;AACAF,QAAAA,KAAK,GAAGX,cAAc,CAACa,UAAU,CAAC,CAAD,CAAX,CAAtB;;AACA,YAAIP,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAP,EAAwB;AACtB,cAAIL,KAAJ,EAAW;AACTF,YAAAA,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,CAAmBF,KAAnB,IAA4BC,IAA5B;AACD,WAFD,MAEO;AACL,gBAAIN,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,CAAmBF,KAAnB,CAAJ,EAA+B;AAC7BC,cAAAA,IAAI,GAAGN,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,CAAmBF,KAAnB,CAAP;AACD,aAFD,MAEO;AACLL,cAAAA,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,CAAmBF,KAAnB,IAA4BC,IAA5B;AACD;AACF;AACF,SAVD,MAUO;AACLN,UAAAA,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,GAAqB,IAAIG,KAAJ,CAAUL,KAAK,GAAG,CAAlB,CAArB;AACAL,UAAAA,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,CAAmBF,KAAnB,IAA4BC,IAA5B;AACD;AACF,OAjBD,MAiBO;AACL;AACAN,QAAAA,GAAG,CAACO,UAAU,CAAC,CAAD,CAAX,CAAH,GAAqBD,IAArB;AACD;AACF,KAtBD,MAsBO;AACL;AACAN,MAAAA,GAAG,CAACC,GAAD,CAAH,GAAWK,IAAX;AACD;;AACD,WAAOA,IAAP;AACD;;AACD,SAAON,GAAG,CAACC,GAAD,CAAV;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASU,GAAT,CAAcX,GAAd,EAAmBY,QAAnB,EAA6BR,KAA7B,EAAoC;AAClC,MAAIJ,GAAJ,EAAS;AACP,QAAI,CAACA,GAAG,CAACY,QAAD,CAAH,IAAiBf,UAAU,CAACG,GAAD,EAAMY,QAAN,CAA5B,KAAgD,CAACC,mBAAmB,CAACD,QAAD,CAAxE,EAAoF;AAClFZ,MAAAA,GAAG,CAACY,QAAD,CAAH,GAAgBR,KAAhB;AACD,KAFD,MAEO;AACL,UAAIE,IAAI,GAAGN,GAAX;AACA,UAAIc,KAAK,GAAGlB,gBAAgB,CAACgB,QAAD,CAA5B;AACA,UAAIG,GAAG,GAAGD,KAAK,CAACE,MAAhB;;AACA,WAAK,IAAIX,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGU,GAA5B,EAAiCV,KAAK,EAAtC,EAA0C;AACxC,YAAIQ,mBAAmB,CAACC,KAAK,CAACT,KAAD,CAAN,CAAvB,EAAuC;AACrC;AACD;;AACD,YAAIH,KAAK,GAAGG,KAAK,KAAKU,GAAG,GAAG,CAA5B;AACAT,QAAAA,IAAI,GAAGP,YAAY,CAACO,IAAD,EAAOQ,KAAK,CAACT,KAAD,CAAZ,EAAqBH,KAArB,EAA4BA,KAAK,GAAG,IAAH,GAAUY,KAAK,CAACT,KAAK,GAAG,CAAT,CAAhD,EAA6DD,KAA7D,CAAnB;AACD;AACF;AACF;;AACD,SAAOJ,GAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASa,mBAAT,CAA6BZ,GAA7B,EAAkC;AAChC,SAAOA,GAAG,KAAK,WAAR,IAAuBA,GAAG,KAAK,aAA/B,IAAgDA,GAAG,KAAK,WAA/D;AACD;;AAEDgB,MAAM,CAACC,OAAP,GAAiBP,GAAjB","sourcesContent":["var staticParseInt = require('./staticParseInt')\r\n\r\nvar helperGetHGSKeys = require('./helperGetHGSKeys')\r\n\r\nvar hasOwnProp = require('./hasOwnProp')\r\n\r\nvar sKeyRE = /(.+)?\\[(\\d+)\\]$/\r\n\r\nfunction setDeepProps (obj, key, isEnd, nextKey, value) {\r\n  if (obj[key]) {\r\n    if (isEnd) {\r\n      obj[key] = value\r\n    }\r\n  } else {\r\n    var index\r\n    var rest\r\n    var currMatchs = key ? key.match(sKeyRE) : null\r\n    if (isEnd) {\r\n      rest = value\r\n    } else {\r\n      var nextMatchs = nextKey ? nextKey.match(sKeyRE) : null\r\n      if (nextMatchs && !nextMatchs[1]) {\r\n        // 如果下一个属性为数组类型\r\n        rest = new Array(staticParseInt(nextMatchs[2]) + 1)\r\n      } else {\r\n        rest = {}\r\n      }\r\n    }\r\n    if (currMatchs) {\r\n      if (currMatchs[1]) {\r\n        // 如果为对象中数组\r\n        index = staticParseInt(currMatchs[2])\r\n        if (obj[currMatchs[1]]) {\r\n          if (isEnd) {\r\n            obj[currMatchs[1]][index] = rest\r\n          } else {\r\n            if (obj[currMatchs[1]][index]) {\r\n              rest = obj[currMatchs[1]][index]\r\n            } else {\r\n              obj[currMatchs[1]][index] = rest\r\n            }\r\n          }\r\n        } else {\r\n          obj[currMatchs[1]] = new Array(index + 1)\r\n          obj[currMatchs[1]][index] = rest\r\n        }\r\n      } else {\r\n        // 如果为数组\r\n        obj[currMatchs[2]] = rest\r\n      }\r\n    } else {\r\n      // 如果为对象\r\n      obj[key] = rest\r\n    }\r\n    return rest\r\n  }\r\n  return obj[key]\r\n}\r\n\r\n/**\r\n * 设置对象属性上的值。如果属性不存在则创建它\r\n * @param {Object/Array} obj 对象\r\n * @param {String/Function} property 键、路径\r\n * @param {Object} value 值\r\n */\r\nfunction set (obj, property, value) {\r\n  if (obj) {\r\n    if ((obj[property] || hasOwnProp(obj, property)) && !isPrototypePolluted(property)) {\r\n      obj[property] = value\r\n    } else {\r\n      var rest = obj\r\n      var props = helperGetHGSKeys(property)\r\n      var len = props.length\r\n      for (var index = 0; index < len; index++) {\r\n        if (isPrototypePolluted(props[index])) {\r\n          continue\r\n        }\r\n        var isEnd = index === len - 1\r\n        rest = setDeepProps(rest, props[index], isEnd, isEnd ? null : props[index + 1], value)\r\n      }\r\n    }\r\n  }\r\n  return obj\r\n}\r\n\r\n/**\r\n * Blacklist certain keys to prevent Prototype Pollution\r\n * @param {string} key\r\n */\r\nfunction isPrototypePolluted(key) {\r\n  return key === '__proto__' || key === 'constructor' || key === 'prototype'\r\n}\r\n\r\nmodule.exports = set\r\n"]},"metadata":{},"sourceType":"script"}