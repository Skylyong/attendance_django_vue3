{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode, Fragment as _Fragment } from \"vue\";\nimport { ref, watch, defineComponent, computed, onMounted } from 'vue';\nimport isNumber from 'lodash-es/isNumber';\nimport BaseMixin from '../../_util/BaseMixin';\nimport cn from '../../_util/classNames';\nimport PropTypes from '../../_util/vue-types';\nimport { getOffset } from '../../vc-util/Dom/css';\nimport Preview from './Preview';\nimport PreviewGroup, { context } from './PreviewGroup';\nexport var imageProps = {\n  src: PropTypes.string,\n  wrapperClassName: PropTypes.string,\n  wrapperStyle: PropTypes.style,\n  prefixCls: PropTypes.string,\n  previewPrefixCls: PropTypes.string,\n  placeholder: PropTypes.VNodeChild,\n  fallback: PropTypes.string,\n  preview: PropTypes.oneOfType([PropTypes.looseBool, PropTypes.shape({\n    visible: PropTypes.bool,\n    onVisibleChange: PropTypes.func,\n    getContainer: PropTypes.oneOfType([PropTypes.func, PropTypes.looseBool, PropTypes.string])\n  }).loose]).def(true)\n};\n\nvar mergeDefaultValue = function mergeDefaultValue(obj, defaultValues) {\n  var res = _extends({}, obj);\n\n  Object.keys(defaultValues).forEach(function (key) {\n    if (obj[key] === undefined) {\n      res[key] = defaultValues[key];\n    }\n  });\n  return res;\n};\n\nvar uuid = 0;\nvar ImageInternal = defineComponent({\n  name: 'Image',\n  mixins: [BaseMixin],\n  inheritAttrs: false,\n  props: imageProps,\n  emits: ['click'],\n  setup: function setup(props, _ref) {\n    var attrs = _ref.attrs,\n        slots = _ref.slots,\n        emit = _ref.emit;\n    var prefixCls = computed(function () {\n      return props.prefixCls;\n    });\n    var previewPrefixCls = computed(function () {\n      return \"\".concat(prefixCls.value, \"-preview\");\n    });\n    var preview = computed(function () {\n      var defaultValues = {\n        visible: undefined,\n        onVisibleChange: function onVisibleChange() {},\n        getContainer: undefined\n      };\n      return _typeof(props.preview) === 'object' ? mergeDefaultValue(props.preview, defaultValues) : defaultValues;\n    });\n    var isCustomPlaceholder = computed(function () {\n      return props.placeholder && props.placeholder !== true || slots.placeholder;\n    });\n    var previewVisible = computed(function () {\n      return preview.value.visible;\n    });\n    var onPreviewVisibleChange = computed(function () {\n      return preview.value.onVisibleChange;\n    });\n    var getPreviewContainer = computed(function () {\n      return preview.value.getContainer;\n    });\n    var isControlled = computed(function () {\n      return previewVisible.value !== undefined;\n    });\n    var isShowPreview = ref(!!previewVisible.value);\n    watch(previewVisible, function () {\n      isShowPreview.value = !!previewVisible.value;\n    });\n    watch(isShowPreview, function (val, preVal) {\n      onPreviewVisibleChange.value(val, preVal);\n    });\n    var status = ref(isCustomPlaceholder.value ? 'loading' : 'normal');\n    watch(function () {\n      return props.src;\n    }, function () {\n      status.value = isCustomPlaceholder.value ? 'loading' : 'normal';\n    });\n    var mousePosition = ref(null);\n    var isError = computed(function () {\n      return status.value === 'error';\n    });\n    var groupContext = context.inject();\n    var isPreviewGroup = groupContext.isPreviewGroup,\n        setCurrent = groupContext.setCurrent,\n        setGroupShowPreview = groupContext.setShowPreview,\n        setGroupMousePosition = groupContext.setMousePosition,\n        registerImage = groupContext.registerImage;\n    var currentId = ref(uuid++);\n    var canPreview = computed(function () {\n      return props.preview && !isError.value;\n    });\n\n    var onLoad = function onLoad() {\n      status.value = 'normal';\n    };\n\n    var onError = function onError() {\n      status.value = 'error';\n    };\n\n    var onPreview = function onPreview(e) {\n      if (!isControlled.value) {\n        var _getOffset = getOffset(e.target),\n            left = _getOffset.left,\n            top = _getOffset.top;\n\n        if (isPreviewGroup.value) {\n          setCurrent(currentId.value);\n          setGroupMousePosition({\n            x: left,\n            y: top\n          });\n        } else {\n          mousePosition.value = {\n            x: left,\n            y: top\n          };\n        }\n      }\n\n      if (isPreviewGroup.value) {\n        setGroupShowPreview(true);\n      } else {\n        isShowPreview.value = true;\n      }\n\n      emit('click', e);\n    };\n\n    var onPreviewClose = function onPreviewClose() {\n      isShowPreview.value = false;\n\n      if (!isControlled.value) {\n        mousePosition.value = null;\n      }\n    };\n\n    var img = ref(null);\n    watch(function () {\n      return img;\n    }, function () {\n      if (status.value !== 'loading') return;\n\n      if (img.value.complete && (img.value.naturalWidth || img.value.naturalHeight)) {\n        onLoad();\n      }\n    });\n\n    var unRegister = function unRegister() {};\n\n    onMounted(function () {\n      watch([function () {\n        return props.src;\n      }, canPreview], function () {\n        unRegister();\n\n        if (!isPreviewGroup.value) {\n          return function () {};\n        }\n\n        unRegister = registerImage(currentId.value, props.src);\n\n        if (!canPreview.value) {\n          unRegister();\n        }\n      }, {\n        flush: 'post',\n        immediate: true\n      });\n    });\n\n    var toSizePx = function toSizePx(l) {\n      if (isNumber(l)) return l + 'px';\n      return l;\n    };\n\n    return function () {\n      var prefixCls = props.prefixCls,\n          wrapperClassName = props.wrapperClassName,\n          fallback = props.fallback,\n          src = props.src,\n          preview = props.preview,\n          placeholder = props.placeholder,\n          wrapperStyle = props.wrapperStyle;\n      var width = attrs.width,\n          height = attrs.height,\n          crossorigin = attrs.crossorigin,\n          decoding = attrs.decoding,\n          alt = attrs.alt,\n          sizes = attrs.sizes,\n          srcset = attrs.srcset,\n          usemap = attrs.usemap,\n          cls = attrs.class,\n          style = attrs.style;\n      var wrappperClass = cn(prefixCls, wrapperClassName, _defineProperty({}, \"\".concat(prefixCls, \"-error\"), isError.value));\n      var mergedSrc = isError.value && fallback ? fallback : src;\n      var previewMask = slots.previewMask && slots.previewMask();\n      var imgCommonProps = {\n        crossorigin: crossorigin,\n        decoding: decoding,\n        alt: alt,\n        sizes: sizes,\n        srcset: srcset,\n        usemap: usemap,\n        class: cn(\"\".concat(prefixCls, \"-img\"), _defineProperty({}, \"\".concat(prefixCls, \"-img-placeholder\"), placeholder === true), cls),\n        style: _extends({\n          height: height\n        }, style)\n      };\n      return _createVNode(_Fragment, null, [_createVNode(\"div\", {\n        \"class\": wrappperClass,\n        \"onClick\": preview && !isError.value ? onPreview : function (e) {\n          emit('click', e);\n        },\n        \"style\": _extends({\n          width: toSizePx(width),\n          height: toSizePx(height)\n        }, wrapperStyle)\n      }, [_createVNode(\"img\", _objectSpread(_objectSpread(_objectSpread({}, imgCommonProps), isError.value && fallback ? {\n        src: fallback\n      } : {\n        onLoad: onLoad,\n        onError: onError,\n        src: src\n      }), {}, {\n        \"ref\": img\n      }), null), status.value === 'loading' && _createVNode(\"div\", {\n        \"aria-hidden\": \"true\",\n        \"class\": \"\".concat(prefixCls, \"-placeholder\")\n      }, [placeholder || slots.placeholder && slots.placeholder()]), previewMask && canPreview.value && _createVNode(\"div\", {\n        \"class\": \"\".concat(prefixCls, \"-mask\")\n      }, [previewMask])]), !isPreviewGroup.value && canPreview.value && _createVNode(Preview, {\n        \"aria-hidden\": !isShowPreview.value,\n        \"visible\": isShowPreview.value,\n        \"prefixCls\": previewPrefixCls.value,\n        \"onClose\": onPreviewClose,\n        \"mousePosition\": mousePosition.value,\n        \"src\": mergedSrc,\n        \"alt\": alt,\n        \"getContainer\": getPreviewContainer.value\n      }, null)]);\n    };\n  }\n});\nImageInternal.PreviewGroup = PreviewGroup;\nexport default ImageInternal;","map":{"version":3,"sources":["/Users/lyong/Desktop/myproj/node_modules/ant-design-vue/es/vc-image/src/Image.js"],"names":["_objectSpread","_defineProperty","_typeof","_extends","createVNode","_createVNode","Fragment","_Fragment","ref","watch","defineComponent","computed","onMounted","isNumber","BaseMixin","cn","PropTypes","getOffset","Preview","PreviewGroup","context","imageProps","src","string","wrapperClassName","wrapperStyle","style","prefixCls","previewPrefixCls","placeholder","VNodeChild","fallback","preview","oneOfType","looseBool","shape","visible","bool","onVisibleChange","func","getContainer","loose","def","mergeDefaultValue","obj","defaultValues","res","Object","keys","forEach","key","undefined","uuid","ImageInternal","name","mixins","inheritAttrs","props","emits","setup","_ref","attrs","slots","emit","concat","value","isCustomPlaceholder","previewVisible","onPreviewVisibleChange","getPreviewContainer","isControlled","isShowPreview","val","preVal","status","mousePosition","isError","groupContext","inject","isPreviewGroup","setCurrent","setGroupShowPreview","setShowPreview","setGroupMousePosition","setMousePosition","registerImage","currentId","canPreview","onLoad","onError","onPreview","e","_getOffset","target","left","top","x","y","onPreviewClose","img","complete","naturalWidth","naturalHeight","unRegister","flush","immediate","toSizePx","l","width","height","crossorigin","decoding","alt","sizes","srcset","usemap","cls","class","wrappperClass","mergedSrc","previewMask","imgCommonProps"],"mappings":"AAAA,OAAOA,aAAP,MAA0B,0CAA1B;AACA,OAAOC,eAAP,MAA4B,2CAA5B;AACA,OAAOC,OAAP,MAAoB,mCAApB;AACA,OAAOC,QAAP,MAAqB,oCAArB;AACA,SAASC,WAAW,IAAIC,YAAxB,EAAsCC,QAAQ,IAAIC,SAAlD,QAAmE,KAAnE;AACA,SAASC,GAAT,EAAcC,KAAd,EAAqBC,eAArB,EAAsCC,QAAtC,EAAgDC,SAAhD,QAAiE,KAAjE;AACA,OAAOC,QAAP,MAAqB,oBAArB;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,OAAOC,EAAP,MAAe,wBAAf;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,SAASC,SAAT,QAA0B,uBAA1B;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,YAAP,IAAuBC,OAAvB,QAAsC,gBAAtC;AACA,OAAO,IAAIC,UAAU,GAAG;AACtBC,EAAAA,GAAG,EAAEN,SAAS,CAACO,MADO;AAEtBC,EAAAA,gBAAgB,EAAER,SAAS,CAACO,MAFN;AAGtBE,EAAAA,YAAY,EAAET,SAAS,CAACU,KAHF;AAItBC,EAAAA,SAAS,EAAEX,SAAS,CAACO,MAJC;AAKtBK,EAAAA,gBAAgB,EAAEZ,SAAS,CAACO,MALN;AAMtBM,EAAAA,WAAW,EAAEb,SAAS,CAACc,UAND;AAOtBC,EAAAA,QAAQ,EAAEf,SAAS,CAACO,MAPE;AAQtBS,EAAAA,OAAO,EAAEhB,SAAS,CAACiB,SAAV,CAAoB,CAACjB,SAAS,CAACkB,SAAX,EAAsBlB,SAAS,CAACmB,KAAV,CAAgB;AACjEC,IAAAA,OAAO,EAAEpB,SAAS,CAACqB,IAD8C;AAEjEC,IAAAA,eAAe,EAAEtB,SAAS,CAACuB,IAFsC;AAGjEC,IAAAA,YAAY,EAAExB,SAAS,CAACiB,SAAV,CAAoB,CAACjB,SAAS,CAACuB,IAAX,EAAiBvB,SAAS,CAACkB,SAA3B,EAAsClB,SAAS,CAACO,MAAhD,CAApB;AAHmD,GAAhB,EAIhDkB,KAJ0B,CAApB,EAIEC,GAJF,CAIM,IAJN;AARa,CAAjB;;AAeP,IAAIC,iBAAiB,GAAG,SAASA,iBAAT,CAA2BC,GAA3B,EAAgCC,aAAhC,EAA+C;AACrE,MAAIC,GAAG,GAAG3C,QAAQ,CAAC,EAAD,EAAKyC,GAAL,CAAlB;;AAEAG,EAAAA,MAAM,CAACC,IAAP,CAAYH,aAAZ,EAA2BI,OAA3B,CAAmC,UAAUC,GAAV,EAAe;AAChD,QAAIN,GAAG,CAACM,GAAD,CAAH,KAAaC,SAAjB,EAA4B;AAC1BL,MAAAA,GAAG,CAACI,GAAD,CAAH,GAAWL,aAAa,CAACK,GAAD,CAAxB;AACD;AACF,GAJD;AAKA,SAAOJ,GAAP;AACD,CATD;;AAWA,IAAIM,IAAI,GAAG,CAAX;AACA,IAAIC,aAAa,GAAG3C,eAAe,CAAC;AAClC4C,EAAAA,IAAI,EAAE,OAD4B;AAElCC,EAAAA,MAAM,EAAE,CAACzC,SAAD,CAF0B;AAGlC0C,EAAAA,YAAY,EAAE,KAHoB;AAIlCC,EAAAA,KAAK,EAAEpC,UAJ2B;AAKlCqC,EAAAA,KAAK,EAAE,CAAC,OAAD,CAL2B;AAMlCC,EAAAA,KAAK,EAAE,SAASA,KAAT,CAAeF,KAAf,EAAsBG,IAAtB,EAA4B;AACjC,QAAIC,KAAK,GAAGD,IAAI,CAACC,KAAjB;AAAA,QACIC,KAAK,GAAGF,IAAI,CAACE,KADjB;AAAA,QAEIC,IAAI,GAAGH,IAAI,CAACG,IAFhB;AAGA,QAAIpC,SAAS,GAAGhB,QAAQ,CAAC,YAAY;AACnC,aAAO8C,KAAK,CAAC9B,SAAb;AACD,KAFuB,CAAxB;AAGA,QAAIC,gBAAgB,GAAGjB,QAAQ,CAAC,YAAY;AAC1C,aAAO,GAAGqD,MAAH,CAAUrC,SAAS,CAACsC,KAApB,EAA2B,UAA3B,CAAP;AACD,KAF8B,CAA/B;AAGA,QAAIjC,OAAO,GAAGrB,QAAQ,CAAC,YAAY;AACjC,UAAIkC,aAAa,GAAG;AAClBT,QAAAA,OAAO,EAAEe,SADS;AAElBb,QAAAA,eAAe,EAAE,SAASA,eAAT,GAA2B,CAAE,CAF5B;AAGlBE,QAAAA,YAAY,EAAEW;AAHI,OAApB;AAKA,aAAOjD,OAAO,CAACuD,KAAK,CAACzB,OAAP,CAAP,KAA2B,QAA3B,GAAsCW,iBAAiB,CAACc,KAAK,CAACzB,OAAP,EAAgBa,aAAhB,CAAvD,GAAwFA,aAA/F;AACD,KAPqB,CAAtB;AAQA,QAAIqB,mBAAmB,GAAGvD,QAAQ,CAAC,YAAY;AAC7C,aAAO8C,KAAK,CAAC5B,WAAN,IAAqB4B,KAAK,CAAC5B,WAAN,KAAsB,IAA3C,IAAmDiC,KAAK,CAACjC,WAAhE;AACD,KAFiC,CAAlC;AAGA,QAAIsC,cAAc,GAAGxD,QAAQ,CAAC,YAAY;AACxC,aAAOqB,OAAO,CAACiC,KAAR,CAAc7B,OAArB;AACD,KAF4B,CAA7B;AAGA,QAAIgC,sBAAsB,GAAGzD,QAAQ,CAAC,YAAY;AAChD,aAAOqB,OAAO,CAACiC,KAAR,CAAc3B,eAArB;AACD,KAFoC,CAArC;AAGA,QAAI+B,mBAAmB,GAAG1D,QAAQ,CAAC,YAAY;AAC7C,aAAOqB,OAAO,CAACiC,KAAR,CAAczB,YAArB;AACD,KAFiC,CAAlC;AAGA,QAAI8B,YAAY,GAAG3D,QAAQ,CAAC,YAAY;AACtC,aAAOwD,cAAc,CAACF,KAAf,KAAyBd,SAAhC;AACD,KAF0B,CAA3B;AAGA,QAAIoB,aAAa,GAAG/D,GAAG,CAAC,CAAC,CAAC2D,cAAc,CAACF,KAAlB,CAAvB;AACAxD,IAAAA,KAAK,CAAC0D,cAAD,EAAiB,YAAY;AAChCI,MAAAA,aAAa,CAACN,KAAd,GAAsB,CAAC,CAACE,cAAc,CAACF,KAAvC;AACD,KAFI,CAAL;AAGAxD,IAAAA,KAAK,CAAC8D,aAAD,EAAgB,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AAC1CL,MAAAA,sBAAsB,CAACH,KAAvB,CAA6BO,GAA7B,EAAkCC,MAAlC;AACD,KAFI,CAAL;AAGA,QAAIC,MAAM,GAAGlE,GAAG,CAAC0D,mBAAmB,CAACD,KAApB,GAA4B,SAA5B,GAAwC,QAAzC,CAAhB;AACAxD,IAAAA,KAAK,CAAC,YAAY;AAChB,aAAOgD,KAAK,CAACnC,GAAb;AACD,KAFI,EAEF,YAAY;AACboD,MAAAA,MAAM,CAACT,KAAP,GAAeC,mBAAmB,CAACD,KAApB,GAA4B,SAA5B,GAAwC,QAAvD;AACD,KAJI,CAAL;AAKA,QAAIU,aAAa,GAAGnE,GAAG,CAAC,IAAD,CAAvB;AACA,QAAIoE,OAAO,GAAGjE,QAAQ,CAAC,YAAY;AACjC,aAAO+D,MAAM,CAACT,KAAP,KAAiB,OAAxB;AACD,KAFqB,CAAtB;AAGA,QAAIY,YAAY,GAAGzD,OAAO,CAAC0D,MAAR,EAAnB;AACA,QAAIC,cAAc,GAAGF,YAAY,CAACE,cAAlC;AAAA,QACIC,UAAU,GAAGH,YAAY,CAACG,UAD9B;AAAA,QAEIC,mBAAmB,GAAGJ,YAAY,CAACK,cAFvC;AAAA,QAGIC,qBAAqB,GAAGN,YAAY,CAACO,gBAHzC;AAAA,QAIIC,aAAa,GAAGR,YAAY,CAACQ,aAJjC;AAKA,QAAIC,SAAS,GAAG9E,GAAG,CAAC4C,IAAI,EAAL,CAAnB;AACA,QAAImC,UAAU,GAAG5E,QAAQ,CAAC,YAAY;AACpC,aAAO8C,KAAK,CAACzB,OAAN,IAAiB,CAAC4C,OAAO,CAACX,KAAjC;AACD,KAFwB,CAAzB;;AAIA,QAAIuB,MAAM,GAAG,SAASA,MAAT,GAAkB;AAC7Bd,MAAAA,MAAM,CAACT,KAAP,GAAe,QAAf;AACD,KAFD;;AAIA,QAAIwB,OAAO,GAAG,SAASA,OAAT,GAAmB;AAC/Bf,MAAAA,MAAM,CAACT,KAAP,GAAe,OAAf;AACD,KAFD;;AAIA,QAAIyB,SAAS,GAAG,SAASA,SAAT,CAAmBC,CAAnB,EAAsB;AACpC,UAAI,CAACrB,YAAY,CAACL,KAAlB,EAAyB;AACvB,YAAI2B,UAAU,GAAG3E,SAAS,CAAC0E,CAAC,CAACE,MAAH,CAA1B;AAAA,YACIC,IAAI,GAAGF,UAAU,CAACE,IADtB;AAAA,YAEIC,GAAG,GAAGH,UAAU,CAACG,GAFrB;;AAIA,YAAIhB,cAAc,CAACd,KAAnB,EAA0B;AACxBe,UAAAA,UAAU,CAACM,SAAS,CAACrB,KAAX,CAAV;AACAkB,UAAAA,qBAAqB,CAAC;AACpBa,YAAAA,CAAC,EAAEF,IADiB;AAEpBG,YAAAA,CAAC,EAAEF;AAFiB,WAAD,CAArB;AAID,SAND,MAMO;AACLpB,UAAAA,aAAa,CAACV,KAAd,GAAsB;AACpB+B,YAAAA,CAAC,EAAEF,IADiB;AAEpBG,YAAAA,CAAC,EAAEF;AAFiB,WAAtB;AAID;AACF;;AAED,UAAIhB,cAAc,CAACd,KAAnB,EAA0B;AACxBgB,QAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,OAFD,MAEO;AACLV,QAAAA,aAAa,CAACN,KAAd,GAAsB,IAAtB;AACD;;AAEDF,MAAAA,IAAI,CAAC,OAAD,EAAU4B,CAAV,CAAJ;AACD,KA3BD;;AA6BA,QAAIO,cAAc,GAAG,SAASA,cAAT,GAA0B;AAC7C3B,MAAAA,aAAa,CAACN,KAAd,GAAsB,KAAtB;;AAEA,UAAI,CAACK,YAAY,CAACL,KAAlB,EAAyB;AACvBU,QAAAA,aAAa,CAACV,KAAd,GAAsB,IAAtB;AACD;AACF,KAND;;AAQA,QAAIkC,GAAG,GAAG3F,GAAG,CAAC,IAAD,CAAb;AACAC,IAAAA,KAAK,CAAC,YAAY;AAChB,aAAO0F,GAAP;AACD,KAFI,EAEF,YAAY;AACb,UAAIzB,MAAM,CAACT,KAAP,KAAiB,SAArB,EAAgC;;AAEhC,UAAIkC,GAAG,CAAClC,KAAJ,CAAUmC,QAAV,KAAuBD,GAAG,CAAClC,KAAJ,CAAUoC,YAAV,IAA0BF,GAAG,CAAClC,KAAJ,CAAUqC,aAA3D,CAAJ,EAA+E;AAC7Ed,QAAAA,MAAM;AACP;AACF,KARI,CAAL;;AAUA,QAAIe,UAAU,GAAG,SAASA,UAAT,GAAsB,CAAE,CAAzC;;AAEA3F,IAAAA,SAAS,CAAC,YAAY;AACpBH,MAAAA,KAAK,CAAC,CAAC,YAAY;AACjB,eAAOgD,KAAK,CAACnC,GAAb;AACD,OAFK,EAEHiE,UAFG,CAAD,EAEW,YAAY;AAC1BgB,QAAAA,UAAU;;AAEV,YAAI,CAACxB,cAAc,CAACd,KAApB,EAA2B;AACzB,iBAAO,YAAY,CAAE,CAArB;AACD;;AAEDsC,QAAAA,UAAU,GAAGlB,aAAa,CAACC,SAAS,CAACrB,KAAX,EAAkBR,KAAK,CAACnC,GAAxB,CAA1B;;AAEA,YAAI,CAACiE,UAAU,CAACtB,KAAhB,EAAuB;AACrBsC,UAAAA,UAAU;AACX;AACF,OAdI,EAcF;AACDC,QAAAA,KAAK,EAAE,MADN;AAEDC,QAAAA,SAAS,EAAE;AAFV,OAdE,CAAL;AAkBD,KAnBQ,CAAT;;AAqBA,QAAIC,QAAQ,GAAG,SAASA,QAAT,CAAkBC,CAAlB,EAAqB;AAClC,UAAI9F,QAAQ,CAAC8F,CAAD,CAAZ,EAAiB,OAAOA,CAAC,GAAG,IAAX;AACjB,aAAOA,CAAP;AACD,KAHD;;AAKA,WAAO,YAAY;AACjB,UAAIhF,SAAS,GAAG8B,KAAK,CAAC9B,SAAtB;AAAA,UACIH,gBAAgB,GAAGiC,KAAK,CAACjC,gBAD7B;AAAA,UAEIO,QAAQ,GAAG0B,KAAK,CAAC1B,QAFrB;AAAA,UAGIT,GAAG,GAAGmC,KAAK,CAACnC,GAHhB;AAAA,UAIIU,OAAO,GAAGyB,KAAK,CAACzB,OAJpB;AAAA,UAKIH,WAAW,GAAG4B,KAAK,CAAC5B,WALxB;AAAA,UAMIJ,YAAY,GAAGgC,KAAK,CAAChC,YANzB;AAOA,UAAImF,KAAK,GAAG/C,KAAK,CAAC+C,KAAlB;AAAA,UACIC,MAAM,GAAGhD,KAAK,CAACgD,MADnB;AAAA,UAEIC,WAAW,GAAGjD,KAAK,CAACiD,WAFxB;AAAA,UAGIC,QAAQ,GAAGlD,KAAK,CAACkD,QAHrB;AAAA,UAIIC,GAAG,GAAGnD,KAAK,CAACmD,GAJhB;AAAA,UAKIC,KAAK,GAAGpD,KAAK,CAACoD,KALlB;AAAA,UAMIC,MAAM,GAAGrD,KAAK,CAACqD,MANnB;AAAA,UAOIC,MAAM,GAAGtD,KAAK,CAACsD,MAPnB;AAAA,UAQIC,GAAG,GAAGvD,KAAK,CAACwD,KARhB;AAAA,UASI3F,KAAK,GAAGmC,KAAK,CAACnC,KATlB;AAUA,UAAI4F,aAAa,GAAGvG,EAAE,CAACY,SAAD,EAAYH,gBAAZ,EAA8BvB,eAAe,CAAC,EAAD,EAAK,GAAG+D,MAAH,CAAUrC,SAAV,EAAqB,QAArB,CAAL,EAAqCiD,OAAO,CAACX,KAA7C,CAA7C,CAAtB;AACA,UAAIsD,SAAS,GAAG3C,OAAO,CAACX,KAAR,IAAiBlC,QAAjB,GAA4BA,QAA5B,GAAuCT,GAAvD;AACA,UAAIkG,WAAW,GAAG1D,KAAK,CAAC0D,WAAN,IAAqB1D,KAAK,CAAC0D,WAAN,EAAvC;AACA,UAAIC,cAAc,GAAG;AACnBX,QAAAA,WAAW,EAAEA,WADM;AAEnBC,QAAAA,QAAQ,EAAEA,QAFS;AAGnBC,QAAAA,GAAG,EAAEA,GAHc;AAInBC,QAAAA,KAAK,EAAEA,KAJY;AAKnBC,QAAAA,MAAM,EAAEA,MALW;AAMnBC,QAAAA,MAAM,EAAEA,MANW;AAOnBE,QAAAA,KAAK,EAAEtG,EAAE,CAAC,GAAGiD,MAAH,CAAUrC,SAAV,EAAqB,MAArB,CAAD,EAA+B1B,eAAe,CAAC,EAAD,EAAK,GAAG+D,MAAH,CAAUrC,SAAV,EAAqB,kBAArB,CAAL,EAA+CE,WAAW,KAAK,IAA/D,CAA9C,EAAoHuF,GAApH,CAPU;AAQnB1F,QAAAA,KAAK,EAAEvB,QAAQ,CAAC;AACd0G,UAAAA,MAAM,EAAEA;AADM,SAAD,EAEZnF,KAFY;AARI,OAArB;AAYA,aAAOrB,YAAY,CAACE,SAAD,EAAY,IAAZ,EAAkB,CAACF,YAAY,CAAC,KAAD,EAAQ;AACxD,iBAASiH,aAD+C;AAExD,mBAAWtF,OAAO,IAAI,CAAC4C,OAAO,CAACX,KAApB,GAA4ByB,SAA5B,GAAwC,UAAUC,CAAV,EAAa;AAC9D5B,UAAAA,IAAI,CAAC,OAAD,EAAU4B,CAAV,CAAJ;AACD,SAJuD;AAKxD,iBAASxF,QAAQ,CAAC;AAChByG,UAAAA,KAAK,EAAEF,QAAQ,CAACE,KAAD,CADC;AAEhBC,UAAAA,MAAM,EAAEH,QAAQ,CAACG,MAAD;AAFA,SAAD,EAGdpF,YAHc;AALuC,OAAR,EAS/C,CAACpB,YAAY,CAAC,KAAD,EAAQL,aAAa,CAACA,aAAa,CAACA,aAAa,CAAC,EAAD,EAAKyH,cAAL,CAAd,EAAoC7C,OAAO,CAACX,KAAR,IAAiBlC,QAAjB,GAA4B;AACjHT,QAAAA,GAAG,EAAES;AAD4G,OAA5B,GAEnF;AACFyD,QAAAA,MAAM,EAAEA,MADN;AAEFC,QAAAA,OAAO,EAAEA,OAFP;AAGFnE,QAAAA,GAAG,EAAEA;AAHH,OAF+C,CAAd,EAMjC,EANiC,EAM7B;AACN,eAAO6E;AADD,OAN6B,CAArB,EAQZ,IARY,CAAb,EAQQzB,MAAM,CAACT,KAAP,KAAiB,SAAjB,IAA8B5D,YAAY,CAAC,KAAD,EAAQ;AAC3D,uBAAe,MAD4C;AAE3D,iBAAS,GAAG2D,MAAH,CAAUrC,SAAV,EAAqB,cAArB;AAFkD,OAAR,EAGlD,CAACE,WAAW,IAAIiC,KAAK,CAACjC,WAAN,IAAqBiC,KAAK,CAACjC,WAAN,EAArC,CAHkD,CARlD,EAW4D2F,WAAW,IAAIjC,UAAU,CAACtB,KAA1B,IAAmC5D,YAAY,CAAC,KAAD,EAAQ;AACpH,iBAAS,GAAG2D,MAAH,CAAUrC,SAAV,EAAqB,OAArB;AAD2G,OAAR,EAE3G,CAAC6F,WAAD,CAF2G,CAX3G,CAT+C,CAAb,EAsBhB,CAACzC,cAAc,CAACd,KAAhB,IAAyBsB,UAAU,CAACtB,KAApC,IAA6C5D,YAAY,CAACa,OAAD,EAAU;AACtF,uBAAe,CAACqD,aAAa,CAACN,KADwD;AAEtF,mBAAWM,aAAa,CAACN,KAF6D;AAGtF,qBAAarC,gBAAgB,CAACqC,KAHwD;AAItF,mBAAWiC,cAJ2E;AAKtF,yBAAiBvB,aAAa,CAACV,KALuD;AAMtF,eAAOsD,SAN+E;AAOtF,eAAOP,GAP+E;AAQtF,wBAAgB3C,mBAAmB,CAACJ;AARkD,OAAV,EAS3E,IAT2E,CAtBzC,CAAlB,CAAnB;AAgCD,KAjED;AAkED;AAzNiC,CAAD,CAAnC;AA2NAZ,aAAa,CAAClC,YAAd,GAA6BA,YAA7B;AACA,eAAekC,aAAf","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { createVNode as _createVNode, Fragment as _Fragment } from \"vue\";\nimport { ref, watch, defineComponent, computed, onMounted } from 'vue';\nimport isNumber from 'lodash-es/isNumber';\nimport BaseMixin from '../../_util/BaseMixin';\nimport cn from '../../_util/classNames';\nimport PropTypes from '../../_util/vue-types';\nimport { getOffset } from '../../vc-util/Dom/css';\nimport Preview from './Preview';\nimport PreviewGroup, { context } from './PreviewGroup';\nexport var imageProps = {\n  src: PropTypes.string,\n  wrapperClassName: PropTypes.string,\n  wrapperStyle: PropTypes.style,\n  prefixCls: PropTypes.string,\n  previewPrefixCls: PropTypes.string,\n  placeholder: PropTypes.VNodeChild,\n  fallback: PropTypes.string,\n  preview: PropTypes.oneOfType([PropTypes.looseBool, PropTypes.shape({\n    visible: PropTypes.bool,\n    onVisibleChange: PropTypes.func,\n    getContainer: PropTypes.oneOfType([PropTypes.func, PropTypes.looseBool, PropTypes.string])\n  }).loose]).def(true)\n};\n\nvar mergeDefaultValue = function mergeDefaultValue(obj, defaultValues) {\n  var res = _extends({}, obj);\n\n  Object.keys(defaultValues).forEach(function (key) {\n    if (obj[key] === undefined) {\n      res[key] = defaultValues[key];\n    }\n  });\n  return res;\n};\n\nvar uuid = 0;\nvar ImageInternal = defineComponent({\n  name: 'Image',\n  mixins: [BaseMixin],\n  inheritAttrs: false,\n  props: imageProps,\n  emits: ['click'],\n  setup: function setup(props, _ref) {\n    var attrs = _ref.attrs,\n        slots = _ref.slots,\n        emit = _ref.emit;\n    var prefixCls = computed(function () {\n      return props.prefixCls;\n    });\n    var previewPrefixCls = computed(function () {\n      return \"\".concat(prefixCls.value, \"-preview\");\n    });\n    var preview = computed(function () {\n      var defaultValues = {\n        visible: undefined,\n        onVisibleChange: function onVisibleChange() {},\n        getContainer: undefined\n      };\n      return _typeof(props.preview) === 'object' ? mergeDefaultValue(props.preview, defaultValues) : defaultValues;\n    });\n    var isCustomPlaceholder = computed(function () {\n      return props.placeholder && props.placeholder !== true || slots.placeholder;\n    });\n    var previewVisible = computed(function () {\n      return preview.value.visible;\n    });\n    var onPreviewVisibleChange = computed(function () {\n      return preview.value.onVisibleChange;\n    });\n    var getPreviewContainer = computed(function () {\n      return preview.value.getContainer;\n    });\n    var isControlled = computed(function () {\n      return previewVisible.value !== undefined;\n    });\n    var isShowPreview = ref(!!previewVisible.value);\n    watch(previewVisible, function () {\n      isShowPreview.value = !!previewVisible.value;\n    });\n    watch(isShowPreview, function (val, preVal) {\n      onPreviewVisibleChange.value(val, preVal);\n    });\n    var status = ref(isCustomPlaceholder.value ? 'loading' : 'normal');\n    watch(function () {\n      return props.src;\n    }, function () {\n      status.value = isCustomPlaceholder.value ? 'loading' : 'normal';\n    });\n    var mousePosition = ref(null);\n    var isError = computed(function () {\n      return status.value === 'error';\n    });\n    var groupContext = context.inject();\n    var isPreviewGroup = groupContext.isPreviewGroup,\n        setCurrent = groupContext.setCurrent,\n        setGroupShowPreview = groupContext.setShowPreview,\n        setGroupMousePosition = groupContext.setMousePosition,\n        registerImage = groupContext.registerImage;\n    var currentId = ref(uuid++);\n    var canPreview = computed(function () {\n      return props.preview && !isError.value;\n    });\n\n    var onLoad = function onLoad() {\n      status.value = 'normal';\n    };\n\n    var onError = function onError() {\n      status.value = 'error';\n    };\n\n    var onPreview = function onPreview(e) {\n      if (!isControlled.value) {\n        var _getOffset = getOffset(e.target),\n            left = _getOffset.left,\n            top = _getOffset.top;\n\n        if (isPreviewGroup.value) {\n          setCurrent(currentId.value);\n          setGroupMousePosition({\n            x: left,\n            y: top\n          });\n        } else {\n          mousePosition.value = {\n            x: left,\n            y: top\n          };\n        }\n      }\n\n      if (isPreviewGroup.value) {\n        setGroupShowPreview(true);\n      } else {\n        isShowPreview.value = true;\n      }\n\n      emit('click', e);\n    };\n\n    var onPreviewClose = function onPreviewClose() {\n      isShowPreview.value = false;\n\n      if (!isControlled.value) {\n        mousePosition.value = null;\n      }\n    };\n\n    var img = ref(null);\n    watch(function () {\n      return img;\n    }, function () {\n      if (status.value !== 'loading') return;\n\n      if (img.value.complete && (img.value.naturalWidth || img.value.naturalHeight)) {\n        onLoad();\n      }\n    });\n\n    var unRegister = function unRegister() {};\n\n    onMounted(function () {\n      watch([function () {\n        return props.src;\n      }, canPreview], function () {\n        unRegister();\n\n        if (!isPreviewGroup.value) {\n          return function () {};\n        }\n\n        unRegister = registerImage(currentId.value, props.src);\n\n        if (!canPreview.value) {\n          unRegister();\n        }\n      }, {\n        flush: 'post',\n        immediate: true\n      });\n    });\n\n    var toSizePx = function toSizePx(l) {\n      if (isNumber(l)) return l + 'px';\n      return l;\n    };\n\n    return function () {\n      var prefixCls = props.prefixCls,\n          wrapperClassName = props.wrapperClassName,\n          fallback = props.fallback,\n          src = props.src,\n          preview = props.preview,\n          placeholder = props.placeholder,\n          wrapperStyle = props.wrapperStyle;\n      var width = attrs.width,\n          height = attrs.height,\n          crossorigin = attrs.crossorigin,\n          decoding = attrs.decoding,\n          alt = attrs.alt,\n          sizes = attrs.sizes,\n          srcset = attrs.srcset,\n          usemap = attrs.usemap,\n          cls = attrs.class,\n          style = attrs.style;\n      var wrappperClass = cn(prefixCls, wrapperClassName, _defineProperty({}, \"\".concat(prefixCls, \"-error\"), isError.value));\n      var mergedSrc = isError.value && fallback ? fallback : src;\n      var previewMask = slots.previewMask && slots.previewMask();\n      var imgCommonProps = {\n        crossorigin: crossorigin,\n        decoding: decoding,\n        alt: alt,\n        sizes: sizes,\n        srcset: srcset,\n        usemap: usemap,\n        class: cn(\"\".concat(prefixCls, \"-img\"), _defineProperty({}, \"\".concat(prefixCls, \"-img-placeholder\"), placeholder === true), cls),\n        style: _extends({\n          height: height\n        }, style)\n      };\n      return _createVNode(_Fragment, null, [_createVNode(\"div\", {\n        \"class\": wrappperClass,\n        \"onClick\": preview && !isError.value ? onPreview : function (e) {\n          emit('click', e);\n        },\n        \"style\": _extends({\n          width: toSizePx(width),\n          height: toSizePx(height)\n        }, wrapperStyle)\n      }, [_createVNode(\"img\", _objectSpread(_objectSpread(_objectSpread({}, imgCommonProps), isError.value && fallback ? {\n        src: fallback\n      } : {\n        onLoad: onLoad,\n        onError: onError,\n        src: src\n      }), {}, {\n        \"ref\": img\n      }), null), status.value === 'loading' && _createVNode(\"div\", {\n        \"aria-hidden\": \"true\",\n        \"class\": \"\".concat(prefixCls, \"-placeholder\")\n      }, [placeholder || slots.placeholder && slots.placeholder()]), previewMask && canPreview.value && _createVNode(\"div\", {\n        \"class\": \"\".concat(prefixCls, \"-mask\")\n      }, [previewMask])]), !isPreviewGroup.value && canPreview.value && _createVNode(Preview, {\n        \"aria-hidden\": !isShowPreview.value,\n        \"visible\": isShowPreview.value,\n        \"prefixCls\": previewPrefixCls.value,\n        \"onClose\": onPreviewClose,\n        \"mousePosition\": mousePosition.value,\n        \"src\": mergedSrc,\n        \"alt\": alt,\n        \"getContainer\": getPreviewContainer.value\n      }, null)]);\n    };\n  }\n});\nImageInternal.PreviewGroup = PreviewGroup;\nexport default ImageInternal;"]},"metadata":{},"sourceType":"module"}