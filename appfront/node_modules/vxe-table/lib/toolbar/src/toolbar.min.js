"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_log=require("../../tools/log"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_default2=(0,_vue.defineComponent)({name:"VxeToolbar",props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:function(){return _conf.default.toolbar.buttons}},tools:{type:Array,default:function(){return _conf.default.toolbar.tools}},perfect:{type:Boolean,default:function(){return _conf.default.toolbar.perfect}},size:{type:String,default:function(){return _conf.default.toolbar.size||_conf.default.size}},className:[String,Function]},emits:["button-click","tool-click"],setup:function(_,e){function n(){var e=C.columns,t=O.getComputeMaps().computeCustomOpts.value.checkMethod;R.isAll=e.every(function(e){return!!t&&!t({column:e})||e.visible}),R.isIndeterminate=!R.isAll&&e.some(function(e){return(!t||t({column:e}))&&(e.visible||e.halfVisible)})}function i(){O.handleCustom()}function t(e){v()&&(R.visible||(R.visible=!0,n(),d("open",e)))}function o(e){R.visible&&(f(),d("close",e))}function c(t){var e=C.columns;(e=_xeUtils.default.findTree(e,function(e){return e===t}))&&e.parent&&((e=e.parent).children&&e.children.length&&(e.visible=e.children.every(function(e){return e.visible}),e.halfVisible=!e.visible&&e.children.some(function(e){return e.visible||e.halfVisible}),c(e)))}function r(e){var t=y.value;(0,_dom.getEventTargetNode)(e,t).flag||o(e)}function u(e){o(e)}function b(){var e=C.isRefresh,t=M.value;if(!e){t=t.query;if(t){C.isRefresh=!0;try{Promise.resolve(t({})).catch(function(e){return e}).then(function(){C.isRefresh=!1})}catch(e){C.isRefresh=!1}}else B&&(C.isRefresh=!0,B.commitProxy("reload").catch(function(e){return e}).then(function(){C.isRefresh=!1}))}}function p(e){B&&B.triggerZoomEvent(e)}function m(){v()&&O.openImport()}function h(){v()&&O.openExport()}function x(){v()&&O.openPrint()}var O,g=e.slots,l=e.emit,a=_xeUtils.default.uniqueId(),T=(0,_size.useSize)(_),C=(0,_vue.reactive)({isRefresh:!1,columns:[]}),k=(0,_vue.ref)(),y=(0,_vue.ref)(),R=(0,_vue.reactive)({isAll:!1,isIndeterminate:!1,activeBtn:!1,activeWrapper:!1,visible:!1}),s={refElem:k},E={xID:a,props:_,context:e,reactData:C,getRefMaps:function(){return s}},e={},B=(0,_vue.inject)("$xegrid",null),M=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.refresh,_.refresh)}),V=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.import,_.import)}),L=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.export,_.export)}),j=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.print,_.print)}),A=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.zoom,_.zoom)}),z=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.custom,_.custom)}),v=function(){if(O)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},f=function(){var e=_.custom,t=z.value;R.visible&&(R.visible=!1,e&&!t.immediate&&i())},d=function(e,t){(B||O).dispatchEvent("custom",{type:e},t)},$=function(e){f(),d("confirm",e)},q=function(e){var t=C.columns,o=O.getComputeMaps().computeCustomOpts.value.checkMethod;_xeUtils.default.eachTree(t,function(e){o&&!o({column:e})||(e.visible=e.defaultVisible,e.halfVisible=!1),e.resizeWidth=0}),O.saveCustomResizable(!0),f(),d("reset",e)},N=function(e){var t=!e.visible,o=z.value;_xeUtils.default.eachTree([e],function(e){e.visible=t,e.halfVisible=!1}),c(e),_.custom&&o.immediate&&i(),n()},S=function(){var e=C.columns,t=O.getComputeMaps().computeCustomOpts.value.checkMethod,o=!R.isAll;_xeUtils.default.eachTree(e,function(e){t&&!t({column:e})||(e.visible=o,e.halfVisible=!1)}),R.isAll=o,n()},w=function(e){(R.visible?o:t)(e)},U=function(e){R.activeBtn=!0,t(e)},I=function(e){R.activeBtn=!1,setTimeout(function(){R.activeBtn||R.activeWrapper||o(e)},300)},X=function(e){R.activeWrapper=!0,t(e)},P=function(e){R.activeWrapper=!1,setTimeout(function(){R.activeBtn||R.activeWrapper||o(e)},300)},D=function(e,t){var o,n=t.code;n&&(B?B.triggerToolbarBtnEvent(t,e):(o=_vXETable.VXETable.commands.get(n),t={code:n,button:t,$table:O,$event:e},o&&o(t,e),E.dispatchEvent("button-click",t,e)))},F=function(e,t){var o,n=t.code;n&&(B?B.triggerToolbarTolEvent(t,e):(o=_vXETable.VXETable.commands.get(n),t={code:n,tool:t,$table:O,$event:e},o&&o(t,e),E.dispatchEvent("tool-click",t,e)))},W=function(e,o){e=e.dropdowns;return e?e.map(function(t,e){return!1===t.visible?(0,_vue.createCommentVNode)():(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{key:e,disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,onClick:function(e){return(o?D:F)(e,t)}})}):[]},e={dispatchEvent:function(e,t,o){l(e,Object.assign({$toolbar:E,$event:o},t))},syncUpdate:function(e){var t=e.collectColumn;O=e.$table,C.columns=t}};Object.assign(E,e),(0,_vue.onMounted)(function(){_event.GlobalEvent.on(E,"mousedown",r),_event.GlobalEvent.on(E,"blur",u)}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(E,"mousedown"),_event.GlobalEvent.off(E,"blur")}),(0,_vue.nextTick)(function(){var e=_.refresh,t=M.value;!e||B||t.query||(0,_log.warnLog)("vxe.error.notFunc",["query"])});return E.renderVN=function(){var c,r,e=_.perfect,t=_.loading,o=_.refresh,n=_.zoom,i=_.custom,u=_.className,l=T.value,a=M.value,s=V.value,v=L.value,f=j.value,d=A.value;return(0,_vue.h)("div",{ref:k,class:["vxe-toolbar",u?_xeUtils.default.isFunction(u)?u({$toolbar:E}):u:"",((u={})["size--"+l]=l,u["is--perfect"]=e,u["is--loading"]=t,u)]},[(0,_vue.h)("div",{class:"vxe-buttons--wrapper"},function(){var e=_.buttons,t=g.buttons;if(t)return t({$grid:B,$table:O});var i=[];return e&&e.forEach(function(t){var e,o=t.dropdowns,n=t.buttonRender;!1!==t.visible&&(e=n?_vXETable.VXETable.renderer.get(n.name):null,n&&e&&e.renderToolbarButton?i.push((0,_vue.h)("span",{class:"vxe-button--item"},e.renderToolbarButton(n,{$grid:B,$table:O,button:t}))):i.push((0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer,onClick:function(e){return D(e,t)}},o&&o.length?{dropdowns:function(){return W(t,!0)}}:{})))}),i}()),(0,_vue.h)("div",{class:"vxe-tools--wrapper"},function(){var e=_.tools,t=g.tools;if(t)return t({$grid:B,$table:O});var i=[];return e&&e.forEach(function(t){var e,o=t.dropdowns,n=t.toolRender;!1!==t.visible&&(e=n?_vXETable.VXETable.renderer.get(n.name):null,n&&e&&e.renderToolbarTool?i.push((0,_vue.h)("span",{class:"vxe-tool--item"},e.renderToolbarTool(n,{$grid:B,$table:O,tool:t}))):i.push((0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer,onClick:function(e){return F(e,t)}},o&&o.length?{dropdowns:function(){return W(t,!1)}}:{})))}),i}()),(0,_vue.h)("div",{class:"vxe-tools--operate"},[_.import?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:s.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT,title:_conf.default.i18n("vxe.toolbar.import"),onClick:m}):(0,_vue.createCommentVNode)(),_.export?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:v.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT,title:_conf.default.i18n("vxe.toolbar.export"),onClick:h}):(0,_vue.createCommentVNode)(),_.print?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:f.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT,title:_conf.default.i18n("vxe.toolbar.print"),onClick:x}):(0,_vue.createCommentVNode)(),o?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:C.isRefresh?a.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:a.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH,title:_conf.default.i18n("vxe.toolbar.refresh"),onClick:b}):(0,_vue.createCommentVNode)(),n&&B?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:B.isMaximized()?d.iconOut||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_OUT:d.iconIn||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_IN,title:_conf.default.i18n("vxe.toolbar.zoom"+(B.isMaximized()?"Out":"In")),onClick:p}):(0,_vue.createCommentVNode)(),i?(a=C.columns,n=z.value,r=[],d={},i={},O&&(c=O.getComputeMaps().computeCustomOpts.value.checkMethod),"manual"===n.trigger||("hover"===n.trigger?(d.onMouseenter=U,d.onMouseleave=I,i.onMouseenter=X,i.onMouseleave=P):d.onClick=w),_xeUtils.default.eachTree(a,function(e){var t=(0,_utils.formatText)(e.getTitle(),1),o=e.getKey(),n=e.children&&e.children.length,i=!!c&&!c({column:e});(n||o)&&r.push((0,_vue.h)("li",{class:["vxe-custom--option","level--"+e.level,{"is--group":n,"is--checked":e.visible,"is--indeterminate":e.halfVisible,"is--disabled":i}],title:t,onClick:function(){i||N(e)}},[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},t)]))}),(0,_vue.h)("div",{class:["vxe-custom--wrapper",{"is--active":R.visible}],ref:y},[(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),__assign({circle:!0,icon:n.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM,title:_conf.default.i18n("vxe.toolbar.custom")},d)),(0,_vue.h)("div",{class:"vxe-custom--option-wrapper"},[(0,_vue.h)("ul",{class:"vxe-custom--header"},[(0,_vue.h)("li",{class:["vxe-custom--option",{"is--checked":R.isAll,"is--indeterminate":R.isIndeterminate}],title:_conf.default.i18n("vxe.table.allTitle"),onClick:S},[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.toolbar.customAll"))])]),(0,_vue.h)("ul",__assign({class:"vxe-custom--body"},i),r),!1===n.isFooter?null:(0,_vue.h)("div",{class:"vxe-custom--footer"},[(0,_vue.h)("button",{class:"btn--confirm",onClick:$},_conf.default.i18n("vxe.toolbar.customConfirm")),(0,_vue.h)("button",{class:"btn--reset",onClick:q},_conf.default.i18n("vxe.toolbar.customRestore"))])])])):(0,_vue.createCommentVNode)()])])},E},render:function(){return this.renderVN()}});exports.default=_default2;