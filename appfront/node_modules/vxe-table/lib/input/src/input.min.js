"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_event=require("../../tools/event"),_date=require("./date"),_number=require("./number");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var yearSize=20,monthSize=20,quarterSize=8,_default2=(0,_vue.defineComponent)({name:"VxeInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],autocomplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:function(){return _conf.default.input.size||_conf.default.size}},min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],exponential:{type:Boolean,default:function(){return _conf.default.input.exponential}},controls:{type:Boolean,default:function(){return _conf.default.input.controls}},digits:{type:[String,Number],default:function(){return _conf.default.input.digits}},minDate:{type:[String,Number,Date],default:function(){return _conf.default.input.minDate}},maxDate:{type:[String,Number,Date],default:function(){return _conf.default.input.maxDate}},startWeek:Number,startDay:{type:[String,Number],default:function(){return _conf.default.input.startDay}},labelFormat:{type:String,default:function(){return _conf.default.input.labelFormat}},valueFormat:{type:String,default:function(){return _conf.default.input.valueFormat}},editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:function(){return _conf.default.input.festivalMethod}},disabledMethod:{type:Function,default:function(){return _conf.default.input.disabledMethod}},selectDay:{type:[String,Number],default:function(){return _conf.default.input.selectDay}},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},emits:["update:modelValue","input","change","keydown","keyup","wheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click","date-prev","date-today","date-next"],setup:function(D,e){function N(e){var t=e.target.value;Oe(t,e)}function w(e){Ae.value||Re(e)}function V(e){L.isActivated=!0,Re(e)}function b(e,t){var a=D.type,n=te.value;ae.value&&He(),(n||-1<["text","search","password"].indexOf(a))&&focus(),X.dispatchEvent("clear",{value:t},e)}function n(e){var t=D.type,a=D.valueFormat,n=he.value,u=ye.value,l=null,i="";e&&(l=J(e,a)),_xeUtils.default.isValidDate(l)?(i=_xeUtils.default.toDateString(l,n,{firstDay:u}),n&&"week"===t&&_xeUtils.default.getWhatWeek(l,0,u,u).getFullYear()<l.getFullYear()&&(-1<(n=n.indexOf("yyyy"))&&((n=Number(i.substring(n,n+4)))&&!isNaN(n)&&(i=i.replace(""+n,""+(n-1)))))):l=null,L.datePanelValue=l,L.datePanelLabel=i}function u(){var e=ae.value,t=L.inputValue;e&&(n(t),L.inputValue=L.datePanelLabel)}function t(){var e=D.type,t=L.inputValue,a=ae.value,n=le.value;a?u():"float"===e&&(!t||t!==(n=(0,_number.toFloatValueFixed)(t,n))&&Ie(n,{type:"init"}))}function T(e){var t=L.inputValue;Ae.value||Ie(t,e),Ze(),L.visiblePanel||(L.isActivated=!1),X.dispatchEvent("blur",{value:t},e)}function a(e){var t=D.readonly,a=D.disabled,n=L.showPwd;a||t||(L.showPwd=!n),X.dispatchEvent("toggle-visible",{visible:L.showPwd},e)}function l(e){X.dispatchEvent("search-click",{},e)}function i(e,t){var a=D.min,n=D.max,u=D.type,l=L.inputValue,i=ie.value,l="integer"===u?_xeUtils.default.toInteger((0,_number.handleNumber)(l)):_xeUtils.default.toNumber((0,_number.handleNumber)(l)),i=e?_xeUtils.default.add(l,i):_xeUtils.default.subtract(l,i),a=Be(i)?Ge(i)?i:n:a;Oe(Fe(a),t)}function r(e){R=window.setTimeout(function(){Xe(e),r(e)},60)}function k(e){var t,a,n,u,l=D.exponential,i=D.controls;te.value&&(t=e.ctrlKey,a=e.shiftKey,n=e.altKey,u=e.keyCode,t||a||n||!((0,_event.hasEventKey)(e,_event.EVENT_KEYS.SPACEBAR)||(!l||69!==u)&&65<=u&&u<=90||186<=u&&u<=188||191<=u)||e.preventDefault(),i&&et(e)),Re(e)}function M(e){Re(e)}function s(){clearTimeout(R)}function o(e){R=window.setTimeout(function(){Je(e),o(e)},60)}function v(e){var t;s(),0===e.button&&(((t=(0,_dom.hasClass)(e.currentTarget,"is--prev"))?Je:Xe)(e),R=window.setTimeout(function(){(t?o:r)(e)},500))}function W(e){var t;te.value&&D.controls&&L.isActivated&&(0<(t=e.deltaY)?Xe(e):t<0&&Je(e),e.preventDefault()),Re(e)}function d(e,t){L.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")}function c(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");L.currentDate=e,d(e,0)}function f(){var e="month"===(e=L.datePanelType)||"quarter"===e?"year":"month";L.datePanelType=e}function p(e){c(),$e(L.currentDate),He(),X.dispatchEvent("date-today",{type:D.type},e)}function g(e){var t=D.disabledMethod,a=L.datePanelType;return t&&t({type:a,viewType:a,date:e.date,$input:Z})}function U(e){var t=D.type,a=L.datePanelType;"month"===t?"year"===a?(L.datePanelType="month",je(e)):($e(e),He()):"year"===t?($e(e),He()):"quarter"===t?"year"===a?(L.datePanelType="quarter",je(e)):($e(e),He()):"month"===a?(L.datePanelType="week"===t?t:"day",je(e)):"year"===a?(L.datePanelType="month",je(e)):($e(e),He())}function E(e){g(e)||U(e.date)}function P(e){var t;g(e)||("month"===(t=L.datePanelType)?it:"quarter"===t?lt:"year"===t?ut:nt)(e.date)}function _(e){var t;e&&(t=e.offsetHeight,e.parentNode.scrollTop=e.offsetTop-4*t)}function h(e){L.datetimePanelValue=new Date(L.datetimePanelValue.getTime()),_(e.currentTarget)}function m(){var e=de.value;$e(e||L.currentDate),He()}function x(){return(0,_vue.nextTick)().then(function(){var e=D.transfer,t=D.placement,a=L.panelIndex,n=B.value,u=Q.value;if(n&&u){var l=n.offsetHeight,i=n.offsetWidth,r=u.offsetHeight,s=u.offsetWidth,o={zIndex:a},v=(0,_dom.getAbsolutePos)(n),d=v.boundingTop,u=v.boundingLeft,a=v.visibleHeight,n=v.visibleWidth,v="bottom";return e?(e=d+l,"top"===t?(v="top",e=d-r):t||(a<e+r+5&&(v="top",e=d-r),e<5&&(v="bottom",e=d+l)),n<(u=u)+s+5&&(u-=u+s+5-n),u<5&&(u=5),Object.assign(o,{left:u+"px",top:e+"px",minWidth:i+"px"})):"top"===t?(v="top",o.bottom=l+"px"):t||a<d+l+r&&5<d-l-r&&(v="top",o.bottom=l+"px"),L.panelStyle=o,L.panelPlacement=v,(0,_vue.nextTick)()}})}function Y(e){ae.value&&st(e),Re(e)}function y(e){var t=D.disabled,a=L.visiblePanel,n=L.isActivated,u=ae.value,l=G.value,i=Q.value;!t&&n&&(L.isActivated=(0,_dom.getEventTargetNode)(e,l).flag||(0,_dom.getEventTargetNode)(e,i).flag,L.isActivated||(u?a&&(He(),Ze()):Ze()))}function S(e){var t,a,n,u,l,i,r,s,o,v,d,c,f,p,_,h,m=D.clearable,x=D.disabled,y=L.visiblePanel,g=ae.value;x||(t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.TAB),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.DELETE),n=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ESCAPE),u=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ENTER),h=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_LEFT),l=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),d=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_RIGHT),i=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN),r=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_UP),o=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_DOWN),c=h||l||d||i,s=L.isActivated,t?(s&&Ze(),L.isActivated=s=!1):c?g&&s&&(y?(v=e,_=L.isActivated,x=L.datePanelValue,h=L.datePanelType,_&&(v.preventDefault(),d=(0,_event.hasEventKey)(v,_event.EVENT_KEYS.ARROW_LEFT),c=(0,_event.hasEventKey)(v,_event.EVENT_KEYS.ARROW_UP),_=(0,_event.hasEventKey)(v,_event.EVENT_KEYS.ARROW_RIGHT),v=(0,_event.hasEventKey)(v,_event.EVENT_KEYS.ARROW_DOWN),"year"===h?(f=_xeUtils.default.getWhatYear(x||Date.now(),0,"first"),d?f=_xeUtils.default.getWhatYear(f,-1):c?f=_xeUtils.default.getWhatYear(f,-4):_?f=_xeUtils.default.getWhatYear(f,1):v&&(f=_xeUtils.default.getWhatYear(f,4)),ut(f)):"quarter"===h?(f=_xeUtils.default.getWhatQuarter(x||Date.now(),0,"first"),d?f=_xeUtils.default.getWhatQuarter(f,-1):c?f=_xeUtils.default.getWhatQuarter(f,-2):_?f=_xeUtils.default.getWhatQuarter(f,1):v&&(f=_xeUtils.default.getWhatQuarter(f,2)),lt(f)):"month"===h?(p=_xeUtils.default.getWhatMonth(x||Date.now(),0,"first"),d?p=_xeUtils.default.getWhatMonth(p,-1):c?p=_xeUtils.default.getWhatMonth(p,-4):_?p=_xeUtils.default.getWhatMonth(p,1):v&&(p=_xeUtils.default.getWhatMonth(p,4)),it(p)):(p=x||_xeUtils.default.getWhatDay(Date.now(),0,"first"),x=ye.value,d?p=_xeUtils.default.getWhatDay(p,-1):c?p=_xeUtils.default.getWhatWeek(p,-1,x):_?p=_xeUtils.default.getWhatDay(p,1):v&&(p=_xeUtils.default.getWhatWeek(p,1,x)),nt(p)))):(l||i)&&st(e)):u?g&&(y?L.datePanelValue?U(L.datePanelValue):He():s&&st(e)):(r||o)&&g&&s&&(o=e,L.isActivated&&(g=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.PAGE_UP),o.preventDefault(),(g?tt:at)(o))),t||n?y&&He():a&&m&&s&&b(e,null))}function K(e){var t=D.disabled,a=L.visiblePanel;t||a&&(a=Q.value,(0,_dom.getEventTargetNode)(e,a).flag?x():(He(),Ze()))}function C(){var e=L.isActivated;L.visiblePanel?(He(),Ze()):e&&Ze()}function q(e,t){if(n=D.festivalMethod){var a=L.datePanelType,n=n({type:a,viewType:a,date:e.date,$input:Z}),a=n?_xeUtils.default.isString(n)?{label:n}:n:{},e=a.extra?_xeUtils.default.isString(a.extra)?{label:a.extra}:a.extra:null,n=[(0,_vue.h)("span",{class:["vxe-input--date-label",{"is-notice":a.notice}]},e&&e.label?[(0,_vue.h)("span",t),(0,_vue.h)("span",{class:["vxe-input--date-label--extra",e.important?"is-important":"",e.className],style:e.style},_xeUtils.default.toValueString(e.label))]:t)],e=a.label;return e&&(e=_xeUtils.default.toValueString(e).split(","),n.push((0,_vue.h)("span",{class:["vxe-input--date-festival",a.important?"is-important":"",a.className],style:a.style},[1<e.length?(0,_vue.h)("span",{class:["vxe-input--date-festival--overlap","overlap--"+e.length]},e.map(function(e){return(0,_vue.h)("span",e.substring(0,3))})):(0,_vue.h)("span",{class:"vxe-input--date-festival--label"},e[0].substring(0,3))]))),n}return t}function A(){var t,a,e,n,u,l,i,r,s,o,v,d,c,f,p,_,h,m,x,y;switch(L.datePanelType){case"week":return s=L.datePanelType,o=L.datePanelValue,v=de.value,d=Ue.value,c=Te.value,f="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-"+s+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",d.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",c.map(function(e){var t=e.some(function(e){return _xeUtils.default.isDateSame(v,e.date,f)}),a=e.some(function(e){return _xeUtils.default.isDateSame(o,e.date,f)});return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":g(e),"is--selected":t,"is--hover":a},onClick:function(){return E(e)},onMouseenter:function(){return P(e)}},q(e,e.label))}))}))])];case"month":return d=L.datePanelType,i=L.datePanelValue,r=de.value,c=Ne.value,[(0,_vue.h)("table",{class:"vxe-input--date-"+d+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",c.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":g(e),"is--selected":_xeUtils.default.isDateSame(r,e.date,"yyyyMM"),"is--hover":_xeUtils.default.isDateSame(i,e.date,"yyyyMM")},onClick:function(){return E(e)},onMouseenter:function(){return P(e)}},q(e,_conf.default.i18n("vxe.input.date.months.m"+e.month)))}))}))])];case"quarter":return e=L.datePanelType,n=L.datePanelValue,u=de.value,l=Se.value,[(0,_vue.h)("table",{class:"vxe-input--date-"+e+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",l.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":g(e),"is--selected":_xeUtils.default.isDateSame(u,e.date,"yyyyq"),"is--hover":_xeUtils.default.isDateSame(n,e.date,"yyyyq")},onClick:function(){return E(e)},onMouseenter:function(){return P(e)}},q(e,_conf.default.i18n("vxe.input.date.quarters.q"+e.quarter)))}))}))])];case"year":return e=L.datePanelType,t=L.datePanelValue,a=de.value,l=Ee.value,[(0,_vue.h)("table",{class:"vxe-input--date-"+e+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",l.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--disabled":g(e),"is--current":e.isCurrent,"is--now":e.isNow,"is--selected":_xeUtils.default.isDateSame(a,e.date,"yyyy"),"is--hover":_xeUtils.default.isDateSame(t,e.date,"yyyy")},onClick:function(){return E(e)},onMouseenter:function(){return P(e)}},q(e,e.year))}))}))])]}return p=L.datePanelType,_=L.datePanelValue,h=de.value,m=be.value,x=Ve.value,y="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-"+p+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",m.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",x.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":g(e),"is--selected":_xeUtils.default.isDateSame(h,e.date,y),"is--hover":_xeUtils.default.isDateSame(_,e.date,y)},onClick:function(){return E(e)},onMouseenter:function(){return P(e)}},q(e,e.label))}))}))])]}var F,R,I=e.slots,O=e.emit,z=_xeUtils.default.uniqueId(),H=(0,_size.useSize)(D),L=(0,_vue.reactive)({inited:!1,panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:"",isActivated:!1,inputValue:D.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),G=(0,_vue.ref)(),B=(0,_vue.ref)(),Q=(0,_vue.ref)(),j=(0,_vue.ref)(),$={refElem:G,refInput:B},Z={xID:z,props:D,context:e,reactData:L,getRefMaps:function(){return $}},X={},J=function(e,t){return"time"===D.type?(0,_date.toStringTimeDate)(e):_xeUtils.default.toStringDate(e,t)},ee=(0,_vue.computed)(function(){var e=D.type;return"time"===e||"datetime"===e}),te=(0,_vue.computed)(function(){return-1<["number","integer","float"].indexOf(D.type)}),ae=(0,_vue.computed)(function(){return ee.value||-1<["date","week","month","quarter","year"].indexOf(D.type)}),ne=(0,_vue.computed)(function(){return"password"===D.type}),ue=(0,_vue.computed)(function(){return"search"===D.type}),le=(0,_vue.computed)(function(){return _xeUtils.default.toInteger(D.digits)||1}),ie=(0,_vue.computed)(function(){var e=D.type,t=le.value,a=D.step;return"integer"===e?_xeUtils.default.toInteger(a)||1:"float"===e?_xeUtils.default.toNumber(a)||1/Math.pow(10,t):_xeUtils.default.toNumber(a)||1}),re=(0,_vue.computed)(function(){var e=D.type,t=te.value,a=ae.value,n=ne.value;return D.clearable&&(n||t||a||"text"===e||"search"===e)}),se=(0,_vue.computed)(function(){return D.minDate?_xeUtils.default.toStringDate(D.minDate):null}),oe=(0,_vue.computed)(function(){return D.maxDate?_xeUtils.default.toStringDate(D.maxDate):null}),ve=(0,_vue.computed)(function(){var e=D.type;return"time"===e?"HH:mm:ss":D.valueFormat||("datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),de=(0,_vue.computed)(function(){var e=D.modelValue,t=ae.value,a=ve.value,n=null;return e&&t&&(a=J(e,a),_xeUtils.default.isValidDate(a)&&(n=a)),n}),ce=(0,_vue.computed)(function(){var e=se.value,t=L.selectMonth;return!(!t||!e)&&t<=e}),fe=(0,_vue.computed)(function(){var e=oe.value,t=L.selectMonth;return!(!t||!e)&&e<=t}),pe=(0,_vue.computed)(function(){var e=L.datetimePanelValue;return e?_xeUtils.default.toDateString(e,"HH:mm:ss"):""}),_e=(0,_vue.computed)(function(){var e=de.value,t=ee.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),he=(0,_vue.computed)(function(){return ae.value?D.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat."+D.type):null}),me=(0,_vue.computed)(function(){var e=L.selectMonth,t=L.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=new Date(_xeUtils.default.toNumber((""+e.getFullYear()).replace(/\d{1}$/,"0")),0,1),l=-10;l<yearSize-10;l++){var i=_xeUtils.default.getWhatYear(u,l,"first"),r=i.getFullYear();a.push({date:i,isCurrent:!0,isNow:n===r,year:r})}return a}),xe=(0,_vue.computed)(function(){if(ae.value){var e=L.datePanelType,t=L.selectMonth,a=me.value,n="",u=void 0;return t&&(n=t.getFullYear(),u=t.getMonth()+1),"quarter"===e?_conf.default.i18n("vxe.input.date.quarterLabel",[n]):"month"===e?_conf.default.i18n("vxe.input.date.monthLabel",[n]):"year"===e?a.length?a[0].year+" - "+a[a.length-1].year:"":_conf.default.i18n("vxe.input.date.dayLabel",[n,u?_conf.default.i18n("vxe.input.date.m"+u):"-"])}return""}),ye=(0,_vue.computed)(function(){var e=D.startDay,t=D.startWeek;return _xeUtils.default.toNumber(_xeUtils.default.isNumber(e)||_xeUtils.default.isString(e)?e:t)}),ge=(0,_vue.computed)(function(){var e=[];if(ae.value){var t=ye.value;e.push(t);for(var a=0;a<6;a++)6<=t?t=0:t++,e.push(t)}return e}),be=(0,_vue.computed)(function(){return ae.value?ge.value.map(function(e){return{value:e,label:_conf.default.i18n("vxe.input.date.weeks.w"+e)}}):[]}),Ue=(0,_vue.computed)(function(){if(ae.value){var e=be.value;return[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(e)}return[]}),Ee=(0,_vue.computed)(function(){var e=me.value;return _xeUtils.default.chunk(e,4)}),Pe=(0,_vue.computed)(function(){var e=L.selectMonth,t=L.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=(0,_date.getDateQuarter)(t),l=_xeUtils.default.getWhatYear(e,0,"first"),i=l.getFullYear(),r=-2;r<quarterSize-2;r++){var s=_xeUtils.default.getWhatQuarter(l,r),o=s.getFullYear(),v=(0,_date.getDateQuarter)(s),d=o<i;a.push({date:s,isPrev:d,isCurrent:o===i,isNow:o===n&&v===u,isNext:!d&&i<o,quarter:v})}return a}),Se=(0,_vue.computed)(function(){var e=Pe.value;return _xeUtils.default.chunk(e,2)}),De=(0,_vue.computed)(function(){var e=L.selectMonth,t=L.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=t.getMonth(),l=_xeUtils.default.getWhatYear(e,0,"first").getFullYear(),i=-4;i<monthSize-4;i++){var r=_xeUtils.default.getWhatYear(e,0,i),s=r.getFullYear(),o=r.getMonth(),v=s<l;a.push({date:r,isPrev:v,isCurrent:s===l,isNow:s===n&&o===u,isNext:!v&&l<s,month:o})}return a}),Ne=(0,_vue.computed)(function(){var e=De.value;return _xeUtils.default.chunk(e,4)}),we=(0,_vue.computed)(function(){var e=L.selectMonth,t=L.currentDate,a=[];if(e&&t)for(var n=_e.value,u=ge.value,l=t.getFullYear(),i=t.getMonth(),r=t.getDate(),s=e.getFullYear(),o=e.getMonth(),t=e.getDay(),t=-u.indexOf(t),v=new Date(_xeUtils.default.getWhatDay(e,t).getTime()+n),d=0;d<42;d++){var c=_xeUtils.default.getWhatDay(v,d),f=c.getFullYear(),p=c.getMonth(),_=c.getDate(),h=c<e;a.push({date:c,isPrev:h,isCurrent:f===s&&p===o,isNow:f===l&&p===i&&_===r,isNext:!h&&o!==p,label:_})}return a}),Ve=(0,_vue.computed)(function(){var e=we.value;return _xeUtils.default.chunk(e,7)}),Te=(0,_vue.computed)(function(){var e=Ve.value,a=ye.value;return e.map(function(e){var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date,a)}].concat(e)})}),ke=(0,_vue.computed)(function(){var e=[];if(ee.value)for(var t=0;t<24;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),Me=(0,_vue.computed)(function(){var e=[];if(ee.value)for(var t=0;t<60;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),We=(0,_vue.computed)(function(){return Me.value}),Ye=(0,_vue.computed)(function(){var e=D.type,t=D.readonly,a=D.editable;return t||!a||"week"===e||"quarter"===e}),Ke=(0,_vue.computed)(function(){var e=D.type,t=L.showPwd,a=te.value,n=ae.value,u=ne.value;return n||a||u&&t||"number"===e?"text":e}),Ce=(0,_vue.computed)(function(){var e=D.placeholder;return e?(0,_utils.getFuncText)(e):""}),qe=(0,_vue.computed)(function(){var e=D.maxlength;return te.value&&!_xeUtils.default.toNumber(e)?16:e}),Ae=(0,_vue.computed)(function(){var e=D.type;return D.immediate||!("text"===e||"number"===e||"integer"===e||"float"===e)}),Fe=function(e){var t=D.type,a=D.exponential,n=qe.value,u=le.value,u="float"===t?(0,_number.toFloatValueFixed)(e,u):_xeUtils.default.toValueString(e);return!a||e!==u&&_xeUtils.default.toValueString(e).toLowerCase()!==_xeUtils.default.toNumber(u).toExponential()?u.slice(0,n):e},Re=function(e){var t=L.inputValue;X.dispatchEvent(e.type,{value:t},e)},Ie=function(e,t){L.inputValue=e,O("update:modelValue",e),X.dispatchEvent("input",{value:e},t),_xeUtils.default.toValueString(D.modelValue)!==e&&X.dispatchEvent("change",{value:e},t)},Oe=function(e,t){var a=ae.value,n=Ae.value;L.inputValue=e,a||(n?Ie(e,t):X.dispatchEvent("input",{value:e},t))},ze=function(e){var t;D.disabled||(t=L.inputValue,X.dispatchEvent("prefix-click",{value:t},e))},He=function(){L.visiblePanel=!1,F=window.setTimeout(function(){L.animatVisible=!1},350)},Le=function(e){var t;D.disabled||((0,_dom.hasClass)(e.currentTarget,"is--clear")?(Ie("",e),b(e,"")):(t=L.inputValue,X.dispatchEvent("suffix-click",{value:t},e)))},Ge=function(e){return null===D.max||_xeUtils.default.toNumber(e)<=_xeUtils.default.toNumber(D.max)},Be=function(e){return null===D.min||_xeUtils.default.toNumber(e)>=_xeUtils.default.toNumber(D.min)},Qe=function(){L.inputValue=L.datePanelLabel},je=function(e){e=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(e,L.selectMonth)||(L.selectMonth=e)},$e=function(e){var t,a=D.modelValue,n=L.datetimePanelValue,u=ee.value,l=ve.value,i=ye.value;"week"===D.type?(t=_xeUtils.default.toNumber(D.selectDay),e=_xeUtils.default.getWhatWeek(e,0,t,i)):u&&(e.setHours(n.getHours()),e.setMinutes(n.getMinutes()),e.setSeconds(n.getSeconds()));i=_xeUtils.default.toDateString(e,l,{firstDay:i});je(e),_xeUtils.default.isEqual(a,i)||Ie(i,{type:"update"})},Ze=function(){var e,t,a=D.type,n=D.min,u=D.max,l=D.exponential,i=L.inputValue,r=L.datetimePanelValue,s=te.value,o=ae.value,v=he.value;Ye.value||(s?i&&(t="integer"===a?_xeUtils.default.toInteger((0,_number.handleNumber)(i)):_xeUtils.default.toNumber((0,_number.handleNumber)(i)),Be(t)?Ge(t)||(t=u):t=n,!l||(e=_xeUtils.default.toValueString(i).toLowerCase())===_xeUtils.default.toNumber(t).toExponential()&&(t=e),Ie(Fe(t),{type:"check"})):o&&(i?(e=J(i,v),_xeUtils.default.isValidDate(e)?"time"===a?(i!==(e=_xeUtils.default.toDateString(e,v))&&Ie(e,{type:"check"}),L.inputValue=e):(t=!1,o=ye.value,"datetime"===a?(a=de.value,i===_xeUtils.default.toDateString(a,v)&&i===_xeUtils.default.toDateString(e,v)||(t=!0,r.setHours(e.getHours()),r.setMinutes(e.getMinutes()),r.setSeconds(e.getSeconds()))):t=!0,L.inputValue=_xeUtils.default.toDateString(e,v,{firstDay:o}),t&&$e(e)):Qe()):Ie("",{type:"check"})))},Xe=function(e){var t=D.readonly,a=D.disabled;clearTimeout(R),a||t||i(!1,e),X.dispatchEvent("next-number",{},e)},Je=function(e){var t=D.readonly,a=D.disabled;clearTimeout(R),a||t||i(!0,e),X.dispatchEvent("prev-number",{},e)},et=function(e){var t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN);(t||a)&&(e.preventDefault(),(t?Je:Xe)(e))},tt=function(e){var t=D.type,a=L.datePanelType,n=L.selectMonth;ce.value||(L.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):_xeUtils.default.getWhatYear(n,-1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,-1,"first"):_xeUtils.default.getWhatMonth(n,-1,"first"),X.dispatchEvent("date-prev",{type:t},e))},at=function(e){var t=D.type,a=L.datePanelType,n=L.selectMonth;fe.value||(L.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):_xeUtils.default.getWhatYear(n,1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,1,"first"):_xeUtils.default.getWhatMonth(n,1,"first"),X.dispatchEvent("date-next",{type:t},e))},nt=function(t){g({date:t})||(we.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMMdd")})||je(t),n(t))},ut=function(t){g({date:t})||(me.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||je(t),n(t))},lt=function(t){g({date:t})||(Pe.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyq")})||je(t),n(t))},it=function(t){g({date:t})||(De.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMM")})||je(t),n(t))},rt=function(){var e=D.disabled,t=L.visiblePanel,a=ae.value;e||t||(L.inited||(L.inited=!0),clearTimeout(F),L.isActivated=!0,L.animatVisible=!0,a&&(e=D.type,t=ee.value,a=de.value,-1<["year","quarter","month","week"].indexOf(e)?L.datePanelType=e:L.datePanelType="day",L.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(d(a,0),n(a)):c(),t&&(L.datetimePanelValue=L.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(function(){var e=j.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),_)}))),setTimeout(function(){L.visiblePanel=!0},10),L.panelIndex<(0,_utils.getLastZIndex)()&&(L.panelIndex=(0,_utils.nextZIndex)()),x())},st=function(e){D.readonly||(e.preventDefault(),rt())},ot=function(){var e=L.datePanelType,t=ce.value,a=fe.value,n=xe.value;return[(0,_vue.h)("div",{class:"vxe-input--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-input--date-picker-type-wrapper"},["year"===e?(0,_vue.h)("span",{class:"vxe-input--date-picker-label"},n):(0,_vue.h)("span",{class:"vxe-input--date-picker-btn",onClick:f},n)]),(0,_vue.h)("div",{class:"vxe-input--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",{"is--disabled":t}],onClick:tt},[(0,_vue.h)("i",{class:"vxe-icon--caret-left"})]),(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",onClick:p},[(0,_vue.h)("i",{class:"vxe-icon--dot"})]),(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-next-btn",{"is--disabled":a}],onClick:at},[(0,_vue.h)("i",{class:"vxe-icon--caret-right"})])])]),(0,_vue.h)("div",{class:"vxe-input--date-picker-body"},A())]},vt=function(){var a=L.datetimePanelValue,e=pe.value,t=ke.value,n=Me.value,u=We.value;return[(0,_vue.h)("div",{class:"vxe-input--time-picker-header"},[(0,_vue.h)("span",{class:"vxe-input--time-picker-title"},e),(0,_vue.h)("button",{class:"vxe-input--time-picker-confirm",type:"button",onClick:m},_conf.default.i18n("vxe.button.confirm"))]),(0,_vue.h)("div",{ref:j,class:"vxe-input--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-input--time-picker-hour-list"},t.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getHours()===t.value},onClick:function(e){return e=e,L.datetimePanelValue.setHours(t.value),void h(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-minute-list"},n.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getMinutes()===t.value},onClick:function(e){return e=e,L.datetimePanelValue.setMinutes(t.value),void h(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-second-list"},u.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getSeconds()===t.value},onClick:function(e){return e=e,L.datetimePanelValue.setSeconds(t.value),void h(e)}},t.label)}))])]},dt=function(){return(0,_vue.h)("span",{class:"vxe-input--number-suffix"},[(0,_vue.h)("span",{class:"vxe-input--number-prev is--prev",onMousedown:v,onMouseup:s,onMouseleave:s},[(0,_vue.h)("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.INPUT_PREV_NUM]})]),(0,_vue.h)("span",{class:"vxe-input--number-next is--next",onMousedown:v,onMouseup:s,onMouseleave:s},[(0,_vue.h)("i",{class:["vxe-input--number-next-icon",_conf.default.icon.INPUT_NEXT_NUM]})])])},ct=function(){return(0,_vue.h)("span",{class:"vxe-input--date-picker-suffix",onClick:st},[(0,_vue.h)("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.INPUT_DATE]})])},ft=function(){return(0,_vue.h)("span",{class:"vxe-input--search-suffix",onClick:l},[(0,_vue.h)("i",{class:["vxe-input--search-icon",_conf.default.icon.INPUT_SEARCH]})])},pt=function(){var e=L.showPwd;return(0,_vue.h)("span",{class:"vxe-input--password-suffix",onClick:a},[(0,_vue.h)("i",{class:["vxe-input--password-icon",e?_conf.default.icon.INPUT_SHOW_PWD:_conf.default.icon.INPUT_PWD]})])},X={dispatchEvent:function(e,t,a){O(e,Object.assign({$input:Z,$event:a},t))},focus:function(){var e=B.value;return L.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur:function(){return B.value.blur(),(L.isActivated=!1,_vue.nextTick)()}};Object.assign(Z,X),(0,_vue.watch)(function(){return D.modelValue},function(e){L.inputValue=e,u()}),(0,_vue.watch)(function(){return D.type},function(){Object.assign(L,{inputValue:D.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),t()}),(0,_vue.watch)(he,function(){ae.value&&(n(L.datePanelValue),L.inputValue=L.datePanelLabel)}),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(Z,"mousewheel",K),_event.GlobalEvent.on(Z,"mousedown",y),_event.GlobalEvent.on(Z,"keydown",S),_event.GlobalEvent.on(Z,"blur",C)}),(0,_vue.onUnmounted)(function(){s(),_event.GlobalEvent.off(Z,"mousewheel"),_event.GlobalEvent.off(Z,"mousedown"),_event.GlobalEvent.off(Z,"keydown"),_event.GlobalEvent.off(Z,"blur")}),t();return Z.renderVN=function(){var e,t,a,n,u,l,i,r=D.className,s=D.controls,o=D.type,v=D.align,d=D.name,c=D.disabled,f=D.readonly,p=D.autocomplete,_=L.inputValue,h=L.visiblePanel,m=L.isActivated,x=H.value,y=ae.value,g=Ye.value,b=qe.value,U=Ke.value,E=Ce.value,P=[],S=(u=D.prefixIcon,n=I.prefix,l=[],n?l.push((0,_vue.h)("span",{class:"vxe-input--prefix-icon"},n({}))):u&&l.push((0,_vue.h)("i",{class:["vxe-input--prefix-icon",u]})),l.length?(0,_vue.h)("span",{class:"vxe-input--prefix",onClick:ze},l):null),l=(e=D.disabled,t=D.suffixIcon,a=L.inputValue,n=I.suffix,u=re.value,l=[],n?l.push((0,_vue.h)("span",{class:"vxe-input--suffix-icon"},n({}))):t&&l.push((0,_vue.h)("i",{class:["vxe-input--suffix-icon",t]})),u&&l.push((0,_vue.h)("i",{class:["vxe-input--clear-icon",_conf.default.icon.INPUT_CLEAR]})),l.length?(0,_vue.h)("span",{class:["vxe-input--suffix",{"is--clear":u&&!e&&!(""===a||_xeUtils.default.eqNull(a))}],onClick:Le},l):null);return S&&P.push(S),P.push((0,_vue.h)("input",{ref:B,class:"vxe-input--inner",value:_,name:d,type:U,placeholder:E,maxlength:b,readonly:g,disabled:c,autocomplete:p,onKeydown:k,onKeyup:M,onWheel:W,onClick:Y,onInput:N,onChange:w,onFocus:V,onBlur:T})),l&&P.push(l),P.push((_=D.controls,d=te.value,U=ae.value,E=ne.value,b=ue.value,E?i=pt():d?_&&(i=dt()):U?i=ct():b&&(i=ft()),i?(0,_vue.h)("span",{class:"vxe-input--extra-suffix"},[i]):null)),y&&P.push((g=D.type,p=D.transfer,E=L.inited,d=L.animatVisible,_=L.visiblePanel,U=L.panelPlacement,b=L.panelStyle,i=H.value,y=[],ae.value?("datetime"===g?y.push((0,_vue.h)("div",{class:"vxe-input--panel-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-input--panel-left-wrapper"},ot()),(0,_vue.h)("div",{class:"vxe-input--panel-right-wrapper"},vt())])):"time"===g?y.push((0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},vt())):y.push((0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},ot())),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!p||!E},[(0,_vue.h)("div",{ref:Q,class:["vxe-table--ignore-clear vxe-input--panel","type--"+g,((g={})["size--"+i]=i,g["is--transfer"]=p,g["animat--leave"]=d,g["animat--enter"]=_,g)],placement:U,style:b},y)])):null)),(0,_vue.h)("div",{ref:G,class:["vxe-input","type--"+o,r,((r={})["size--"+x]=x,r["is--"+v]=v,r["is--controls"]=s,r["is--prefix"]=!!S,r["is--suffix"]=!!l,r["is--readonly"]=f,r["is--visivle"]=h,r["is--disabled"]=c,r["is--active"]=m,r)]},P)},Z},render:function(){return this.renderVN()}});exports.default=_default2;