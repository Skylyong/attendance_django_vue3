"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("../../table/src/util"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,o=arguments.length;t<o;t++)for(var r in l=arguments[t])Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);return e}).apply(this,arguments)},renderType="footer";function mergeFooterMethod(e,l,t){for(var o=0;o<e.length;o++){var r=e[o],n=r.row,a=r.col,u=r.rowspan,r=r.colspan;if(-1<a&&-1<n&&u&&r){if(n===l&&a===t)return{rowspan:u,colspan:r};if(n<=l&&l<n+u&&a<=t&&t<a+r)return{rowspan:0,colspan:0}}}}var _default2=(0,_vue.defineComponent)({name:"VxeTableFooter",props:{footerTableData:{type:Array,default:function(){return[]}},tableColumn:{type:Array,default:function(){return[]}},fixedColumn:{type:Array,default:function(){return[]}},fixedType:{type:String,default:null}},setup:function(i){function n(e){var l=i.fixedType,t=s.scrollXLoad,o=c.lastScrollLeft,r=p.value,n=f.value,a=d.value,u=n?n.$el:null,n=x.value,a=a.$el,o=(n=n.scrollLeft)!==o;c.lastScrollLeft=n,c.lastScrollTime=Date.now(),u&&(u.scrollLeft=n),a&&(a.scrollLeft=n),t&&o&&E.triggerScrollXEvent(e),o&&r&&r.reactData.visible&&r.updatePlacement(),E.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:a.scrollTop,scrollLeft:n,isX:o,isY:!1},e)}var E=(0,_vue.inject)("$xetable",{}),a=E.xID,u=E.props,s=E.reactData,c=E.internalData,e=E.getRefMaps(),f=e.refTableHeader,d=e.refTableBody,p=e.refValidTooltip,e=E.getComputeMaps(),v=e.computeTooltipOpts,_=e.computeColumnOpts,x=(0,_vue.ref)(),g=(0,_vue.ref)(),m=(0,_vue.ref)(),y=(0,_vue.ref)(),h=(0,_vue.ref)();(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=i.fixedType,l=c.elemStore,e=(e||"main")+"-footer-";l[e+"wrapper"]=x.value,l[e+"table"]=g.value,l[e+"colgroup"]=m.value,l[e+"list"]=y.value,l[e+"xSpace"]=h.value})}),(0,_vue.onUnmounted)(function(){var e=i.fixedType,l=c.elemStore,e=(e||"main")+"-footer-";l[e+"wrapper"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null});return function(){var w=i.fixedType,e=i.fixedColumn,T=i.tableColumn,C=i.footerTableData,l=u.footerRowClassName,I=u.footerCellClassName,t=u.footerRowStyle,S=u.footerCellStyle,F=u.footerAlign,D=u.footerSpanMethod,L=u.align,M=u.columnKey,O=u.showFooterOverflow,o=c.visibleColumn,$=s.scrollYLoad,U=s.overflowX,r=s.scrollbarWidth,k=s.currentColumn,j=s.mergeFooterList,q=v.value,A=_.value;return w&&(T=!$&&!O||j.length&&D?o:e),(0,_vue.h)("div",{ref:x,class:["vxe-table--footer-wrapper",w?"fixed-"+w+"--wrapper":"body--wrapper"],xid:a,onScroll:n},[w?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:h,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:g,class:"vxe-table--footer",xid:a,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:m},T.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})}).concat(r?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("tfoot",{ref:y},C.map(function(y,h){var b=h;return(0,_vue.h)("tr",{class:["vxe-footer--row",l?_xeUtils.default.isFunction(l)?l({$table:E,_rowIndex:h,$rowIndex:b,fixed:w,type:renderType}):l:""],style:t?_xeUtils.default.isFunction(t)?t({$table:E,_rowIndex:h,$rowIndex:b,fixed:w,type:renderType}):t:null},T.map(function(l,e){var t=l.type,o=l.showFooterOverflow,r=l.footerAlign,n=l.align,a=l.footerClassName,u=q.showAll,i=l.children&&l.children.length,s=w?l.fixed!==w&&!i:l.fixed&&U,c=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?O:o,f=r||n||F||L,d="ellipsis"===c,p="title"===c,v=!0===c||"tooltip"===c,i=p||v||d,o={colid:l.id},r={},n=E.getColumnIndex(l),c=E.getVTColumnIndex(l),_={$table:E,_rowIndex:h,$rowIndex:b,column:l,columnIndex:n,$columnIndex:e,_columnIndex:c,itemIndex:c,items:y,fixed:w,type:renderType,data:C};if($&&!i&&(d=i=!0),(p||v||u)&&(r.onMouseenter=function(e){p?(0,_dom.updateCellTitle)(e.currentTarget,l):(v||u)&&E.triggerFooterTooltipEvent(e,_)}),(v||u)&&(r.onMouseleave=function(e){(v||u)&&E.handleTargetLeaveEvent(e)}),r.onClick=function(e){E.dispatchEvent("footer-cell-click",Object.assign({cell:e.currentTarget},_),e)},r.onDblclick=function(e){E.dispatchEvent("footer-cell-dblclick",Object.assign({cell:e.currentTarget},_),e)},j.length){var x=mergeFooterMethod(j,h,c);if(x){var g=x.rowspan,m=x.colspan;if(!g||!m)return null;1<g&&(o.rowspan=g),1<m&&(o.colspan=m)}}else if(D){var c=D(_)||{},x=c.rowspan,g=void 0===x?1:x,c=c.colspan,m=void 0===c?1:c;if(!g||!m)return null;1<g&&(o.rowspan=g),1<m&&(o.colspan=m)}return(0,_vue.h)("td",__assign(__assign(__assign(__assign({class:["vxe-footer--column",l.id,((m={})["col--"+f]=f,m["col--"+t]=t,m["col--last"]=e===T.length-1,m["fixed--hidden"]=s,m["col--ellipsis"]=i,m["col--current"]=k===l,m),(0,_util.getPropClass)(a,_),(0,_util.getPropClass)(I,_)]},o),{style:S?_xeUtils.default.isFunction(S)?S(_):S:null}),r),{key:M||A.useKey?l.id:e}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":p,"c--tooltip":v,"c--ellipsis":d}]},l.renderFooter(_))])}).concat(r?[(0,_vue.h)("td",{class:"vxe-footer--gutter col--gutter"})]:[]))}))])])}}});exports.default=_default2;