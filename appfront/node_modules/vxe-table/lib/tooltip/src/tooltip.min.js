"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},_default2=(0,_vue.defineComponent)({name:"VxeTooltip",props:{modelValue:Boolean,size:{type:String,default:function(){return _conf.default.tooltip.size||_conf.default.size}},trigger:{type:String,default:function(){return _conf.default.tooltip.trigger}},theme:{type:String,default:function(){return _conf.default.tooltip.theme}},content:{type:[String,Number],default:null},useHTML:Boolean,zIndex:[String,Number],isArrow:{type:Boolean,default:!0},enterable:Boolean,enterDelay:{type:Number,default:function(){return _conf.default.tooltip.enterDelay}},leaveDelay:{type:Number,default:function(){return _conf.default.tooltip.leaveDelay}}},emits:["update:modelValue"],setup:function(a,e){function n(){var e,t,n,i,o,r,l,u,a,c=d.tipTarget,s=d.tipStore;c&&(e=(l=(0,_dom.getDomNode)()).scrollTop,t=l.scrollLeft,n=l.visibleWidth,i=(a=(0,_dom.getAbsolutePos)(c)).top,o=a.left,r=(u=_.value).offsetHeight,l=u.offsetWidth,a=o,u=i-r-6,t+n<(a=Math.max(6,o+Math.floor((c.offsetWidth-l)/2)))+l+6&&(a=t+n-l-6),i-r<e+6&&(s.placement="bottom",u=i+c.offsetHeight+6),s.style.top=u+"px",s.style.left=a+"px",s.arrowStyle.left=o-a+c.offsetWidth/2+"px")}function i(e){e!==d.visible&&(d.visible=e,d.isUpdate=!0,f("update:modelValue",e))}function r(){d.visible?x.close():x.open()}function l(){x.open()}function u(){var e=a.trigger,t=a.enterable,n=a.leaveDelay;d.tipActive=!1,t&&"hover"===e?setTimeout(function(){d.tipActive||x.close()},n):x.close()}function c(){d.tipActive=!0}function s(){var e=a.trigger,t=a.enterable,n=a.leaveDelay;d.tipActive=!1,t&&"hover"===e&&setTimeout(function(){d.tipActive||x.close()},n)}function o(){var e=d.tipStore,t=_.value;return t&&(t.parentNode||document.body.appendChild(t)),i(!0),d.tipZindex<(0,_utils.getLastZIndex)()&&(d.tipZindex=(0,_utils.nextZIndex)()),e.placement="top",e.style={width:"auto",left:0,top:0,zIndex:a.zIndex||d.tipZindex},e.arrowStyle={left:"50%"},x.updatePlacement()}var p=e.slots,f=e.emit,t=_xeUtils.default.uniqueId(),v=(0,_size.useSize)(a),d=(0,_vue.reactive)({target:null,isUpdate:!1,visible:!1,tipContent:"",tipActive:!1,tipTarget:null,tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:{}}}),_=(0,_vue.ref)(),g={refElem:_},m={xID:t,props:a,context:e,reactData:d,getRefMaps:function(){return g}},x={},h=_xeUtils.default.debounce(function(){d.tipActive&&o()},a.enterDelay,{leading:!1,trailing:!0}),x={dispatchEvent:function(e,t,n){f(e,Object.assign({$tooltip:m,$event:n},t))},open:function(e,t){return x.toVisible(e||d.target,t)},close:function(){return d.tipTarget=null,d.tipActive=!1,Object.assign(d.tipStore,{style:{},placement:"",arrowStyle:null}),i(!1),(0,_vue.nextTick)()},toVisible:function(e,t){if(e){var n=a.trigger,i=a.enterDelay;if(d.tipActive=!0,d.tipTarget=e,t&&(d.tipContent=t),!i||"hover"!==n)return o();h()}return(0,_vue.nextTick)()},updatePlacement:function(){return(0,_vue.nextTick)().then(function(){var e=d.tipTarget,t=_.value;if(e&&t)return n(),(0,_vue.nextTick)().then(n)})},isActived:function(){return d.tipActive},setActived:function(e){d.tipActive=!!e}};Object.assign(m,x),(0,_vue.watch)(function(){return a.content},function(){d.tipContent=a.content}),(0,_vue.watch)(function(){return a.modelValue},function(){d.isUpdate||(a.modelValue?x.open():x.close()),d.isUpdate=!1}),(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=a.trigger,t=a.content,n=a.modelValue,i=_.value,o=i.parentNode;o&&(d.tipContent=t,d.tipZindex=(0,_utils.nextZIndex)(),_xeUtils.default.arrayEach(i.children,function(e,t){1<t&&(o.insertBefore(e,i),d.target||(d.target=e))}),o.removeChild(i),(t=d.target)&&("hover"===e?(t.onmouseenter=l,t.onmouseleave=u):"click"===e&&(t.onclick=r)),n&&x.open())})}),(0,_vue.onBeforeUnmount)(function(){var e,t=a.trigger,n=d.target,i=_.value;!i||(e=i.parentNode)&&e.removeChild(i),n&&("hover"===t?(n.onmouseenter=null,n.onmouseleave=null):"click"===t&&(n.onclick=null))});return m.renderVN=function(){var e,t=a.theme,n=a.isArrow,i=a.enterable,o=d.tipActive,r=d.visible,l=d.tipStore,u=v.value;return i&&(e={onMouseenter:c,onMouseleave:s}),(0,_vue.h)("div",__assign({ref:_,class:["vxe-table--tooltip-wrapper","theme--"+t,((t={})["size--"+u]=u,t["placement--"+l.placement]=l.placement,t["is--enterable"]=i,t["is--visible"]=r,t["is--arrow"]=n,t["is--actived"]=o,t)],style:l.style},e),[(t=a.useHTML,e=d.tipContent,p.content?(0,_vue.h)("div",{key:1,class:"vxe-table--tooltip-content"},p.content({})):t?(0,_vue.h)("div",{key:2,class:"vxe-table--tooltip-content",innerHTML:e}):(0,_vue.h)("div",{key:3,class:"vxe-table--tooltip-content"},(0,_utils.formatText)(e))),(0,_vue.h)("div",{class:"vxe-table--tooltip-arrow",style:l.arrowStyle})].concat(p.default?p.default({}):[]))},m},render:function(){return this.renderVN()}});exports.default=_default2;