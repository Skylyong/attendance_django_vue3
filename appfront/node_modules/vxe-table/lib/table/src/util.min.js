"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assemColumn=assemColumn,exports.clearTableAllStatus=clearTableAllStatus,exports.clearTableDefaultStatus=clearTableDefaultStatus,exports.colToVisible=colToVisible,exports.createColumn=createColumn,exports.destroyColumn=destroyColumn,exports.getCellValue=getCellValue,exports.getColMinWidth=getColMinWidth,exports.getPropClass=getPropClass,exports.getRowUniqueId=getRowUniqueId,exports.getRowid=getRowid,exports.getRowkey=getRowkey,exports.handleFieldOrColumn=void 0,exports.isColumnInfo=isColumnInfo,exports.mergeBodyMethod=mergeBodyMethod,exports.removeScrollListener=removeScrollListener,exports.restoreScrollListener=restoreScrollListener,exports.restoreScrollLocation=restoreScrollLocation,exports.rowToVisible=rowToVisible,exports.setCellValue=setCellValue,exports.toFilters=toFilters,exports.toTreePathSeq=toTreePathSeq,exports.watchColumn=watchColumn;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_columnInfo=require("./columnInfo"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function restoreScrollLocation(e,t,l){var r=e.internalData;return e.clearScroll().then(function(){if(t||l)return r.lastScrollLeft=0,r.lastScrollTop=0,e.scrollTo(t,l)})}function removeScrollListener(e){e&&e._onscroll&&(e.onscroll=null)}function restoreScrollListener(e){e&&e._onscroll&&(e.onscroll=e._onscroll)}function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function getRowkey(e){var t=e.props,e=e.getComputeMaps().computeRowOpts,t=t.rowId,e=e.value;return t||e.keyField||"_X_ROW_KEY"}function getRowid(e,t){e=_xeUtils.default.get(t,getRowkey(e));return _xeUtils.default.eqNull(e)?"":encodeURIComponent(e)}var handleFieldOrColumn=function(e,t){return t?_xeUtils.default.isString(t)?e.getColumnByField(t):t:null};function getPaddingLeftRightSize(e){if(e){e=getComputedStyle(e);return _xeUtils.default.toNumber(e.paddingLeft)+_xeUtils.default.toNumber(e.paddingRight)}return 0}function getElemenMarginWidth(e){if(e){var t=getComputedStyle(e),l=_xeUtils.default.toNumber(t.marginLeft),t=_xeUtils.default.toNumber(t.marginRight);return e.offsetWidth+l+t}return 0}function queryCellElement(e,t){return e.querySelector(".vxe-cell"+t)}function toFilters(e){return e&&_xeUtils.default.isArray(e)?e.map(function(e){var t=e.label,l=e.value,r=e.data,o=e.resetValue,e=e.checked;return{label:t,value:l,data:r,resetValue:o,checked:!!e,_checked:!!e}}):e}function toTreePathSeq(e){return e.map(function(e,t){return t%2==0?Number(e)+1:"."}).join("")}function getCellValue(e,t){return _xeUtils.default.get(e,t.property)}function setCellValue(e,t,l){return _xeUtils.default.set(e,t.property,l)}function getPropClass(e,t){return e?_xeUtils.default.isFunction(e)?e(t):e:""}function getColMinWidth(e){var t=e.$table,l=e.column,r=e.cell,o=t.props,n=t.getComputeMaps().computeResizableOpts.value.minWidth;if(n){var i=_xeUtils.default.isFunction(n)?n(e):n;if("auto"!==i)return Math.max(1,_xeUtils.default.toNumber(i))}var a=o.showHeaderOverflow,u=l.showHeaderOverflow,e=l.minWidth,n=_xeUtils.default.isUndefined(u)||_xeUtils.default.isNull(u)?a:u,i="title"===n||(!0===n||"tooltip"===n)||"ellipsis"===n,o=_xeUtils.default.floor(1.6*(_xeUtils.default.toNumber(getComputedStyle(r).fontSize)||14))+(getPaddingLeftRightSize(r)+getPaddingLeftRightSize(queryCellElement(r,"")));if(i&&(l=getPaddingLeftRightSize(queryCellElement(r,"--title>.vxe-cell--checkbox")),a=getElemenMarginWidth(queryCellElement(r,">.vxe-cell--required-icon")),u=getElemenMarginWidth(queryCellElement(r,">.vxe-cell--edit-icon")),n=getElemenMarginWidth(queryCellElement(r,">.vxe-cell-help-icon")),i=getElemenMarginWidth(queryCellElement(r,">.vxe-cell--sort")),o+=l+a+u+n+getElemenMarginWidth(queryCellElement(r,">.vxe-cell--filter"))+i),e){t=t.getRefMaps().refTableBody.value,t=t?t.$el:null;if(t){if((0,_dom.isScale)(e)){t=(t.clientWidth-1)/100;return Math.max(o,Math.floor(_xeUtils.default.toInteger(e)*t))}if((0,_dom.isPx)(e))return Math.max(o,_xeUtils.default.toInteger(e))}}return o}function isColumnInfo(e){return e&&(e.constructor===_columnInfo.ColumnInfo||e instanceof _columnInfo.ColumnInfo)}function createColumn(e,t,l){return isColumnInfo(t)?t:new _columnInfo.ColumnInfo(e,t,l)}function watchColumn(e,l){Object.keys(e).forEach(function(t){(0,_vue.watch)(function(){return e[t]},function(e){l.update(t,e)})})}function assemColumn(e,t,l,r){var o=e.reactData,n=o.staticColumns,e=t.parentNode,r=r?r.column:null,r=r?r.children:n;e&&r&&(r.splice(_xeUtils.default.arrayIndexOf(e.children,t),0,l),o.staticColumns=n.slice(0))}function destroyColumn(e,t){var l=e.reactData,r=l.staticColumns,e=_xeUtils.default.findTree(r,function(e){return e.id===t.id},{children:"children"});e&&e.items.splice(e.index,1),l.staticColumns=r.slice(0)}function mergeBodyMethod(e,t,l){for(var r=0;r<e.length;r++){var o=e[r],n=o.row,i=o.col,a=o.rowspan,o=o.colspan;if(-1<i&&-1<n&&a&&o){if(n===t&&i===l)return{rowspan:a,colspan:o};if(n<=t&&t<n+a&&i<=l&&l<i+o)return{rowspan:0,colspan:0}}}}function clearTableDefaultStatus(e){var t=e.props;return e.internalData.initStatus=!1,e.clearSort(),e.clearCurrentRow(),e.clearCurrentColumn(),e.clearRadioRow(),e.clearRadioReserve(),e.clearCheckboxRow(),e.clearCheckboxReserve(),e.clearRowExpand(),e.clearTreeExpand(),e.clearTreeExpandReserve(),e.clearFilter&&e.clearFilter(),e.clearSelected&&(t.keyboardConfig||t.mouseConfig)&&e.clearSelected(),e.clearCellAreas&&t.mouseConfig&&(e.clearCellAreas(),e.clearCopyCellArea()),e.clearScroll()}function clearTableAllStatus(e){return e.clearFilter&&e.clearFilter(),clearTableDefaultStatus(e)}function rowToVisible(e,t){var l=e.reactData,r=e.internalData,o=e.getRefMaps().refTableBody,n=l.scrollYLoad,i=r.afterFullData,a=r.scrollYStore,u=o.value,l=u?u.$el:null;if(l){r=l.querySelector('[rowid="'+getRowid(e,t)+'"]');if(r){o=l.clientHeight,u=l.scrollTop,l=r.offsetParent,l=r.offsetTop+(l?l.offsetTop:0),r=r.clientHeight;if(l<u||u+o<l)return e.scrollTo(null,l);if(o+u<=l+r)return e.scrollTo(null,u+r)}else if(n)return e.scrollTo(null,(i.indexOf(t)-1)*a.rowHeight)}return Promise.resolve()}function colToVisible(e,t){var l=e.reactData,r=e.internalData,o=e.getRefMaps().refTableBody,n=l.scrollXLoad,i=r.visibleColumn,a=o.value,l=a?a.$el:null;if(l){r=l.querySelector("."+t.id);if(r){o=l.clientWidth,a=l.scrollLeft,l=r.offsetParent,l=r.offsetLeft+(l?l.offsetLeft:0),r=r.clientWidth;if(l<a||a+o<l)return e.scrollTo(l);if(o+a<=l+r)return e.scrollTo(a+r)}else if(n){for(var u=0,s=0;s<i.length&&i[s]!==t;s++)u+=i[s].renderWidth;return e.scrollTo(u)}}return Promise.resolve()}exports.handleFieldOrColumn=handleFieldOrColumn;