"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_util=require("./util"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,o=arguments.length;t<o;t++)for(var r in l=arguments[t])Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);return e}).apply(this,arguments)},__spreadArray=function(e,l){for(var t=0,o=l.length,r=e.length;t<o;t++,r++)e[r]=l[t];return e},renderType="body",lineOffsetSizes={mini:3,small:2,medium:1},_default=(0,_vue.defineComponent)({name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(_){function u(){if(l){var e=l.value;if(e)return lineOffsetSizes[e]||0}return 0}function c(e,l){var t=1;if(!e)return t;var o=e[B.value.children];if(ae.isTreeExpandByRow(e))for(var r=0;r<o.length;r++)t+=c(o[r],l);return t}function re(e){var l=e.row,t=e.column,o=ne.treeConfig,r=B.value,a=t.slots,n=t.treeNode,i=se.fullAllDataRowIdData[(0,_util.getRowid)(ae,l)],s=0,t=0,l=[];return i&&(s=i.level,t=i._index,l=i.items),a&&a.line?ae.callSlot(a.line,e):o&&n&&r.line?[(0,_vue.h)("div",{class:"vxe-tree--line-wrapper"},[(0,_vue.h)("div",{class:"vxe-tree--line",style:{height:(n=e,e=l,l=1,(t=t)&&(l=c(e[t-1],n)),ie.rowHeight*l-(t?1:12-u())+"px"),left:s*r.indent+(s?2-u():0)+16+"px"}})])]:[]}function q(d,v,p){var f=ne.stripe,h=ne.rowKey,x=ne.highlightHoverRow,g=ne.rowClassName,_=ne.rowStyle,m=ne.showOverflow,y=ne.editConfig,w=ne.treeConfig,b=ie.hasFixedColumn,T=ie.treeExpandeds,S=ie.scrollYLoad,C=ie.editStore,L=ie.rowExpandeds,O=ie.expandColumn,R=ie.selectRow,H=se.fullAllDataRowIdData,E=ve.value,I=t.value,D=B.value,M=ue.value,$=fe.value,k=D.transform,U=[];return v.forEach(function(t,o){var e={},r=ae.getRowIndex(t);($.isHover||x)&&(e.onMouseenter=function(e){xe()||ae.triggerHoverEvent(e,{row:t,rowIndex:r})},e.onMouseleave=function(){xe()||ae.clearHoverRow()});var a=(0,_util.getRowid)(ae,t),l=H[a],n=0,i=-1,s=0;l&&(n=l.level,i=l.seq,s=l._index);var u,c={$table:ae,seq:i,rowid:a,fixed:d,type:renderType,level:n,row:t,rowIndex:r,$rowIndex:o,_rowIndex:s},l=!1;y&&(l=-1<ae.findRowIndexOf(C.insertList,t)),U.push((0,_vue.h)("tr",__assign({class:["vxe-body--row",{"row--stripe":f&&(ae.getVTRowIndex(t)+1)%2==0,"is--new":l,"row--new":l&&(M.showStatus||M.showInsertStatus),"row--radio":I.highlight&&R===t,"row--checked":E.highlight&&ae.isCheckedByCheckboxRow(t)},g?_xeUtils.default.isFunction(g)?g(c):g:""],rowid:a,style:_?_xeUtils.default.isFunction(_)?_(c):_:null,key:h||$.useKey||w?a:o},e),p.map(function(e,l){return A(i,a,d,n,t,r,o,s,e,l,p,v)}))),O&&L.length&&-1<ae.findRowIndexOf(L,t)&&(l=void 0,w&&(l={paddingLeft:n*D.indent+30+"px"}),u=O.showOverflow,c=_xeUtils.default.isUndefined(u)||_xeUtils.default.isNull(u)?m:u,u={$table:ae,seq:i,column:O,fixed:d,type:renderType,level:n,row:t,rowIndex:r,$rowIndex:o,_rowIndex:s},U.push((0,_vue.h)("tr",__assign({class:"vxe-body--expanded-row",key:"expand_"+a,style:_?_xeUtils.default.isFunction(_)?_(u):_:null},e),[(0,_vue.h)("td",{class:["vxe-body--expanded-column",{"fixed--hidden":d&&!b,"col--ellipsis":c}],colspan:p.length},[(0,_vue.h)("div",{class:"vxe-body--expanded-cell",style:l},[O.renderData(u)])])]))),!w||S||k||!T.length||(u=t[D.children])&&u.length&&-1<ae.findRowIndexOf(T,t)&&U.push.apply(U,q(d,u,p))}),U}function m(e,l,t,o){(t||o)&&(t&&((0,_util.removeScrollListener)(t),t.scrollTop=l),o&&((0,_util.removeScrollListener)(o),o.scrollTop=l),clearTimeout(r),r=setTimeout(function(){(0,_util.restoreScrollListener)(t),(0,_util.restoreScrollListener)(o)},300))}function o(e){var l=_.fixedType,t=ne.highlightHoverRow,o=ie.scrollXLoad,r=ie.scrollYLoad,a=se.elemStore,n=se.lastScrollTop,i=se.lastScrollLeft,s=fe.value,u=b.value,c=T.value,d=S.value,v=C.value,p=L.value,f=O.value,h=I.value,x=u?u.$el:null,g=d?d.$el:null,u=c.$el,d=v?v.$el:null,c=p?p.$el:null,v=a["main-body-ySpace"],p=a["main-body-xSpace"],a=(r&&v?v:u).clientHeight,v=(o&&p?p:u).clientWidth,p=h.scrollTop,i=(h=u.scrollLeft)!==i,n=p!==n;se.lastScrollTop=p,se.lastScrollLeft=h,se.lastScrollTime=Date.now(),(s.isHover||t)&&ae.clearHoverRow(),d&&"left"===l?(p=d.scrollTop,m(0,p,u,c)):c&&"right"===l?(p=c.scrollTop,m(0,p,u,d)):(i&&(x&&(x.scrollLeft=u.scrollLeft),g&&(g.scrollLeft=u.scrollLeft)),(d||c)&&(ae.checkScrolling(),n&&m(0,p,d,c))),o&&i&&ae.triggerScrollXEvent(e),r&&n&&ae.triggerScrollYEvent(e),i&&f&&f.reactData.visible&&f.updatePlacement(),ae.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:p,scrollLeft:h,scrollHeight:u.scrollHeight,scrollWidth:u.scrollWidth,bodyHeight:a,bodyWidth:v,isX:i,isY:n},e)}function g(e){var l=e.deltaY,t=e.deltaX,o=ne.highlightHoverRow,r=ie.scrollYLoad,a=se.lastScrollTop,n=se.lastScrollLeft,i=fe.value,s=T.value,u=I.value,c=s.$el;((l=(s=l)<0)?u.scrollTop<=0:u.scrollTop>=u.scrollHeight-u.clientHeight)||(u=u.scrollTop+s,n=(t=c.scrollLeft+t)!==n,(a=u!==a)&&(e.preventDefault(),se.lastScrollTop=u,se.lastScrollLeft=t,se.lastScrollTime=Date.now(),(i.isHover||o)&&ae.clearHoverRow(),d(e,l,s,n,a),r&&ae.triggerScrollYEvent(e)))}var r,x,ae=(0,_vue.inject)("$xetable",{}),l=(0,_vue.inject)("xesize",null),y=ae.xID,ne=ae.props,w=ae.context,ie=ae.reactData,se=ae.internalData,e=ae.getRefMaps(),b=e.refTableHeader,T=e.refTableBody,S=e.refTableFooter,C=e.refTableLeftBody,L=e.refTableRightBody,O=e.refValidTooltip,e=ae.getComputeMaps(),ue=e.computeEditOpts,R=e.computeMouseOpts,ce=e.computeSYOpts,H=e.computeEmptyOpts,E=e.computeKeyboardOpts,de=e.computeTooltipOpts,t=e.computeRadioOpts,B=e.computeTreeOpts,ve=e.computeCheckboxOpts,pe=e.computeValidOpts,fe=e.computeRowOpts,he=e.computeColumnOpts,I=(0,_vue.ref)(),D=(0,_vue.ref)(),M=(0,_vue.ref)(),$=(0,_vue.ref)(),k=(0,_vue.ref)(),U=(0,_vue.ref)(),Y=(0,_vue.ref)(),xe=function(){var e=ne.delayHover,l=se.lastScrollTime;return se._isResize||l&&Date.now()<l+e},A=function(e,l,t,o,r,a,n,i,s,u,c,d){var v,p=ne.columnKey,f=ne.height,h=ne.showOverflow,x=ne.cellClassName,g=ne.cellStyle,_=ne.align,m=ne.spanMethod,y=ne.mouseConfig,w=ne.editConfig,b=ne.editRules,T=ne.tooltipConfig,S=ie.tableData,C=ie.overflowX,L=ie.scrollYLoad,O=ie.currentColumn,R=ie.mergeList,H=ie.editStore,E=ie.validStore,I=ie.isAllOverflow,D=se.afterFullData,M=pe.value,$=ve.value,k=ue.value,U=de.value,q=fe.value,B=ce.value,Y=he.value,A=s.type,W=s.cellRender,X=s.editRender,j=s.align,N=s.showOverflow,F=s.className,V=s.treeNode,K=H.actived,P=B.rHeight,z=q.height,G=U.showAll,J=ae.getColumnIndex(s),H=ae.getVTColumnIndex(s),B=(0,_utils.isEnableConf)(X),q=t?s.fixed!==t:s.fixed&&C,U=_xeUtils.default.isUndefined(N)||_xeUtils.default.isNull(N)?h:N,C="ellipsis"===U,Q="title"===U,Z=!0===U||"tooltip"===U,N=Q||Z||C,U={},j=j||_,_=E.row===r&&E.column===s,f=b&&M.showMessage&&("default"===M.message?f||1<S.length:"inline"===M.message),M={colid:s.id},ee={$table:ae,seq:e,rowid:l,row:r,rowIndex:a,$rowIndex:n,_rowIndex:i,column:s,columnIndex:J,$columnIndex:u,_columnIndex:H,fixed:t,type:renderType,isHidden:q,level:o,visibleData:D,data:S,items:d};if(L&&!N&&(C=N=!0),(Q||Z||G||T)&&(U.onMouseenter=function(e){xe()||(Q?(0,_dom.updateCellTitle)(e.currentTarget,s):(Z||G)&&ae.triggerBodyTooltipEvent(e,ee),ae.dispatchEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},ee),e))}),(Z||G||T)&&(U.onMouseleave=function(e){xe()||((Z||G)&&ae.handleTargetLeaveEvent(e),ae.dispatchEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},ee),e))}),($.range||y)&&(U.onMousedown=function(e){ae.triggerCellMousedownEvent(e,ee)}),U.onClick=function(e){ae.triggerCellClickEvent(e,ee)},U.onDblclick=function(e){ae.triggerCellDblclickEvent(e,ee)},R.length){var le=(0,_util.mergeBodyMethod)(R,i,H);if(le){var te=le.rowspan,oe=le.colspan;if(!te||!oe)return null;1<te&&(M.rowspan=te),1<oe&&(M.colspan=oe)}}else if(m){le=m(ee)||{},m=le.rowspan,te=void 0===m?1:m,le=le.colspan,oe=void 0===le?1:le;if(!te||!oe)return null;1<te&&(M.rowspan=te),1<oe&&(M.colspan=oe)}!(q=q&&R&&(1<M.colspan||1<M.rowspan)?!1:q)&&w&&(X||W)&&(k.showStatus||k.showUpdateStatus)&&(v=ae.isUpdateByRow(r,s.property));W=[];return q&&h&&I?W.push((0,_vue.h)("div",{class:["vxe-cell",{"c--title":Q,"c--tooltip":Z,"c--ellipsis":C}],style:{maxHeight:N&&(P||z)?(P||z)+"px":""}})):(W.push.apply(W,__spreadArray(__spreadArray([],re(ee)),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":Q,"c--tooltip":Z,"c--ellipsis":C}],style:{maxHeight:N&&(P||z)?(P||z)+"px":""},title:Q?ae.getCellLabel(r,s):null},s.renderCell(ee))])),f&&_&&W.push((0,_vue.h)("div",{class:"vxe-cell--valid",style:E.rule&&E.rule.maxWidth?{width:E.rule.maxWidth+"px"}:null},[(0,_vue.h)("span",{class:"vxe-cell--valid-msg"},E.content)]))),(0,_vue.h)("td",__assign(__assign(__assign({class:["vxe-body--column",s.id,((E={})["col--"+j]=j,E["col--"+A]=A,E["col--last"]=u===c.length-1,E["col--tree-node"]=V,E["col--edit"]=B,E["col--ellipsis"]=N,E["fixed--hidden"]=q,E["col--dirty"]=v,E["col--actived"]=w&&B&&K.row===r&&(K.column===s||"row"===k.mode),E["col--valid-error"]=_,E["col--current"]=O===s,E),(0,_util.getPropClass)(F,ee),(0,_util.getPropClass)(x,ee)],key:p||Y.useKey?s.id:u},M),{style:Object.assign({height:N&&(P||z)?(P||z)+"px":""},g?_xeUtils.default.isFunction(g)?g(ee):g:null)}),U),W)},W=0,X=0,j=0,N=!1,d=function(a,n,e,i,s){var l=se.elemStore,t=ie.scrollXLoad,o=ie.scrollYLoad,r=T.value,u=C.value,c=L.value,d=u?u.$el:null,v=c?c.$el:null,p=r.$el,r=l["main-body-ySpace"],l=l["main-body-xSpace"],f=(o&&r?r:p).clientHeight,h=(t&&l?l:p).clientWidth,l=N===n?Math.max(0,W-j):0;N=n,W=Math.abs(n?e-l:e+l),j=X=0,clearTimeout(x),function e(){var l,t,o,r;j<W&&(l=_.fixedType,X=Math.max(5,Math.floor(1.5*X)),W<(j+=X)&&(X-=j-W),r=p.scrollTop,t=p.clientHeight,o=p.scrollHeight,r=r+X*(n?-1:1),p.scrollTop=r,d&&(d.scrollTop=r),v&&(v.scrollTop=r),(n?r<o-t:0<=r)&&(x=setTimeout(e,10)),ae.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:p.scrollTop,scrollLeft:p.scrollLeft,scrollHeight:p.scrollHeight,scrollWidth:p.scrollWidth,bodyHeight:f,bodyWidth:h,isX:i,isY:s},a))}()};(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=_.fixedType,l=se.elemStore,t=(e||"main")+"-body-",e=I.value;l[t+"wrapper"]=I.value,l[t+"table"]=D.value,l[t+"colgroup"]=M.value,l[t+"list"]=$.value,l[t+"xSpace"]=k.value,l[t+"ySpace"]=U.value,l[t+"emptyBlock"]=Y.value,e.onscroll=o,e._onscroll=o})}),(0,_vue.onBeforeUnmount)(function(){var e=I.value;clearTimeout(x),e._onscroll=null,e.onscroll=null}),(0,_vue.onUnmounted)(function(){var e=_.fixedType,l=se.elemStore,e=(e||"main")+"-body-";l[e+"wrapper"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null,l[e+"ySpace"]=null,l[e+"emptyBlock"]=null});return function(){var e=_.fixedColumn,l=_.fixedType,t=_.tableColumn,o=ne.keyboardConfig,r=ne.showOverflow,a=ne.spanMethod,n=ne.mouseConfig,i=ie.tableData,s=ie.mergeList,u=ie.scrollYLoad,c=ie.isAllOverflow,d=se.visibleColumn,v=w.slots,p=ce.value,f=H.value,h=E.value,x=R.value;return l&&(t=!(u||r&&c)||s.length||a||o&&h.isMerge?d:e),f=v.empty?ae.callSlot(v.empty,{$table:ae}):(v=(v=f.name?_vXETable.VXETable.renderer.get(f.name):null)?v.renderEmpty:null)?v(f,{$table:ae}):ne.emptyText||_conf.default.i18n("vxe.table.emptyText"),(0,_vue.h)("div",__assign({ref:I,class:["vxe-table--body-wrapper",l?"fixed-"+l+"--wrapper":"body--wrapper"],xid:y},"wheel"===p.mode?{onWheel:g}:{}),[l?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:k,class:"vxe-body--x-space"}),(0,_vue.h)("div",{ref:U,class:"vxe-body--y-space"}),(0,_vue.h)("table",{ref:D,class:"vxe-table--body",xid:y,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:M},t.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})})),(0,_vue.h)("tbody",{ref:$},q(l,i,t))]),(0,_vue.h)("div",{class:"vxe-table--checkbox-range"}),n&&x.area?(0,_vue.h)("div",{class:"vxe-table--cell-area"},[(0,_vue.h)("span",{class:"vxe-table--cell-main-area"},x.extension?[(0,_vue.h)("span",{class:"vxe-table--cell-main-area-btn",onMousedown:function(e){ae.triggerCellExtendMousedownEvent(e,{$table:ae,fixed:l,type:renderType})}})]:[]),(0,_vue.h)("span",{class:"vxe-table--cell-copy-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-extend-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-multi-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-active-area"})]):null,l?null:(0,_vue.h)("div",{class:"vxe-table--empty-block",ref:Y},[(0,_vue.h)("div",{class:"vxe-table--empty-content"},f)])])}}});exports.default=_default;