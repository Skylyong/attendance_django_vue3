"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,r=1,n=arguments.length;r<n;r++)for(var t in l=arguments[r])Object.prototype.hasOwnProperty.call(l,t)&&(e[t]=l[t]);return e}).apply(this,arguments)};function renderHelpIcon(l){var r=l.$table,e=l.column,e=e.titlePrefix||e.titleHelp;return e?[(0,_vue.h)("i",{class:["vxe-cell-help-icon",e.icon||_conf.default.icon.TABLE_HELP],onMouseenter:function(e){r.triggerHeaderHelpEvent(e,l)},onMouseleave:function(e){r.handleTargetLeaveEvent(e)}})]:[]}function renderTitleContent(l,e){var r=l.$table,n=l.column,t=r.props,o=r.internalData,a=r.getComputeMaps().computeTooltipOpts,c=t.showHeaderOverflow,i=n.type,t=n.showHeaderOverflow,d=a.value.showAll,t=_xeUtils.default.isUndefined(t)||_xeUtils.default.isNull(t)?c:t,s="title"===t,u=!0===t||"tooltip"===t,t={};return(s||u||d)&&(t.onMouseenter=function(e){o._isResize||(s?(0,_dom.updateCellTitle)(e.currentTarget,n):(u||d)&&r.triggerHeaderTooltipEvent(e,l))}),(u||d)&&(t.onMouseleave=function(e){o._isResize||(u||d)&&r.handleTargetLeaveEvent(e)}),["html"===i&&_xeUtils.default.isString(e)?(0,_vue.h)("span",__assign({class:"vxe-cell--title",innerHTML:e},t)):(0,_vue.h)("span",__assign({class:"vxe-cell--title"},t),e)]}function getFooterContent(e){var l=e.$table,r=e.column,n=e._columnIndex,t=e.items,o=r.slots,a=r.editRender,r=r.cellRender,r=a||r,o=o?o.footer:null;if(o)return l.callSlot(o,e);if(r){o=_vXETable.VXETable.renderer.get(r.name);if(o&&o.renderFooter)return o.renderFooter(r,e)}return[(0,_utils.formatText)(t[n],1)]}function getDefaultCellLabel(e){var l=e.$table,r=e.row,e=e.column;return(0,_utils.formatText)(l.getCellLabel(r,e),1)}var Cell={createColumn:function(e,l){var r=l.type,n=l.sortable,t=l.filters,o=l.editRender,a=l.treeNode,c=e.props.editConfig,i=e.getComputeMaps(),d=i.computeEditOpts,s=i.computeCheckboxOpts.value,u=d.value,f={renderHeader:Cell.renderDefaultHeader,renderCell:a?Cell.renderTreeCell:Cell.renderDefaultCell,renderFooter:Cell.renderDefaultFooter};switch(r){case"seq":f.renderHeader=Cell.renderSeqHeader,f.renderCell=a?Cell.renderTreeIndexCell:Cell.renderSeqCell;break;case"radio":f.renderHeader=Cell.renderRadioHeader,f.renderCell=a?Cell.renderTreeRadioCell:Cell.renderRadioCell;break;case"checkbox":f.renderHeader=Cell.renderCheckboxHeader,f.renderCell=s.checkField?a?Cell.renderTreeSelectionCellByProp:Cell.renderCheckboxCellByProp:a?Cell.renderTreeSelectionCell:Cell.renderCheckboxCell;break;case"expand":f.renderCell=Cell.renderExpandCell,f.renderData=Cell.renderExpandData;break;case"html":f.renderCell=a?Cell.renderTreeHTMLCell:Cell.renderHTMLCell,t&&n?f.renderHeader=Cell.renderSortAndFilterHeader:n?f.renderHeader=Cell.renderSortHeader:t&&(f.renderHeader=Cell.renderFilterHeader);break;default:c&&o?(f.renderHeader=Cell.renderEditHeader,f.renderCell="cell"===u.mode?a?Cell.renderTreeCellEdit:Cell.renderCellEdit:a?Cell.renderTreeRowEdit:Cell.renderRowEdit):t&&n?f.renderHeader=Cell.renderSortAndFilterHeader:n?f.renderHeader=Cell.renderSortHeader:t&&(f.renderHeader=Cell.renderFilterHeader)}return(0,_util.createColumn)(e,l,f)},renderHeaderTitle:function(e){var l=e.$table,r=e.column,n=r.slots,t=r.editRender,o=r.cellRender,o=t||o,n=n?n.header:null;if(n)return renderTitleContent(e,l.callSlot(n,e));if(o){n=_vXETable.VXETable.renderer.get(o.name);if(n&&n.renderHeader)return renderTitleContent(e,n.renderHeader(o,e))}return renderTitleContent(e,(0,_utils.formatText)(r.getTitle(),1))},renderDefaultHeader:function(e){return renderHelpIcon(e).concat(Cell.renderHeaderTitle(e))},renderDefaultCell:function(e){var l=e.$table,r=e.row,n=e.column,t=n.slots,o=n.editRender,a=n.cellRender,c=o||a,a=t?t.default:null;if(a)return l.callSlot(a,e);if(c){t=o?"renderCell":"renderDefault",a=_vXETable.VXETable.renderer.get(c.name),t=a?a[t]:null;if(t)return t(c,Object.assign({$type:o?"edit":"cell"},e))}r=l.getCellLabel(r,n),n=o?o.placeholder:"";return[(0,_vue.h)("span",{class:"vxe-cell--label"},o&&(0,_utils.eqEmptyValue)(r)?[(0,_vue.h)("span",{class:"vxe-cell--placeholder"},(0,_utils.formatText)((0,_utils.getFuncText)(n),1))]:(0,_utils.formatText)(r,1))]},renderTreeCell:function(e){return Cell.renderTreeIcon(e,Cell.renderDefaultCell(e))},renderDefaultFooter:function(e){return[(0,_vue.h)("span",{class:"vxe-cell--item"},getFooterContent(e))]},renderTreeIcon:function(l,e){var r=l.$table,n=l.isHidden,t=r.reactData,o=r.getComputeMaps().computeTreeOpts,a=t.treeExpandeds,c=t.treeLazyLoadeds,i=o.value,d=l.row,s=l.column,u=l.level,f=s.slots,v=i.children,C=i.hasChild,_=i.indent,p=i.lazy,h=i.trigger,x=i.iconLoaded,b=i.showIcon,T=i.iconOpen,m=i.iconClose,t=d[v],o=f?f.icon:null,s=!1,i=!1,v=!1,f={};return o?r.callSlot(o,l):(n||(i=-1<r.findRowIndexOf(a,d),p&&(v=-1<r.findRowIndexOf(c,d),s=d[C])),h&&"default"!==h||(f.onClick=function(e){return r.triggerTreeExpandEvent(e,l)}),[(0,_vue.h)("div",{class:["vxe-cell--tree-node",{"is--active":i}],style:{paddingLeft:u*_+"px"}},[b&&(t&&t.length||s)?[(0,_vue.h)("div",__assign({class:"vxe-tree--btn-wrapper"},f),[(0,_vue.h)("i",{class:["vxe-tree--node-btn",v?x||_conf.default.icon.TABLE_TREE_LOADED:i?T||_conf.default.icon.TABLE_TREE_OPEN:m||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,(0,_vue.h)("div",{class:"vxe-tree-cell"},e)])])},renderSeqHeader:function(e){var l=e.$table,r=e.column,n=r.slots,n=n?n.header:null;return renderTitleContent(e,n?l.callSlot(n,e):(0,_utils.formatText)(r.getTitle(),1))},renderSeqCell:function(e){var l=e.$table,r=e.column,n=l.props.treeConfig,t=l.getComputeMaps().computeSeqOpts.value,r=r.slots,r=r?r.default:null;if(r)return l.callSlot(r,e);l=e.seq,r=t.seqMethod;return[(0,_utils.formatText)(r?r(e):n?l:(t.startIndex||0)+l,1)]},renderTreeIndexCell:function(e){return Cell.renderTreeIcon(e,Cell.renderSeqCell(e))},renderRadioHeader:function(e){var l=e.$table,r=e.column,n=r.slots,t=n?n.header:null,n=n?n.title:null;return renderTitleContent(e,t?l.callSlot(t,e):[(0,_vue.h)("span",{class:"vxe-radio--label"},n?l.callSlot(n,e):(0,_utils.formatText)(r.getTitle(),1))])},renderRadioCell:function(l){var e,r=l.$table,n=l.column,t=l.isHidden,o=r.reactData,a=r.getComputeMaps().computeRadioOpts,c=o.selectRow,i=a.value,d=n.slots,s=i.labelField,o=i.checkMethod,a=i.visibleMethod,n=l.row,i=d?d.default:null,d=d?d.radio:null,c=n===c,u=!a||a({row:n}),f=!!o;t||(e={onClick:function(e){!f&&u&&r.triggerRadioRowEvent(e,l)}},o&&(f=!o({row:n})));o=__assign(__assign({},l),{checked:c,disabled:f,visible:u});if(d)return r.callSlot(d,o);d=[];return u&&d.push((0,_vue.h)("span",{class:"vxe-radio--icon vxe-radio--checked-icon"}),(0,_vue.h)("span",{class:"vxe-radio--icon vxe-radio--unchecked-icon"})),(i||s)&&d.push((0,_vue.h)("span",{class:"vxe-radio--label"},i?r.callSlot(i,o):_xeUtils.default.get(n,s))),[(0,_vue.h)("span",__assign({class:["vxe-cell--radio",{"is--checked":c,"is--disabled":f}]},e),d)]},renderTreeRadioCell:function(e){return Cell.renderTreeIcon(e,Cell.renderRadioCell(e))},renderCheckboxHeader:function(e){var l,r=e.$table,n=e.column,t=e.isHidden,o=r.reactData,a=r.getComputeMaps(),c=a.computeIsAllCheckboxDisabled,i=a.computeCheckboxOpts,d=o.isAllSelected,a=o.isIndeterminate,s=c.value,o=n.slots,c=o?o.header:null,o=o?o.title:null,i=i.value,n=n.getTitle();t||(l={onClick:function(e){s||r.triggerCheckAllEvent(e,!d)}});e=__assign(__assign({},e),{checked:d,disabled:s,indeterminate:a});return c?renderTitleContent(e,r.callSlot(c,e)):(i.checkStrictly?i.showHeader:!1!==i.showHeader)?renderTitleContent(e,[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":d,"is--disabled":s,"is--indeterminate":a}],title:_conf.default.i18n("vxe.table.allTitle")},l),[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(o||n?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},o?r.callSlot(o,e):n)]:[]))]):renderTitleContent(e,[(0,_vue.h)("span",{class:"vxe-checkbox--label"},o?r.callSlot(o,e):n)])},renderCheckboxCell:function(l){var e,r=l.$table,n=l.row,t=l.column,o=l.isHidden,a=r.props,c=r.reactData,i=a.treeConfig,d=c.selection,s=c.treeIndeterminates,u=r.getComputeMaps().computeCheckboxOpts.value,f=u.labelField,v=u.checkMethod,a=u.visibleMethod,c=t.slots,u=c?c.default:null,t=c?c.checkbox:null,c=!1,C=!1,_=!a||a({row:n}),p=!!v;o||(C=-1<r.findRowIndexOf(d,n),e={onClick:function(e){!p&&_&&r.triggerCheckRowEvent(e,l,!C)}},v&&(p=!v({row:n})),i&&(c=-1<r.findRowIndexOf(s,n)));s=__assign(__assign({},l),{checked:C,disabled:p,visible:_,indeterminate:c});if(t)return r.callSlot(t,s);t=[];return _&&t.push((0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})),(u||f)&&t.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},u?r.callSlot(u,s):_xeUtils.default.get(n,f))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":C,"is--disabled":p,"is--indeterminate":c}]},e),t)]},renderTreeSelectionCell:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCell(e))},renderCheckboxCellByProp:function(l){var e,r=l.$table,n=l.row,t=l.column,o=l.isHidden,a=r.props,c=r.reactData,i=a.treeConfig,d=c.treeIndeterminates,s=r.getComputeMaps().computeCheckboxOpts.value,u=s.labelField,f=s.checkField,v=s.halfField,C=s.checkMethod,a=s.visibleMethod,c=t.slots,s=c?c.default:null,t=c?c.checkbox:null,c=!1,_=!1,p=!a||a({row:n}),h=!!C;o||(_=_xeUtils.default.get(n,f),e={onClick:function(e){!h&&p&&r.triggerCheckRowEvent(e,l,!_)}},C&&(h=!C({row:n})),i&&(c=-1<r.findRowIndexOf(d,n)));d=__assign(__assign({},l),{checked:_,disabled:h,visible:p,indeterminate:c});if(t)return r.callSlot(t,d);t=[];return p&&(t.push((0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})),(s||u)&&t.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},s?r.callSlot(s,d):_xeUtils.default.get(n,u)))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":_,"is--disabled":h,"is--indeterminate":v&&!_?n[v]:c}]},e),t)]},renderTreeSelectionCellByProp:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCellByProp(e))},renderExpandCell:function(l){var r=l.$table,e=l.isHidden,n=l.row,t=l.column,o=r.reactData,a=o.rowExpandeds,c=o.expandLazyLoadeds,i=r.getComputeMaps().computeExpandOpts.value,d=i.lazy,s=i.labelField,u=i.iconLoaded,f=i.showIcon,v=i.iconOpen,C=i.iconClose,_=i.visibleMethod,p=t.slots,o=p?p.default:null,i=p?p.icon:null,t=!1,p=!1;return i?r.callSlot(i,l):(e||(t=-1<r.findRowIndexOf(a,l.row),d&&(p=-1<r.findRowIndexOf(c,n))),[!f||_&&!_(l)?null:(0,_vue.h)("span",{class:["vxe-table--expanded",{"is--active":t}],onClick:function(e){r.triggerRowExpandEvent(e,l)}},[(0,_vue.h)("i",{class:["vxe-table--expand-btn",p?u||_conf.default.icon.TABLE_EXPAND_LOADED:t?v||_conf.default.icon.TABLE_EXPAND_OPEN:C||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),o||s?(0,_vue.h)("span",{class:"vxe-table--expand-label"},o?r.callSlot(o,l):_xeUtils.default.get(n,s)):null])},renderExpandData:function(e){var l=e.$table,r=e.column,n=r.slots,r=r.contentRender,n=n?n.content:null;if(n)return l.callSlot(n,e);if(r){n=_vXETable.VXETable.renderer.get(r.name);if(n&&n.renderExpand)return n.renderExpand(r,e)}return[]},renderHTMLCell:function(e){var l=e.$table,r=e.column.slots,r=r?r.default:null;return r?l.callSlot(r,e):[(0,_vue.h)("span",{class:"vxe-cell--html",innerHTML:getDefaultCellLabel(e)})]},renderTreeHTMLCell:function(e){return Cell.renderTreeIcon(e,Cell.renderHTMLCell(e))},renderSortAndFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e)).concat(Cell.renderFilterIcon(e))},renderSortHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e))},renderSortIcon:function(e){var l=e.$table,r=e.column,n=l.getComputeMaps().computeSortOpts.value,t=n.showIcon,o=n.iconAsc,e=n.iconDesc,n=r.order;return t?[(0,_vue.h)("span",{class:"vxe-cell--sort"},[(0,_vue.h)("i",{class:["vxe-sort--asc-btn",o||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===n}],title:_conf.default.i18n("vxe.table.sortAsc"),onClick:function(e){l.triggerSortEvent(e,r,"asc")}}),(0,_vue.h)("i",{class:["vxe-sort--desc-btn",e||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===n}],title:_conf.default.i18n("vxe.table.sortDesc"),onClick:function(e){l.triggerSortEvent(e,r,"desc")}})])]:[]},renderFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderFilterIcon(e))},renderFilterIcon:function(l){var r=l.$table,e=l.column,n=l.hasFilter,t=r.reactData.filterStore,o=r.getComputeMaps().computeFilterOpts.value,a=o.showIcon,c=o.iconNone,o=o.iconMatch;return a?[(0,_vue.h)("span",{class:["vxe-cell--filter",{"is--active":t.visible&&t.column===e}]},[(0,_vue.h)("i",{class:["vxe-filter--btn",n?o||_conf.default.icon.TABLE_FILTER_MATCH:c||_conf.default.icon.TABLE_FILTER_NONE],title:_conf.default.i18n("vxe.table.filter"),onClick:function(e){r.triggerFilterEvent(e,l.column,l)}})])]:[]},renderEditHeader:function(e){var l=e.$table,r=e.column,n=l.props,t=l.getComputeMaps().computeEditOpts,o=n.editConfig,a=n.editRules,c=t.value,l=r.sortable,n=r.filters,t=r.editRender,r=!1;return!a||(a=_xeUtils.default.get(a,e.column.property))&&(r=a.some(function(e){return e.required})),((0,_utils.isEnableConf)(o)?[r&&c.showAsterisk?(0,_vue.h)("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(t)&&c.showIcon?(0,_vue.h)("i",{class:["vxe-cell--edit-icon",c.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e)).concat(l?Cell.renderSortIcon(e):[]).concat(n?Cell.renderFilterIcon(e):[])},renderRowEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row)},renderTreeRowEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderRowEdit(e))},renderCellEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row&&l.column===e.column)},renderTreeCellEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderCellEdit(e))},runRenderer:function(e,l){var r=e.$table,n=e.column,t=n.slots,o=n.editRender,a=n.formatter,c=t?t.default:null,n=t?t.edit:null,t=_vXETable.VXETable.renderer.get(o.name);return l?n?r.callSlot(n,e):t&&t.renderEdit?t.renderEdit(o,Object.assign({$type:"edit"},e)):[]:c?r.callSlot(c,e):a?[(0,_vue.h)("span",{class:"vxe-cell--label"},getDefaultCellLabel(e))]:Cell.renderDefaultCell(e)}},_default=exports.Cell=Cell;exports.default=_default;