"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var autoTxtElem,_vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_utils=require("../../tools/utils"),_size=require("../../hooks/size");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=(0,_vue.defineComponent)({name:"VxeTextarea",props:{modelValue:[String,Number],className:String,immediate:{type:Boolean,default:!0},name:String,readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],rows:{type:[String,Number],default:2},cols:{type:[String,Number],default:null},showWordCount:Boolean,countMethod:Function,autosize:[Boolean,Object],form:String,resize:{type:String,default:function(){return _conf.default.textarea.resize}},size:{type:String,default:function(){return _conf.default.textarea.size||_conf.default.size}}},emits:["update:modelValue","input","keydown","keyup","click","change","focus","blur"],setup:function(p,e){function t(){var e,t=p.size,u=p.autosize,a=g.inputValue;u&&((autoTxtElem=autoTxtElem||document.createElement("div")).parentNode||document.body.appendChild(autoTxtElem),e=z.value,u=getComputedStyle(e),autoTxtElem.className=["vxe-textarea--autosize",t?"size--"+t:""].join(" "),autoTxtElem.style.width=e.clientWidth+"px",autoTxtElem.style.padding=u.padding,autoTxtElem.innerHTML=(""+(a||"　")).replace(/\n$/,"\n　"))}function v(e){var t=p.immediate,u=e.target.value;g.inputValue=u,t&&r(u,e),l.dispatchEvent("input",{value:u},e),i()}function x(e){p.immediate?T(e):r(g.inputValue,e)}function _(e){var t=p.immediate,u=g.inputValue;t||r(u,e),l.dispatchEvent("blur",{value:u},e)}var a=e.emit,u=_xeUtils.default.uniqueId(),h=(0,_size.useSize)(p),g=(0,_vue.reactive)({inputValue:p.modelValue}),b=(0,_vue.ref)(),z=(0,_vue.ref)(),n={refElem:b,refTextarea:z},l={xID:u,props:p,context:e,reactData:g,getRefMaps:function(){return n}},y=(0,_vue.computed)(function(){return _xeUtils.default.getSize(g.inputValue)}),V=(0,_vue.computed)(function(){var e=y.value;return p.maxlength&&e>_xeUtils.default.toNumber(p.maxlength)}),o=(0,_vue.computed)(function(){return Object.assign({minRows:1,maxRows:10},_conf.default.textarea.autosize,p.autosize)}),i=function(){p.autosize&&(0,_vue.nextTick)(function(){var e=o.value,t=e.minRows,u=e.maxRows,a=z.value,n=autoTxtElem.clientHeight,l=getComputedStyle(a),i=_xeUtils.default.toNumber(l.lineHeight),e=_xeUtils.default.toNumber(l.paddingTop)+_xeUtils.default.toNumber(l.paddingBottom)+_xeUtils.default.toNumber(l.borderTopWidth)+_xeUtils.default.toNumber(l.borderBottomWidth),l=(n-e)/i,n=l&&/[0-9]/.test(""+l)?l:Math.floor(l)+1,l=n;n<t?l=t:u<n&&(l=u),a.style.height=l*i+e+"px"})},T=function(e){var t=g.inputValue;l.dispatchEvent(e.type,{value:t},e)},r=function(e,t){g.inputValue=e,a("update:modelValue",e),_xeUtils.default.toValueString(p.modelValue)!==e&&s.dispatchEvent("change",{value:e},t)},s={dispatchEvent:function(e,t,u){a(e,Object.assign({$textarea:l,$event:u},t))},focus:function(){return z.value.focus(),(0,_vue.nextTick)()},blur:function(){return z.value.blur(),(0,_vue.nextTick)()}};Object.assign(l,s),(0,_vue.watch)(function(){return p.modelValue},function(e){g.inputValue=e,t()}),(0,_vue.nextTick)(function(){p.autosize&&(t(),i())});return l.renderVN=function(){var e=p.className,t=p.resize,u=p.placeholder,a=p.disabled,n=p.maxlength,l=p.autosize,i=p.showWordCount,o=p.countMethod,r=p.rows,s=p.cols,d=g.inputValue,c=h.value,f=V.value,m=y.value;return(0,_vue.h)("div",{ref:b,class:["vxe-textarea",e,((e={})["size--"+c]=c,e["is--autosize"]=l,e["is--disabled"]=a,e["def--rows"]=!_xeUtils.default.eqNull(r),e["def--cols"]=!_xeUtils.default.eqNull(s),e)]},[(0,_vue.h)("textarea",{ref:z,class:"vxe-textarea--inner",value:d,name:p.name,placeholder:u?(0,_utils.getFuncText)(u):null,maxlength:n,readonly:p.readonly,disabled:a,rows:r,cols:s,style:t?{resize:t}:null,onInput:v,onChange:x,onKeydown:T,onKeyup:T,onClick:T,onFocus:T,onBlur:_}),i?(0,_vue.h)("span",{class:["vxe-textarea--count",{"is--error":f}]},o?""+o({value:d}):m+(n?"/"+n:"")):null])},l},render:function(){return this.renderVN()}});exports.default=_default2;