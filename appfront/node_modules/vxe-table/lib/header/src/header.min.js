"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("./util"),_util2=require("../../table/src/util"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,n=arguments.length;t<n;t++)for(var r in l=arguments[t])Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);return e}).apply(this,arguments)},renderType="header",_default=(0,_vue.defineComponent)({name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(W){function t(){var e=s.isGroup;c.value=e?(0,_util.convertToRows)(W.tableGroupColumn):[]}var k=(0,_vue.inject)("$xetable",{}),o=k.xID,u=k.props,s=k.reactData,I=k.internalData,e=k.getRefMaps(),$=e.refElem,H=e.refTableBody,O=e.refLeftContainer,q=e.refRightContainer,A=e.refCellResizeBar,d=k.getComputeMaps().computeColumnOpts,c=(0,_vue.ref)([]),E=(0,_vue.ref)(),f=(0,_vue.ref)(),p=(0,_vue.ref)(),v=(0,_vue.ref)(),m=(0,_vue.ref)(),h=(0,_vue.ref)();(0,_vue.watch)(function(){return W.tableColumn},t),(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=W.fixedType,l=k.internalData.elemStore,e=(e||"main")+"-header-";l[e+"wrapper"]=E.value,l[e+"table"]=f.value,l[e+"colgroup"]=p.value,l[e+"list"]=v.value,l[e+"xSpace"]=m.value,l[e+"repair"]=h.value,t()})}),(0,_vue.onUnmounted)(function(){var e=W.fixedType,l=k.internalData.elemStore,e=(e||"main")+"-header-";l[e+"wrapper"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null,l[e+"repair"]=null});return function(){var _=W.fixedType,e=W.fixedColumn,l=W.tableColumn,x=u.resizable,g=u.border,b=u.columnKey,t=u.headerRowClassName,y=u.headerCellClassName,n=u.headerRowStyle,C=u.headerCellStyle,w=u.showHeaderOverflow,M=u.headerAlign,T=u.align,z=u.mouseConfig,r=s.isGroup,S=s.currentColumn,D=s.scrollXLoad,R=s.overflowX,a=s.scrollbarWidth,U=d.value,i=c.value;return r||(i=[l=_&&(D||w)?e:l]),(0,_vue.h)("div",{ref:E,class:["vxe-table--header-wrapper",_?"fixed-"+_+"--wrapper":"body--wrapper"],xid:o},[_?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:m,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:f,class:"vxe-table--header",xid:o,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:p},l.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})}).concat(a?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("thead",{ref:v},i.map(function(m,h){return(0,_vue.h)("tr",{class:["vxe-header--row",t?_xeUtils.default.isFunction(t)?t({$table:k,$rowIndex:h,fixed:_,type:renderType}):t:""],style:n?_xeUtils.default.isFunction(n)?n({$table:k,$rowIndex:h,fixed:_,type:renderType}):n:null},m.map(function(e,l){var t=e.type,n=e.showHeaderOverflow,r=e.headerAlign,a=e.align,i=e.headerClassName,o=e.children&&e.children.length,u=_?e.fixed!==_&&!o:!!e.fixed&&R,s=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?w:n,d=r||a||M||T,c="ellipsis"===s,f="title"===s,p=!0===s||"tooltip"===s,n=f||p||c,r=e.filters&&e.filters.some(function(e){return e.checked}),a=k.getColumnIndex(e),s=k.getVTColumnIndex(e),v={$table:k,$rowIndex:h,column:e,columnIndex:a,$columnIndex:l,_columnIndex:s,fixed:_,type:renderType,isHidden:u,hasFilter:r},a={onClick:function(e){return k.triggerHeaderCellClickEvent(e,v)},onDblclick:function(e){return k.triggerHeaderCellDblclickEvent(e,v)}};return D&&!n&&(c=n=!0),z&&(a.onMousedown=function(e){return k.triggerHeaderCellMousedownEvent(e,v)}),(0,_vue.h)("th",__assign(__assign({class:["vxe-header--column",e.id,((s={})["col--"+d]=d,s["col--"+t]=t,s["col--last"]=l===m.length-1,s["col--fixed"]=e.fixed,s["col--group"]=o,s["col--ellipsis"]=n,s["fixed--hidden"]=u,s["is--sortable"]=e.sortable,s["col--filter"]=!!e.filters,s["is--filter-active"]=r,s["col--current"]=S===e,s),i?_xeUtils.default.isFunction(i)?i(v):i:"",y?_xeUtils.default.isFunction(y)?y(v):y:""],colid:e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null,style:C?_xeUtils.default.isFunction(C)?C(v):C:null},a),{key:b||U.useKey||o?e.id:l}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":p,"c--ellipsis":c}]},e.renderHeader(v)),u||o||!(_xeUtils.default.isBoolean(e.resizable)?e.resizable:U.resizable||x)?null:(0,_vue.h)("div",{class:["vxe-resizable",{"is--line":!g||"none"===g}],onMousedown:function(e){return function(e,l){var t=l.column,n=W.fixedType,r=H.value,a=O.value,i=q.value,o=A.value,u=e.clientX,s=E.value,d=e.target,c=l.cell=d.parentNode,f=0,p=r.$el,r=(0,_dom.getOffsetPos)(d,s),s=d.clientWidth,d=Math.floor(s/2),v=(0,_util2.getColMinWidth)(l)-d,m=r.left-c.clientWidth+s+v,h=r.left+d,_=document.onmousemove,x=document.onmouseup,g="left"===n,b="right"===n,y=$.value,C=0;if(g||b){for(var w=g?"nextElementSibling":"previousElementSibling",M=c[w];M&&!(0,_dom.hasClass)(M,"fixed--hidden");)(0,_dom.hasClass)(M,"col--group")||(C+=M.offsetWidth),M=M[w];b&&i&&(h=i.offsetLeft+C)}d=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-u,e=h+l,l=n?0:p.scrollLeft;g?e=Math.min(e,(i?i.offsetLeft:p.clientWidth)-C-v):b?(m=(a?a.clientWidth:0)+C+v,e=Math.min(e,h+c.clientWidth-v)):m=Math.max(p.scrollLeft,m),f=Math.max(e,m),o.style.left=f-l+"px"};I._isResize=!0,(0,_dom.addClass)(y,"drag--resize"),o.style.display="block",document.onmousemove=d,document.onmouseup=function(e){document.onmousemove=_,document.onmouseup=x,t.resizeWidth=t.renderWidth+(b?h-f:f-h),o.style.display="none",I._isResize=!1,I._lastResizeTime=Date.now(),k.analyColumnWidth(),k.recalculate(!0).then(function(){k.saveCustomResizable(),k.updateCellAreas(),k.dispatchEvent("resizable-change",l,e)}),(0,_dom.removeClass)(y,"drag--resize")},d(e),k.closeMenu&&k.closeMenu()}(e,v)}})])}).concat(a?[(0,_vue.h)("th",{class:"vxe-header--gutter col--gutter"})]:[]))}))]),(0,_vue.h)("div",{ref:h,class:"vxe-table--header-border-line"})])}}});exports.default=_default;